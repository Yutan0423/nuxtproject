<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>nuxt-portfolio</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/nuxtproject/favicon.ico"><link rel="preload" href="/_nuxt/eb48907.js" as="script"><link rel="preload" href="/_nuxt/03b0cb7.js" as="script"><link rel="preload" href="/_nuxt/4845015.js" as="script"><link rel="preload" href="/_nuxt/5be2546.js" as="script"><link rel="preload" href="/_nuxt/04d8d93.js" as="script"><style data-vue-ssr-id="7e56e4e3:0 56b15182:0 0e4813b0:0 14c587c6:0 29350178:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:"Source Sans Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;box-sizing:border-box}*,:after,:before{box-sizing:border-box;margin:0}.header[data-v-08fa89b0]{background-color:#15202b;width:100%;color:#fff;height:72px;padding:15px;position:fixed;z-index:100;display:flex;justify-content:space-between;align-items:center}.header-fixed[data-v-08fa89b0]{transition:.3s;opacity:.9}.link-active.gnav-fixed[data-v-08fa89b0],.link-active[data-v-08fa89b0]{border-bottom:2px solid #fff}.site-title[data-v-08fa89b0]{font-size:24px}.gnav[data-v-08fa89b0]{display:flex}.gnav-items[data-v-08fa89b0]{list-style:none;font-size:20px}.gnav-link[data-v-08fa89b0]{text-decoration:none;color:#fff;padding:8px 0;margin-right:24px}.sp-nav-btn[data-v-08fa89b0]{-webkit-appearance:none;-moz-appearance:none;appearance:none;position:absolute;top:8px;right:12px;width:40px;height:40px;z-index:110;border:none;background-color:#15202b}.sp-nav-btn span[data-v-08fa89b0]{position:absolute;display:block;width:28px;height:1px;background-color:#fff;transition:all .5s}.sp-nav-btn span[data-v-08fa89b0]:first-of-type{top:10px}.sp-nav-btn span[data-v-08fa89b0]:nth-of-type(2){top:20px}.sp-nav-btn span[data-v-08fa89b0]:last-of-type{bottom:10px}.btn-active span[data-v-08fa89b0]:first-of-type{transform:rotate(45deg);top:20px}.btn-active span[data-v-08fa89b0]:nth-of-type(2){opacity:0}.btn-active span[data-v-08fa89b0]:last-of-type{transform:rotate(-45deg);bottom:20px}.header-margin[data-v-08fa89b0]{height:72px}@media screen and (max-width:768px){.header-margin[data-v-08fa89b0],.header[data-v-08fa89b0]{height:52px}.site-title[data-v-08fa89b0]{font-size:14px}}.content-inner[data-v-59d6e120]{max-width:990px;padding:0 60px;margin:48px auto 64px}.content-title[data-v-59d6e120],.posts-item[data-v-59d6e120]{margin-bottom:16px}.posts-item[data-v-59d6e120]{list-style:none}@media screen and (max-width:768px){.content-inner[data-v-59d6e120]{padding:0 30px}}footer[data-v-6f2917c8]{height:52px;width:100%;background-color:#15202b;display:flex;justify-content:center;align-items:center}footer small[data-v-6f2917c8]{color:#fff}@media screen and (max-width:768px){footer>small[data-v-6f2917c8]{font-size:11px}}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div data-v-08fa89b0><header class="header" data-v-08fa89b0><h1 class="site-title" data-v-08fa89b0><a href="/" class="gnav-link nuxt-link-active" data-v-08fa89b0>Yutan Portfolio</a></h1> <div data-v-08fa89b0><button class="sp-nav-btn" data-v-08fa89b0><span data-v-08fa89b0></span> <span data-v-08fa89b0></span> <span data-v-08fa89b0></span></button></div></header> <div class="header-margin" data-v-08fa89b0></div></div> <!----> <div><div class="content-inner" data-v-59d6e120><h2 class="content-title" data-v-59d6e120><strong data-v-59d6e120>Nuxt.js</strong>の記事一覧
        </h2> <ul data-v-59d6e120><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsを短期間でFirebaseにデプロイしてCircleCIで自動デプロイをするところまでを設定するマニュアル①デプロイまで</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsとNestJSでTypeScriptなTodoリストを作ってみる（バックエンド編）</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>WARN  mode option is deprecated. Please use ssr: true for universal mode or ssr: false for spa mode and remove mode from nuxt.config</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>nuxtのローカル環境構築メモ</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>nuxtプロジェクトで、インストールしたPrettier,eslintの使用方法</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsとNestJSでTypeScriptなTodoリストを作ってみる（フロント編）</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Electron + Webアプリ(Nuxt.js)でMonorepoな環境を作る</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #6 記事投稿フォームの作成</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>@nuxtjs/markdownit + プラグインを入れたら、IE11がエラーを吐くようになって困った話</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>@nuxtjs/composition-apiと@nuxt/contentを使ってみる</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>【URLから】HeadlessCMSでつくったブログにリンクカードを表示する話【タイトルを取得する】</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Electron + Nuxt.js + TypeScriptの環境構築</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.js 【Cannot read property '_normalized' of undefined】エラー時の対処法</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>【vue-moment】vueでtimer設定する方法</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>nuxtをgithub actionsでnetlifyに自動デプロイする</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>ansible-benderを使ってNuxt.jsのコンテナイメージをビルドしてみた</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>CORSについて</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成</a> <hr data-v-59d6e120></li><li class="posts-item" data-v-59d6e120><a href="post.url" target="_blank" rel="noopener noreferrer" data-v-59d6e120>Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #3 個別記事ページの作成</a> <hr data-v-59d6e120></li></ul></div></div> <footer data-v-6f2917c8><small class="footer-text" data-v-6f2917c8>© 2020 YuTan Portfolio</small></footer></div></div></div><script>window.__NUXT__=function(s,n,a,p,e,t,l,c,o,i,r,d,m,g,u,f,h,b,x,v,k,E,y,w,A,_,j,F,q,S,B,C,N,I,D,T,P,R,O,M,z,$,L,U,H,Y,V){return{layout:"default",data:[{posts:[{rendered_body:'\n<h1>\n<span id="楽をするのは良いことだ" class="fragment"></span><a href="#%E6%A5%BD%E3%82%92%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF%E8%89%AF%E3%81%84%E3%81%93%E3%81%A8%E3%81%A0"><i class="fa fa-link"></i></a>楽をするのは良いことだ</h1>\n\n<p>ということで、個人的に好きで使っているNuxt.jsをFirebaseにデプロイし、その後Githubにプッシュするたびに自動的にデプロイされるように設定するまでをこの記事では解説しておきます。</p>\n\n<p><a href="https://qiita.com/_takeshi_24/items/419b9d0d879351f641f3" id="reference-e7e380dc02ee2545fc74">Firebase使ってみた</a></p>\n\n<p>こちらの記事を参考にさせていただきました。</p>\n\n<h1>\n<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>\n\n<p>OSX Catalina<br>\nnpm version6.14.6<br>\nnode.js v12.18.4</p>\n\n<h1>\n<span id="構築" class="fragment"></span><a href="#%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>構築</h1>\n\n<h2>\n<span id="firebase" class="fragment"></span><a href="#firebase"><i class="fa fa-link"></i></a>Firebase</h2>\n\n<p>まず<a href="https://firebase.google.com/?hl=ja" rel="nofollow noopener" target="_blank">Firebase</a>にログインします。<br>\nGoogleアカウントが必要となるので持っていない方は取得してください。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fb3b3b7f3-b1ee-cbf0-4faa-91daba90f173.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=530564ce1460632ccfc37b96f584ed04" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fb3b3b7f3-b1ee-cbf0-4faa-91daba90f173.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=530564ce1460632ccfc37b96f584ed04" alt="スクリーンショット 2020-10-04 11.38.41.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/b3b3b7f3-b1ee-cbf0-4faa-91daba90f173.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fb3b3b7f3-b1ee-cbf0-4faa-91daba90f173.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6dcd57f12516fb13a8b1be05a4e2334f 1x" loading="lazy"></a></p>\n\n<p>こちらのページにアクセスしたら使ってみるをクリックし、以下の個人のプロジェクトを管理するページに移ってください。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F125bdef2-0d9a-90cc-3743-9a24103ff63f.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ebe197c226af10d2b9c13b6e59af0cb4" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F125bdef2-0d9a-90cc-3743-9a24103ff63f.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ebe197c226af10d2b9c13b6e59af0cb4" alt="スクリーンショット 2020-10-04 11.39.32.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/125bdef2-0d9a-90cc-3743-9a24103ff63f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F125bdef2-0d9a-90cc-3743-9a24103ff63f.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=73cddb0e1cb359f5dd2d3f918e1cf573 1x" loading="lazy"></a></p>\n\n<p>そしてプロジェクトを追加をクリックし、任意のプロジェクト名を設定し、プロジェクトを作成してください。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F855e3971-d0c1-ee49-e828-07aa24500577.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0e833193d083d0dafc8e5c85c6df421a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F855e3971-d0c1-ee49-e828-07aa24500577.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0e833193d083d0dafc8e5c85c6df421a" alt="スクリーンショット 2020-10-04 11.40.23.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/855e3971-d0c1-ee49-e828-07aa24500577.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F855e3971-d0c1-ee49-e828-07aa24500577.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=86651f370416feba570fc35e892c5b0d 1x" loading="lazy"></a><br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fda1c6271-94eb-ce37-f4d8-26a413b713c2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4f329fbc15012b1c817833660668fab6" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fda1c6271-94eb-ce37-f4d8-26a413b713c2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4f329fbc15012b1c817833660668fab6" alt="スクリーンショット 2020-10-04 11.40.42.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/da1c6271-94eb-ce37-f4d8-26a413b713c2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fda1c6271-94eb-ce37-f4d8-26a413b713c2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=971a18bfb73de172c6feb1d563193022 1x" loading="lazy"></a><br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F72a9d7d3-f246-8c19-016f-0c01c7ce38be.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2328f18753c00793c891acdf0500efb0" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F72a9d7d3-f246-8c19-016f-0c01c7ce38be.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2328f18753c00793c891acdf0500efb0" alt="スクリーンショット 2020-10-04 11.40.53.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/72a9d7d3-f246-8c19-016f-0c01c7ce38be.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F72a9d7d3-f246-8c19-016f-0c01c7ce38be.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b0816d458ea5cb5790c34883e9004704 1x" loading="lazy"></a><br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F343bbd2d-a2ef-157a-66ff-6a055ae038b9.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dce6c08f0c43b7f59cbc3275d5ecdf2a" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F343bbd2d-a2ef-157a-66ff-6a055ae038b9.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dce6c08f0c43b7f59cbc3275d5ecdf2a" alt="スクリーンショット 2020-10-04 11.41.02.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/343bbd2d-a2ef-157a-66ff-6a055ae038b9.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2F343bbd2d-a2ef-157a-66ff-6a055ae038b9.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0eb73ce703f286ed3cefccaaf66bccb3 1x" loading="lazy"></a></p>\n\n<p>これでプロジェクトを作成できました！</p>\n\n<p>ひとまずターミナルを開き、以下のコマンドを使ってFirebase CLIをインストールしておきましょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ npm install -g firebase-tools\n</pre></div></div>\n\n<p>そしてついでにログインをしておきましょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ firebase login\n</pre></div></div>\n\n<p>次はNuxtプロジェクトを作成し、Firebaseとつないでデプロイしてみましょう。</p>\n\n<h2>\n<span id="nuxtjs" class="fragment"></span><a href="#nuxtjs"><i class="fa fa-link"></i></a>Nuxt.js</h2>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>mkdir firebase\ncd firebase\nvue init nuxt-community/starter-template sample\n</pre></div></div>\n\n<p>こちらでfirebaseディレクトリ内にNuxtのテンプレートが作成されました。<br>\nそして次にfirebaseとつなぐ必要があるので以下のコマンドをターミナルで実行してください。<br>\nまた、ここではHostingを選択してください。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ firebase init\n</pre></div></div>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>MacBook-Pro sample % firebase init            \n\n     ######## #### ########  ######## ########     ###     ######  ########\n     ##        ##  ##     ## ##       ##     ##  ##   ##  ##       ##\n     ######    ##  ########  ######   ########  #########  ######  ######\n     ##        ##  ##    ##  ##       ##     ## ##     ##       ## ##\n     ##       #### ##     ## ######## ########  ##     ##  ######  ########\n\nYou\'re about to initialize a Firebase project in this directory:\n\n  firebase/sample/\n\n? Which Firebase CLI features do you want to set up for this folder? Press Space\n to select features, then Enter to confirm your choices. Hosting: Configure and \ndeploy Firebase Hosting sites\n\n=== Project Setup\n\nFirst, let\'s associate this project directory with a Firebase project.\nYou can create multiple project aliases by running firebase use --add, \nbut for now we\'ll just set up a default project.\n\n? Please select an option: Use an existing project\n? Select a default Firebase project for this directory: (先ほど入力したプロジェクト名)\ni  Using project (先ほど入力したプロジェクト名)\n\n=== Hosting Setup\n\nYour public directory is the folder (relative to your project directory) that\nwill contain Hosting assets to be uploaded with firebase deploy. If you\nhave a build process for your assets, use your build\'s output directory.\n\n? What do you want to use as your public directory? public\n? Configure as a single-page app (rewrite all urls to /index.html)? Yes\n✔  Wrote public/index.html\n\ni  Writing configuration info to firebase.json...\ni  Writing project information to .firebaserc...\n\n✔  Firebase initialization complete!\n\n</pre></div></div>\n\n<p>これでfirebaseプロジェクトとの接続が完了しました！</p>\n\n<p>次にNuxtプロジェクトをビルドしましょう。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ npm nuxt generate\n</pre></div></div>\n\n<p>これでdist内にビルドしたファイルが出力されました。</p>\n\n<p>次に、sampleプロジェクト内に出力されたfirebase.jsonを以下のように書き換えます。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">firebase.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"hosting"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"public"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sample/dist"</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>そして、一つ上の階層のfirebaseディレクトリに移動し、</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cd ..\n</pre></div></div>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ firebase deploy\n</pre></div></div>\n\n<p>このコマンドでFirebaseにデプロイします！！</p>\n\n<p>上手くいくと、以下のようにアドレスが表示されるので、そちらにブラウザからアクセスしてみましょう!</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>Project Console: https://console.firebase.google.com/project/[あなたのプロジェクト名]/overview\nHosting URL: https://[あなたのプロジェクト名].web.app\n</pre></div></div>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fbcfbdf16-2644-8c5e-4ac1-2b2fd0b94402.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a59202393d1f922b5a317cf4bb13ae9c" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fbcfbdf16-2644-8c5e-4ac1-2b2fd0b94402.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a59202393d1f922b5a317cf4bb13ae9c" alt="スクリーンショット 2020-10-04 11.58.48.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/bcfbdf16-2644-8c5e-4ac1-2b2fd0b94402.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F412789%2Fbcfbdf16-2644-8c5e-4ac1-2b2fd0b94402.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=518f075d3b85da12b3ab399312bec740 1x" loading="lazy"></a></p>\n\n<p>これで今回の記事の範囲、デプロイまでは完了です！<br>\n次回はGithubにリポジトリを作り、CircleCiと連携させる方法について書きます！</p>\n\n<p>お疲れ様でした！</p>\n',body:'# 楽をするのは良いことだ\n\nということで、個人的に好きで使っているNuxt.jsをFirebaseにデプロイし、その後Githubにプッシュするたびに自動的にデプロイされるように設定するまでをこの記事では解説しておきます。\n\n[Firebase使ってみた](https://qiita.com/_takeshi_24/items/419b9d0d879351f641f3)\n\nこちらの記事を参考にさせていただきました。\n\n\n# 環境\n\nOSX Catalina\nnpm version6.14.6\nnode.js v12.18.4\n\n\n# 構築\n\n## Firebase\n\nまず[Firebase](https://firebase.google.com/?hl=ja)にログインします。\nGoogleアカウントが必要となるので持っていない方は取得してください。\n\n![スクリーンショット 2020-10-04 11.38.41.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/b3b3b7f3-b1ee-cbf0-4faa-91daba90f173.png)\n\nこちらのページにアクセスしたら使ってみるをクリックし、以下の個人のプロジェクトを管理するページに移ってください。\n\n![スクリーンショット 2020-10-04 11.39.32.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/125bdef2-0d9a-90cc-3743-9a24103ff63f.png)\n\n\nそしてプロジェクトを追加をクリックし、任意のプロジェクト名を設定し、プロジェクトを作成してください。\n![スクリーンショット 2020-10-04 11.40.23.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/855e3971-d0c1-ee49-e828-07aa24500577.png)\n![スクリーンショット 2020-10-04 11.40.42.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/da1c6271-94eb-ce37-f4d8-26a413b713c2.png)\n![スクリーンショット 2020-10-04 11.40.53.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/72a9d7d3-f246-8c19-016f-0c01c7ce38be.png)\n![スクリーンショット 2020-10-04 11.41.02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/343bbd2d-a2ef-157a-66ff-6a055ae038b9.png)\n\n\nこれでプロジェクトを作成できました！\n\nひとまずターミナルを開き、以下のコマンドを使ってFirebase CLIをインストールしておきましょう。\n\n```\n$ npm install -g firebase-tools\n```\n\nそしてついでにログインをしておきましょう。\n\n```\n$ firebase login\n```\n\n次はNuxtプロジェクトを作成し、Firebaseとつないでデプロイしてみましょう。\n\n## Nuxt.js\n\n\n```\nmkdir firebase\ncd firebase\nvue init nuxt-community/starter-template sample\n```\n\nこちらでfirebaseディレクトリ内にNuxtのテンプレートが作成されました。\nそして次にfirebaseとつなぐ必要があるので以下のコマンドをターミナルで実行してください。\nまた、ここではHostingを選択してください。\n\n```\n$ firebase init\n```\n\n```\nMacBook-Pro sample % firebase init            \n\n     ######## #### ########  ######## ########     ###     ######  ########\n     ##        ##  ##     ## ##       ##     ##  ##   ##  ##       ##\n     ######    ##  ########  ######   ########  #########  ######  ######\n     ##        ##  ##    ##  ##       ##     ## ##     ##       ## ##\n     ##       #### ##     ## ######## ########  ##     ##  ######  ########\n\nYou\'re about to initialize a Firebase project in this directory:\n\n  firebase/sample/\n\n? Which Firebase CLI features do you want to set up for this folder? Press Space\n to select features, then Enter to confirm your choices. Hosting: Configure and \ndeploy Firebase Hosting sites\n\n=== Project Setup\n\nFirst, let\'s associate this project directory with a Firebase project.\nYou can create multiple project aliases by running firebase use --add, \nbut for now we\'ll just set up a default project.\n\n? Please select an option: Use an existing project\n? Select a default Firebase project for this directory: (先ほど入力したプロジェクト名)\ni  Using project (先ほど入力したプロジェクト名)\n\n=== Hosting Setup\n\nYour public directory is the folder (relative to your project directory) that\nwill contain Hosting assets to be uploaded with firebase deploy. If you\nhave a build process for your assets, use your build\'s output directory.\n\n? What do you want to use as your public directory? public\n? Configure as a single-page app (rewrite all urls to /index.html)? Yes\n✔  Wrote public/index.html\n\ni  Writing configuration info to firebase.json...\ni  Writing project information to .firebaserc...\n\n✔  Firebase initialization complete!\n\n```\n\nこれでfirebaseプロジェクトとの接続が完了しました！\n\n次にNuxtプロジェクトをビルドしましょう。\n\n```\n$ npm nuxt generate\n```\n\nこれでdist内にビルドしたファイルが出力されました。\n\n次に、sampleプロジェクト内に出力されたfirebase.jsonを以下のように書き換えます。\n\n```firebase.json\n{\n  "hosting": {\n    "public": "sample/dist"\n  }\n}\n```\n\nそして、一つ上の階層のfirebaseディレクトリに移動し、\n\n```\n$ cd ..\n```\n\n```\n$ firebase deploy\n```\n\nこのコマンドでFirebaseにデプロイします！！\n\n上手くいくと、以下のようにアドレスが表示されるので、そちらにブラウザからアクセスしてみましょう!\n\n```\nProject Console: https://console.firebase.google.com/project/[あなたのプロジェクト名]/overview\nHosting URL: https://[あなたのプロジェクト名].web.app\n```\n\n![スクリーンショット 2020-10-04 11.58.48.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/bcfbdf16-2644-8c5e-4ac1-2b2fd0b94402.png)\n\nこれで今回の記事の範囲、デプロイまでは完了です！\n次回はGithubにリポジトリを作り、CircleCiと連携させる方法について書きます！\n\nお疲れ様でした！\n',coediting:a,comments_count:0,created_at:h,group:s,id:"b2636c07e127514e4e39",likes_count:0,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:"CircleCI",versions:[]},{name:"自動化",versions:[]},{name:"Firebase",versions:[]},{name:p,versions:[]}],title:"Nuxt.jsを短期間でFirebaseにデプロイしてCircleCIで自動デプロイをするところまでを設定するマニュアル①デプロイまで",updated_at:h,url:"https://qiita.com/KueharX/items/b2636c07e127514e4e39",user:{description:"ブログ始めました。\r\n",facebook_id:n,followees_count:0,followers_count:9,github_login_name:"Kuehar",id:b,items_count:140,linkedin_id:n,location:n,name:"くえはる",organization:n,permanent_id:412789,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/412789/profile-images/1557755211",team_only:a,twitter_screen_name:b,website_url:"https://kueharx.blogspot.com/"},page_views_count:s},{rendered_body:'<p>Vue.jsとTypeScriptの練習のために、Nuxt.jsとNestJSでTodoリストを作ってみました。<br>\n前回Nuxt.jsで作ったフロント側でデータベースからアイテムを生成、読み取り、更新、削除（CRUDって言うんですね）できるようにバックエンド側を作っていきます。データベースサーバはDockerで用意します。</p>\n\n<p>(前編（フロント編）：<a href="https://qiita.com/daitai-daidai/items/36d44f7caaee4841ef34" class="autolink" id="reference-eeae53d45bc2e6e5dc8e">https://qiita.com/daitai-daidai/items/36d44f7caaee4841ef34</a> )</p>\n\n<p>使用技術は以下の通り。</p>\n\n<ul>\n<li>フロントエンド： Nuxt.js (UIフレームワークはVuetify、言語はTypeScript）</li>\n<li>バックエンド： NestJS + typeOrm + mySQL(サーバーはdockerで用意)</li>\n</ul>\n\n<p>TypeScriptでできたサーバーサイドのフレームワークであるNestJSを利用します。日本語のドキュメントがないのが少ししんどいけど僕は英語完全に理解してるのでどーってことありませんでした。（しんどかった。）　細かく書いてあるのでありがたかったです。</p>\n\n<p>公式ドキュメント：<a href="https://docs.nestjs.com/" class="autolink" rel="nofollow noopener" target="_blank">https://docs.nestjs.com/</a></p>\n\n<h3>\n<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h3>\n\n<ul>\n<li>MacOS Catalina v10.15.6</li>\n<li>Node.JS v14.10.1</li>\n<li>Nuxt.js v2.14.5</li>\n<li>NestJS v6.14.8</li>\n<li>Nest CLI v7.0.0</li>\n<li>TypeORM v0.2.27</li>\n<li>Docker v19.03.12</li>\n<li>docker-compose v1.27.2</li>\n</ul>\n\n<h2>\n<span id="今回目指すところ" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E7%9B%AE%E6%8C%87%E3%81%99%E3%81%A8%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>今回目指すところ</h2>\n\n<p>前回作ったページがこんな感じ。（<a href="https://dai65527.github.io/nuxttodo/" class="autolink" rel="nofollow noopener" target="_blank">https://dai65527.github.io/nuxttodo/</a> ）<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a11d37d86c9a06a7544666a65643ebab" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a11d37d86c9a06a7544666a65643ebab" alt="スクリーンショット 2020-09-29 17.14.57.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/8125539e-836d-ffce-71d6-8b02262b5643.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ef1533f01a71fcbf471b329c059d8d51 1x" loading="lazy"></a></p>\n\n<p>このままだと、ページ更新したらまた元に戻ってしまうので、データベースに状態を保存できるように作っていきます。</p>\n\n<p>機能としては、以下の通り、基本的なCRUD機能を実装します。</p>\n\n<ul>\n<li>Create: Todoアイテムの作成。</li>\n<li>Read: 作成済Todoアイテムの読み取り。</li>\n<li>Update: Todoアイテムの状態更新（実行済 or not）。</li>\n<li>Delete: Todoアイテムの削除。実行済アイテムの一斉削除。</li>\n</ul>\n\n<p>なお、今回はローカル環境のみで動かすところまでにします。</p>\n\n<h2>\n<span id="nest-cliでnestjsのプロジェクト作成" class="fragment"></span><a href="#nest-cli%E3%81%A7nestjs%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>Nest CLIでNestJSのプロジェクト作成</h2>\n\n<p>NestJSのプロジェクトは、<a href="https://docs.nestjs.com/cli/overview" rel="nofollow noopener" target="_blank">Nest CLI</a>で簡単に作成できます。今回は<code>tstodo-server</code>というプロジェクトを作成します。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% npm i <span class="nt">-g</span> @nestjs/cli\n% nest new tstodo-server\n</pre></div></div>\n\n<p>npmかyarnかを聞かれるだけで、プロジェクトのフォルダが生成されます。<br>\n（初学者にはcreate-nuxt-appほど怖くなくてよいです。逆に必要なものは自分でインストールします。）</p>\n\n<p>Nest CLIをインストールするのが嫌ならnpxを使ってもOKぽいです。<br>\nただ、この後使うと便利になるので、インストールしちゃうことをおすすめします。</p>\n\n<h3>\n<span id="hello-world" class="fragment"></span><a href="#hello-world"><i class="fa fa-link"></i></a>Hello world</h3>\n\n<p>既に動かせる状態になっているので、とりあえず動かしてみます。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% <span class="nb">cd </span>tstodo-server \n% npm run start\n</pre></div></div>\n\n<p>デフォルトでは<code>localhost:3000</code>が指定されています。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fe10fa3b3-1ef5-9bab-42f6-e3900fb8aaa2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80a93c77b4b01e12629b520f5e228b6b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fe10fa3b3-1ef5-9bab-42f6-e3900fb8aaa2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80a93c77b4b01e12629b520f5e228b6b" alt="スクリーンショット 2020-09-30 15.30.50.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/e10fa3b3-1ef5-9bab-42f6-e3900fb8aaa2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fe10fa3b3-1ef5-9bab-42f6-e3900fb8aaa2.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=745657368471be9f315e2402fa8d8dec 1x" loading="lazy"></a></p>\n\n<p><code>curl</code>コマンドを使うとより玄人っぽい（駆け出し並感）</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% curl http://localhost:3000/\nHello World!\n</pre></div></div>\n\n<h2>\n<span id="プロジェクトフォルダの中身" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E4%B8%AD%E8%BA%AB"><i class="fa fa-link"></i></a>プロジェクトフォルダの中身</h2>\n\n<p>デフォルトでこんな構成になっています。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% tree tstodo-server <span class="nt">-L</span> 1    \ntstodo-server\n├── README.md\n├── dist\n├── nest-cli.json\n├── node_modules\n├── package-lock.json\n├── package.json\n├── src\n├── <span class="nb">test</span>\n├── tsconfig.build.json\n└── tsconfig.json\n</pre></div></div>\n\n<p>メインのコードは基本<code>src</code>直下に書いていきます。デフォルトでは以下。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% tree tstodo-server/src \ntstodo-server/src\n├── app.controller.spec.ts\n├── app.controller.ts\n├── app.module.ts\n├── app.service.ts\n└── main.ts\n</pre></div></div>\n\n<h3>\n<span id="maints" class="fragment"></span><a href="#maints"><i class="fa fa-link"></i></a>main.ts</h3>\n\n<p>main.tsがNestのアプリケーションをCreateするところらしい。<a href="https://docs.nestjs.com/first-steps" rel="nofollow noopener" target="_blank">らしい</a>。<br>\n基本は触らないで良いですが、ポートがフロントとかぶるので変えます。</p>\n\n<p>あと、CORSの設定用もここで追加しました。<code>{ cors: true }</code><br>\nこれを設定しないと、フロント側からアクセスできません。（実際デプロイするときは<a href="https://qiita.com/att55/items/2154a8aad8bf1409db2b" id="reference-fd8ff2c69993e7faffc6">適切に設定したほうがよさそう</a>）</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/main.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">NestFactory</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/core</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.module</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">async</span> <span class="kd">function</span> <span class="nx">bootstrap</span><span class="p">()</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NestFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">AppModule</span><span class="p">,</span> <span class="p">{</span> <span class="na">cors</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>\n  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>   <span class="c1">//default 3000</span>\n<span class="p">}</span>\n<span class="nx">bootstrap</span><span class="p">();</span>\n</pre></div>\n</div>\n\n<p>(参考にさせていただきました: <a href="https://note.com/daitasu/n/nd85a1c72350a" class="autolink" rel="nofollow noopener" target="_blank">https://note.com/daitasu/n/nd85a1c72350a</a>)</p>\n\n<h3>\n<span id="appcontrolts" class="fragment"></span><a href="#appcontrolts"><i class="fa fa-link"></i></a>app.control.ts</h3>\n\n<p>コントローラ。ルーティングと、リクエスト、レスポンスの設定をするのがここです。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/app.control.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">Get</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.service</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Controller</span><span class="p">()</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppController</span> <span class="p">{</span>\n  <span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">readonly</span> <span class="nx">appService</span><span class="p">:</span> <span class="nx">AppService</span><span class="p">)</span> <span class="p">{}</span>\n\n  <span class="p">@</span><span class="nd">Get</span><span class="p">()</span>\n  <span class="nx">getHello</span><span class="p">():</span> <span class="nx">string</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">appService</span><span class="p">.</span><span class="nx">getHello</span><span class="p">();</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p><code>@Controller()</code>デコレータでルーティングの設定、<code>@get</code>デコレータでhttpリクエストメソッドの設定ができます。デフォルトの例だとルート<code>/</code>にGETリクエストを送ると、<code>this.appService.getHello()</code>の返り値をレスポンスとして返す。ってことになります。<br>\n<code>@Controller()</code>と<code>@get()</code>の引数を指定することで、ルーティングを変えられます。例えば、<code>@Controller(hoge)</code>、<code>@get(fuga)</code>に変更した場合、<code>/hoge/fuga/</code>にGETリクエストした場合getHello()が帰ってきます。</p>\n\n<p>（公式ドキュメント：<a href="https://docs.nestjs.com/controllers" class="autolink" rel="nofollow noopener" target="_blank">https://docs.nestjs.com/controllers</a> )</p>\n\n<p>ルートURLについてはとりあえず今回は使わないので、このまま残しておきます。</p>\n\n<h3>\n<span id="appservicets" class="fragment"></span><a href="#appservicets"><i class="fa fa-link"></i></a>app.service.ts</h3>\n\n<p>コントローラで呼び出されていた<code>appService</code>クラスはここで定義されています。データベース等のやりとりも基本はここにメソッドを書けばよいっぽいです。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/app.service.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppService</span> <span class="p">{</span>\n  <span class="nx">getHello</span><span class="p">():</span> <span class="nx">string</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="dl">\'</span><span class="s1">Hello World!</span><span class="dl">\'</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>こういった<code>service</code>などのクラスをNestJSではプロバイダというらしい。<code>@injectable()</code>デコレータをつけて宣言すれば、プロバイダとして扱われます。（<a href="https://docs.nestjs.com/providers" class="autolink" rel="nofollow noopener" target="_blank">https://docs.nestjs.com/providers</a> ）</p>\n\n<h3>\n<span id="appmodulests" class="fragment"></span><a href="#appmodulests"><i class="fa fa-link"></i></a>app.modules.ts</h3>\n\n<p>プロバイダとコントローラをまとめて、モジュール化しているのが<code>modules</code>です。<code>@modules</code>デコレータの引数に<code>controllers</code>やら<code>providers</code>をまとめたオブジェクトを渡します。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/app.modules.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.controller</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.service</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>\n  <span class="na">imports</span><span class="p">:</span> <span class="p">[],</span>\n  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppController</span><span class="p">],</span>\n  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppService</span><span class="p">],</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>\n</pre></div>\n</div>\n\n<p><code>imports</code>は現在空になっていますが、ここには別のモジュールを加えることによって、NestJSの構造が作られていき、<code>app.modules</code>はその頂点となるモジュールになります。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F191176f1-50a2-c622-c5dd-8144b74034ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=98d429eb9b5db1049ac6b65cf9be59d7" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F191176f1-50a2-c622-c5dd-8144b74034ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=98d429eb9b5db1049ac6b65cf9be59d7" alt="スクリーンショット 2020-09-30 19.07.59.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/191176f1-50a2-c622-c5dd-8144b74034ab.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F191176f1-50a2-c622-c5dd-8144b74034ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1b2b6f40e34bd965e45a9d2bef1e046a 1x" loading="lazy"></a><br>\n↑<a href="https://docs.nestjs.com/modules" rel="nofollow noopener" target="_blank">ドキュメント</a>より引用。</p>\n\n<p>(公式ドキュメント：<a href="https://docs.nestjs.com/modules" class="autolink" rel="nofollow noopener" target="_blank">https://docs.nestjs.com/modules</a> )</p>\n\n<p>基本機能はこんな感じで作れるみたいです。このままappモジュールに処理を記述していってもいいですが、今回は、Todoアイテムを操作する機能を持ったitemsモジュール（<code>item.modules.ts</code>）を作成しapp.modulesに追加していきます。</p>\n\n<p>（なお、<code>src</code>ディレクトリには<code>app.controller.spec.ts</code>というテスト用ファイルがありますが、本記事では割愛します。）</p>\n\n<h2>\n<span id="typeormでデータベース操作" class="fragment"></span><a href="#typeorm%E3%81%A7%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E6%93%8D%E4%BD%9C"><i class="fa fa-link"></i></a>TypeOrmでデータベース操作</h2>\n\n<p>NestJSでデータベースを操作するのに、今回は<a href="https://typeorm.io/" rel="nofollow noopener" target="_blank">TypeORM</a>というORMを使用します。（まず、ORMって何？って感じでしたが<a href="https://qiita.com/niisan-tokyo/items/156eb35c6eeaf07b9b65" id="reference-61910055ff05cd6ad1d8">こちらの記事</a>がわかりやすかったです。ありがとうございます。）</p>\n\n<p>NestJSではTypeORM用のパッケージが提供されており、<a href="https://docs.nestjs.com/techniques/database" rel="nofollow noopener" target="_blank">ドキュメントの例</a>でもtypeOrmでmySQLを使用する例が示されています。今回はこの例をベースに作成しました。</p>\n\n<h3>\n<span id="typeormのインストール" class="fragment"></span><a href="#typeorm%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>TypeORMのインストール</h3>\n\n<p>プロジェクトにTypeORMをインストールします。NestJS用のパッケージ<code>@nestjs/typeorm</code>と<code>typeorm</code>と<code>mysql</code>全部をインストールします。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% npm <span class="nb">install</span> @nestjs/typeorm typeorm mysql\n</pre></div></div>\n\n<h3>\n<span id="ormconfigjson" class="fragment"></span><a href="#ormconfigjson"><i class="fa fa-link"></i></a>ormconfig.json</h3>\n\n<p>TypeORMの設定用JSONをプロジェクトのルートに作成します。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">ormconfig.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"database"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tstodo"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"dist/**/*.entity{.ts,.js}"</span><span class="p">],</span><span class="w">\n    </span><span class="nl">"synchronize"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<h3>\n<span id="appmodulesにtypeormmoduleをインポート" class="fragment"></span><a href="#appmodules%E3%81%ABtypeormmodule%E3%82%92%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>app.modulesにTypeOrmModuleをインポート</h3>\n\n<p>TypeORMを使うために<code>app.modules</code>に<code>TypeOrmModule</code>をインポートし、<code>@module</code>の引数のオブジェクトに<code>TypeOrmModule.forRoot()</code>を追加します。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/app.modules.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.controller</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.service</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">TypeOrmModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/typeorm</span><span class="dl">\'</span><span class="p">;</span>  <span class="c1">// TypeOrmModuleをインポート</span>\n\n<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>\n  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">()],</span>   <span class="c1">// TypeOrmModule.forRoot()を追加</span>\n  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppController</span><span class="p">],</span>\n  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppService</span><span class="p">],</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>\n</pre></div>\n</div>\n\n<p>これでTypeORMを使う準備は整いました！！</p>\n\n<h2>\n<span id="todoアイテム操作の機能の実装" class="fragment"></span><a href="#todo%E3%82%A2%E3%82%A4%E3%83%86%E3%83%A0%E6%93%8D%E4%BD%9C%E3%81%AE%E6%A9%9F%E8%83%BD%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>Todoアイテム操作の機能の実装</h2>\n\n<p>前置きが長くなっちゃいましたが、肝心のTodoアイテムを操作する機能（CRUD）の実装をしていきます。<br>\n今回は<code>items.*.ts</code>というtsファイルを<code>items</code>ディレクトリ以下に作成し、Itemsモジュールの中身を作っていきます。</p>\n\n<h3>\n<span id="itemsmodule" class="fragment"></span><a href="#itemsmodule"><i class="fa fa-link"></i></a>itemsModule</h3>\n\n<p>まず、<code>items.module.ts</code>に<code>itemModule</code>クラスを作成します。手動で、ディレクトリとファイルを作成してもいいのですが、Nest CLIの便利コマンドがあるので、それを使っていきましょう。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% nest generate module items\nCREATE src/items/items.module.ts <span class="o">(</span>82 bytes<span class="o">)</span>\nUPDATE src/app.module.ts <span class="o">(</span>460 bytes<span class="o">)</span>\n</pre></div></div>\n\n<p>これだけで、</p>\n\n<ul>\n<li>\n<code>items</code>ディレクトリの作成</li>\n<li>\n<code>items.module.ts</code>の作成</li>\n<li>\n<code>app.modules.ts</code>の更新（インポート文の追加）</li>\n</ul>\n\n<p>を自動でやってくれます。楽！！ （ちなみに<code>nest ge mo items</code>でもOKです。詳しくは:<a href="https://docs.nestjs.com/cli/usages#nest-generate" rel="nofollow noopener" target="_blank">Nest CLI</a>）</p>\n\n<p>↓ItemsModuleが追加されている。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/app.module.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.controller</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">AppService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./app.service</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">TypeOrmModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/typeorm</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ItemsModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./items/items.module</span><span class="dl">\'</span><span class="p">;</span> <span class="c1">//ItemsModuleがインポートされている</span>\n\n<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>\n  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(),</span> <span class="nx">ItemsModule</span><span class="p">],</span>   <span class="c1">// ItemsModuleが追加されている</span>\n  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppController</span><span class="p">],</span>\n  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppService</span><span class="p">],</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>\n</pre></div>\n</div>\n\n<p>この段階では<code>items.modules.ts</code>はまだ空っぽの雛形だけが用意されている状態です。ここにTypeORMのモジュールのimportを記述します。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/items/items.modules.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">TypeOrmModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/typeorm</span><span class="dl">\'</span><span class="p">;</span> <span class="c1">// 追加</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./item.entity</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Module</span><span class="p">({})</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">ItemsModule</span> <span class="p">{</span>\n  <span class="nl">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forFeature</span><span class="p">([</span><span class="nx">Item</span><span class="p">])]</span> <span class="c1">// 追加</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>ひとまずこいつはこれでOK。</p>\n\n<h3>\n<span id="エンティティでカラムを設定する" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3%E3%81%A7%E3%82%AB%E3%83%A9%E3%83%A0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>エンティティでカラムを設定する</h3>\n\n<p>続いては、itemsディレクトリに<code>items.entity.ts</code>を作成して、Todoアイテムのエンティティを作成します。これに基づいて、TypeORMがデータベースに勝手にテーブルを作成してくれます。便利。<br>\n<code>@Entitiy</code>デコレータをつけてクラスを宣言します。そして、各メンバに<code>@Column</code>デコレータを作成すれば、それをカラムにしたテーブルになります。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/items/item.entity</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">PrimaryGeneratedColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">typeorm</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">Item</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">()</span>\n  <span class="nx">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>\n\n  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>\n  <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n\n  <span class="p">@</span><span class="nd">Column</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">false</span> <span class="p">})</span>\n  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>カラムの属性もここで記述します。<br>\nまず、<code>id</code>についている<code>@PrimaryGeneratedColumn</code>デコレータですが、これでプライマリーキーとし、かつオートインクリメントするということが指定できます。なお、各エンティティは必ず一つはプライマリーカラムを作成する必要があるようです。（単に<code>@PrimaryColumn</code>というデコレータもあります）<br>\nまた、<code>done</code>のデコレータの引数では、型とデフォルト値を設定しています。</p>\n\n<p>この内容だと以下のようなテーブルが作成されます。<code>boolean</code>型を指定すると<code>tinyint</code>になるんですね。（そもそもSQLにboolean型と言うのはないらしい）</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| id    | int          | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(255) | NO   |     | NULL    |                |\n| done  | tinyint      | NO   |     | 0       |                |\n+-------+--------------+------+-----+---------+----------------+\n</pre></div></div>\n\n<h3>\n<span id="データベース操作" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E6%93%8D%E4%BD%9C"><i class="fa fa-link"></i></a>データベース操作</h3>\n\n<p>続いて、データベースの操作を記述するメソッドを含んだ<code>ItemsService</code>クラスを作成します。Nest CLIで<code>items.service.ts</code>ファイルを生成します。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% nest generate service items\n</pre></div></div>\n\n<p>このとき、<code>items</code>ディレクトリ以下に、<code>items.Service.ts</code>とともに<code>items.Service.spec.ts</code>というテスト用のファイルも生成されますが、今回は扱いません。（<code>--no-spec</code>オプションを付ければ生成されません。）</p>\n\n<p>生成した<code>itemsService.ts</code>を下記のように編集します。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/items/items.service.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">InjectRepository</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/typeorm</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Repository</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">typeorm</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./item.entity</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">ItemsService</span> <span class="p">{</span>\n  <span class="kd">constructor</span><span class="p">(</span>\n    <span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">Item</span><span class="p">)</span>\n    <span class="kr">private</span> <span class="nx">itemsRepository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">Item</span><span class="o">&gt;</span><span class="p">,</span>\n  <span class="p">)</span> <span class="p">{}</span>\n\n  <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="nx">addItem</span><span class="p">(</span><span class="na">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">name</span><span class="p">});</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="nx">changeDone</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span> <span class="na">done</span><span class="p">:</span> <span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">done</span> <span class="p">});</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="nx">deleteItem</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>\n  <span class="p">}</span>\n\n  <span class="k">async</span> <span class="nx">deleteDone</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsRepository</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span><span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>TypeORMの<code>Repository</code>クラスのメソッドを使えば、SQLクエリを書かなくてもデータベースの操作を行うことができます。</p>\n\n<p>今回は、<code>find</code>、<code>findOne</code>、<code>insert</code>、<code>update</code>、<code>delete</code>だけでこと足りました。（詳しい使い方や、他のメソッドについては、<a href="https://typeorm.io/#/repository-api" rel="nofollow noopener" target="_blank">TypeORMのドキュメント</a>をご参照ください）</p>\n\n<h3>\n<span id="ルーティング" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ルーティング</h3>\n\n<p>最後にItemsControlにルーティングを記述します。serviceの場合と同様に<code>nest generate controller items</code>して、<code>items.controller.ts</code>を生成します。</p>\n\n<p><code>/items/</code>以下にルーティングを作成して、先ほど記述した<code>ItemsService</code>クラスのメソッドを呼び出すようにしていきます。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/items/items.controller.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Body</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">Delete</span><span class="p">,</span> <span class="nx">Get</span><span class="p">,</span> <span class="nx">Param</span><span class="p">,</span> <span class="nx">Post</span><span class="p">,</span> <span class="nx">Put</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ItemsService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./items.service</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./item.entity</span><span class="dl">"</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">\'</span><span class="s1">items</span><span class="dl">\'</span><span class="p">)</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">ItemsController</span> <span class="p">{</span>\n  <span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">itemsService</span><span class="p">:</span> <span class="nx">ItemsService</span><span class="p">)</span> <span class="p">{}</span>\n\n  <span class="p">@</span><span class="nd">Get</span><span class="p">()</span>\n  <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Item</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsService</span><span class="p">.</span><span class="nx">findAll</span><span class="p">();</span>\n  <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Post</span><span class="p">()</span>\n  <span class="k">async</span> <span class="nx">addItem</span><span class="p">(@</span><span class="nd">Body</span><span class="p">()</span> <span class="na">item</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">string</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsService</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>\n  <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Put</span><span class="p">(</span><span class="dl">\'</span><span class="s1">done/:id</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="k">async</span> <span class="nx">changeDone</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">\'</span><span class="s1">id</span><span class="dl">\'</span><span class="p">)</span> <span class="na">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsService</span><span class="p">.</span><span class="nx">changeDone</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>\n  <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Delete</span><span class="p">(</span><span class="dl">\'</span><span class="s1">:id</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="k">async</span> <span class="nx">deleteOne</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">\'</span><span class="s1">id</span><span class="dl">\'</span><span class="p">)</span> <span class="na">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsService</span><span class="p">.</span><span class="nx">deleteItem</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>\n  <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Delete</span><span class="p">()</span>\n  <span class="k">async</span> <span class="nx">deleteDone</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsService</span><span class="p">.</span><span class="nx">deleteDone</span><span class="p">();</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>ルートパラメータは<code>@Param</code>デコレータ、POSTで送られてくるデータは<code>@Body</code>デコレータを使って取得できます。（ちなみに、GETのデータは<code>@Query</code>です。詳しくは：<a href="https://docs.nestjs.com/controllers#request-object" rel="nofollow noopener" target="_blank">ドキュメント</a>）</p>\n\n<h3>\n<span id="itemsmodulestsにserviceとcontrollerが勝手にインポートされている" class="fragment"></span><a href="#itemsmodulests%E3%81%ABservice%E3%81%A8controller%E3%81%8C%E5%8B%9D%E6%89%8B%E3%81%AB%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>items.modules.tsにserviceとcontrollerが勝手にインポートされている</h3>\n\n<p><code>items.service.ts</code>と<code>items.controller.ts</code>を生成した際に、Nest CLIが<code>items.modules.ts</code>に勝手にインポートしてくれています。有能。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">src/items/items.module.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/common</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">TypeOrmModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nestjs/typeorm</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Item</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./item.entity</span><span class="dl">"</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ItemsService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./items.service</span><span class="dl">\'</span><span class="p">;</span>       <span class="c1">// 勝手にインポート</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">ItemsController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./items.controller</span><span class="dl">\'</span><span class="p">;</span> <span class="c1">// 勝手にインポート</span>\n\n<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>\n  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forFeature</span><span class="p">([</span><span class="nx">Item</span><span class="p">])],</span>\n  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">ItemsService</span><span class="p">],</span>        <span class="c1">// 勝手に追加</span>\n  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">ItemsController</span><span class="p">]</span>    <span class="c1">// 勝手に追加</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="kd">class</span> <span class="nx">ItemsModule</span> <span class="p">{}</span>\n</pre></div>\n</div>\n\n<p>これで、NestJS側の作成は終了です。</p>\n\n<h2>\n<span id="フロントnuxtjs側の修正" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88nuxtjs%E5%81%B4%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>フロント(Nuxt.js)側の修正</h2>\n\n<p>前回作成したフロント側をnuxt.jsのaxiosモジュール<code>@nuxtjs/axios</code>を使ってhttp通信で取得できるようにします。<br>\n前回、create-nuxt-appでaxiosを選択されていれば、<code>@nuxtjs/axios</code>が既にインストールされているはずです。</p>\n\n<p>されていない場合は、</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>% npm install @nuxtjs/axios\n</pre></div></div>\n\n<p>して、<code>nuxt.config.ts</code>でmodulesに追加します。</p>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">@/nuxt.config.ts</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="p">(</span><span class="err">略</span><span class="p">)</span>\n  <span class="na">modules</span><span class="p">:</span> <span class="p">[</span>\n    <span class="dl">\'</span><span class="s1">@nuxtjs/axios</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">],</span>\n  <span class="p">(</span><span class="err">略</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<h3>\n<span id="axiosの型定義の追加" class="fragment"></span><a href="#axios%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>axiosの型定義の追加</h3>\n\n<p>TypeScirptでaxiosモジュールを利用するには、<code>tsconfig.json</code>に型定義を追加する必要があります。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">@/tsconfig.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="err">(略)</span><span class="w">\n    </span><span class="nl">"types"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"@types/node"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"@nuxt/types"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"@nuxtjs/axios"</span><span class="w">\n    </span><span class="p">]</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="err">(略)</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<h3>\n<span id="indexvueの修正" class="fragment"></span><a href="#indexvue%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>index.vueの修正</h3>\n\n<p><code>@/pages/index.vue</code>を以下のように修正します。</p>\n\n<ul>\n<li>Todoアイテムの操作を行うメソッドをaxiosを使ってデータベース操作をするよう書き直し</li>\n<li>データベースからアイテムを全て取得する<code>getItems</code>メソッド追加</li>\n<li>\n<code>mounted</code>時に<code>getItem</code>メソッドを実行し全アイテムを取得</li>\n</ul>\n\n<div class="code-frame" data-lang="ts">\n<div class="code-lang"><span class="bold">@/pages/index.vue</span></div>\n<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>\n  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">container</span> <span class="kd">class</span><span class="o">=</span><span class="dl">"</span><span class="s2">pt-10</span><span class="dl">"</span><span class="o">&gt;</span>\n    <span class="o">&lt;</span><span class="nx">List</span>\n      <span class="p">:</span><span class="nx">items</span><span class="o">=</span><span class="dl">"</span><span class="s2">items</span><span class="dl">"</span>\n      <span class="p">@</span><span class="nd">add</span><span class="o">-</span><span class="nx">item</span><span class="o">=</span><span class="dl">"</span><span class="s2">addItem</span><span class="dl">"</span>\n      <span class="p">@</span><span class="nd">change</span><span class="o">-</span><span class="nx">done</span><span class="o">=</span><span class="dl">"</span><span class="s2">changeDone</span><span class="dl">"</span>\n      <span class="p">@</span><span class="nd">delete</span><span class="o">-</span><span class="nx">item</span><span class="o">=</span><span class="dl">"</span><span class="s2">deleteItem</span><span class="dl">"</span>\n      <span class="p">@</span><span class="nd">delete</span><span class="o">-</span><span class="nx">done</span><span class="o">=</span><span class="dl">"</span><span class="s2">deleteDone</span><span class="dl">"</span>\n    <span class="o">/&gt;</span>\n  <span class="o">&lt;</span><span class="sr">/v-container</span><span class="err">&gt;\n</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;\n</span>\n<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="o">&gt;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Item</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/models/Item</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">List</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/List.vue</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">List</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">data</span><span class="p">:</span> <span class="p">():</span> <span class="p">{</span> <span class="na">items</span><span class="p">:</span> <span class="nx">Item</span><span class="p">[]</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">({</span>\n    <span class="na">items</span><span class="p">:</span> <span class="p">[],</span>\n  <span class="p">}),</span>\n  <span class="k">async</span> <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItems</span><span class="p">()</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="k">async</span> <span class="nx">getItems</span><span class="p">()</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">http://localhost:4000/items/</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>\n    <span class="p">},</span>\n    <span class="k">async</span> <span class="nx">addItem</span><span class="p">(</span><span class="na">itemName</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`http://localhost:4000/items/`</span><span class="p">,</span> <span class="p">{</span>\n        <span class="na">name</span><span class="p">:</span> <span class="nx">itemName</span><span class="p">,</span>\n      <span class="p">})</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItems</span><span class="p">()</span>\n    <span class="p">},</span>\n    <span class="k">async</span> <span class="nx">changeDone</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s2">`http://localhost:4000/items/done/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">/`</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="k">async</span> <span class="nx">deleteItem</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s2">`http://localhost:4000/items/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">/`</span><span class="p">)</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItems</span><span class="p">()</span>\n    <span class="p">},</span>\n    <span class="k">async</span> <span class="nx">deleteDone</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s2">`http://localhost:4000/items/`</span><span class="p">)</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getItems</span><span class="p">()</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></pre></div>\n</div>\n\n<p>axiosは<code>this.$axios</code>で呼び出せます。axiosモジュールの使い方は<a href="https://axios.nuxtjs.org/usage" rel="nofollow noopener" target="_blank">ここ</a>が詳しかったです。<code>get</code>メソッドの代わりに<code>＄get</code>メソッドを使えばさらにシンプルに書けたりします。</p>\n\n<p>これで、フロント側の修正は終わりです。</p>\n\n<h2>\n<span id="dockerでmysqlコンテナを用意" class="fragment"></span><a href="#docker%E3%81%A7mysql%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>DockerでMySQLコンテナを用意</h2>\n\n<p>続いてデータベースを用意します。<br>\nせっかくなので、Dockerの勉強もしてみようと思い、MySQLのコンテナを用意します。</p>\n\n<h3>\n<span id="docker-composeyml" class="fragment"></span><a href="#docker-composeyml"><i class="fa fa-link"></i></a>docker-compose.yml</h3>\n\n<p><a href="https://hub.docker.com/_/mysql" rel="nofollow noopener" target="_blank">docker hubのmysqlのイメージ</a>を流用してみます。<br>\n適当な（いい意味で）ディレクトリに以下のファイルを作成します。</p>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">docker-compose.yml</span></div>\n<div class="highlight"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.1"</span>\n<span class="na">services</span><span class="pi">:</span>\n  <span class="na">db</span><span class="pi">:</span>\n    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>\n    <span class="na">command</span><span class="pi">:</span> <span class="s">--default-authentication-plugin=mysql_native_password</span>\n    <span class="na">environment</span><span class="pi">:</span>\n      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>\n      <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">tstodo</span>\n    <span class="na">ports</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="s">3306:3306</span>\n</pre></div>\n</div>\n\n<p><code>MYSQL_DATABASE: tstodo</code>を追加してやれば、コンテナ作成時に勝手にテーブル作ってくれます。というわけで、これだけでOK。</p>\n\n<p>docker-composeについてはここがわかりやすかったです。（<a href="https://futureys.tokyo/lets-run-the-web-application-for-development-by-docker-desktop-and-access-it-by-browser/%E3%80%80%EF%BC%89" class="autolink" rel="nofollow noopener" target="_blank">https://futureys.tokyo/lets-run-the-web-application-for-development-by-docker-desktop-and-access-it-by-browser/　）</a></p>\n\n<h2>\n<span id="動かしてみる" class="fragment"></span><a href="#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>動かしてみる</h2>\n\n<p>必要なものが一通り揃ったので動かしてみます。</p>\n\n<p>まず、先ほど作った<code>docker-compose.yml</code>があるディレクトリで、以下を実行。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% docker-compose up <span class="nt">-d</span>\n</pre></div></div>\n\n<p>続いて、<code>tstodo-server</code>のディレクトリで以下を実行。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% npm run start:dev\n</pre></div></div>\n\n<p>そして、<code>tstodo-client</code>のディレクトリで以下を実行。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% npm run dev\n</pre></div></div>\n\n<p>ブラウザで<code>localhost:3000</code>にアクセスします。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F9e92a0fc-71e6-2cc2-8859-5f3f926e50fa.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f35d42b4cce16ca9954a450b67567c1b" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F9e92a0fc-71e6-2cc2-8859-5f3f926e50fa.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f35d42b4cce16ca9954a450b67567c1b" alt="スクリーンショット 2020-10-01 16.25.33.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/9e92a0fc-71e6-2cc2-8859-5f3f926e50fa.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F9e92a0fc-71e6-2cc2-8859-5f3f926e50fa.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a6594873fc53991908e44973e4c31638 1x" loading="lazy"></a><br>\n動いてるっぽい。アイテム追加して、実行済みのチェックをつけてみます。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F85466fbc-ed29-3bba-825c-8ca79c3641fd.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7f0998aa2db3efd532bf9f07f4cba5d1" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F85466fbc-ed29-3bba-825c-8ca79c3641fd.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7f0998aa2db3efd532bf9f07f4cba5d1" alt="スクリーンショット 2020-10-01 16.26.46.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/85466fbc-ed29-3bba-825c-8ca79c3641fd.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F85466fbc-ed29-3bba-825c-8ca79c3641fd.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3cfd5287671adde58deeba628e15ddde 1x" loading="lazy"></a><br>\nここで、ちゃんとMySQLにテーブルができているか確認してみましょう。（コンテナIDは<code>docker ps</code>コマンドで確認できます）</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>% docker exec -it &lt;コンテナID&gt; /bin/bash\n# mysql -uroot -p\n\nmysql&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n| tstodo             |\n+--------------------+\n5 rows in set (0.01 sec)\n\nmysql&gt; use tstodo;\nmysql&gt; describe item;\n+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| id    | int          | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(255) | NO   |     | NULL    |                |\n| done  | tinyint      | NO   |     | 0       |                |\n+-------+--------------+------+-----+---------+----------------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from item;\n+----+--------+------+\n| id | name   | done |\n+----+--------+------+\n|  1 | item 1 |    0 |\n|  2 | item2  |    1 |\n|  3 | item3  |    0 |\n+----+--------+------+\n3 rows in set (0.00 sec)\n</pre></div></div>\n\n<p>正常に動いていそうです！！ アイテムの追加、削除も動きます。もちろん更新しても元どおりなんてことはありません。</p>\n\n<h2>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>\n\n<p>NestJSを使ってTodoリストのバックエンド側を作成しました。TypeORMやDockerなどにも触れられていい勉強になりました！！</p>\n\n<h3>\n<span id="コード" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コード</h3>\n\n<ul>\n<li>フロントエンド： <a href="https://github.com/dai65527/tstodo-client" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dai65527/tstodo-client</a>\n</li>\n<li>バックエンド： <a href="https://github.com/dai65527/tstodo_server" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dai65527/tstodo_server</a>\n</li>\n<li>完成品（こちらは見た目だけ）: <a href="https://dai65527.github.io/nuxttodo/" class="autolink" rel="nofollow noopener" target="_blank">https://dai65527.github.io/nuxttodo/</a>\n</li>\n</ul>\n\n<p>ここ変だぞ？ とか、ここもっとよくなるぞ？ ってとことかありましたらコメント等で教えていただけますと幸いです！！</p>\n\n<h3>\n<span id="次は" class="fragment"></span><a href="#%E6%AC%A1%E3%81%AF"><i class="fa fa-link"></i></a>次は</h3>\n\n<p>開発環境を全てDocker化したり、ログイン機能とかつけてデプロイすることに挑戦します。駆け出しの冒険は続く。</p>\n\n<h3>\n<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h3>\n\n<p>誰か仕事ください。</p>\n',body:"Vue.jsとTypeScriptの練習のために、Nuxt.jsとNestJSでTodoリストを作ってみました。\n前回Nuxt.jsで作ったフロント側でデータベースからアイテムを生成、読み取り、更新、削除（CRUDって言うんですね）できるようにバックエンド側を作っていきます。データベースサーバはDockerで用意します。\n\n(前編（フロント編）：https://qiita.com/daitai-daidai/items/36d44f7caaee4841ef34 )\n\n使用技術は以下の通り。\n\n- フロントエンド： Nuxt.js (UIフレームワークはVuetify、言語はTypeScript）\n- バックエンド： NestJS + typeOrm + mySQL(サーバーはdockerで用意)\n\nTypeScriptでできたサーバーサイドのフレームワークであるNestJSを利用します。日本語のドキュメントがないのが少ししんどいけど僕は英語完全に理解してるのでどーってことありませんでした。（しんどかった。）　細かく書いてあるのでありがたかったです。\n\n公式ドキュメント：https://docs.nestjs.com/\n\n### 環境\n- MacOS Catalina v10.15.6\n- Node.JS v14.10.1\n- Nuxt.js v2.14.5\n- NestJS v6.14.8\n- Nest CLI v7.0.0\n- TypeORM v0.2.27\n- Docker v19.03.12\n- docker-compose v1.27.2\n\n## 今回目指すところ\n前回作ったページがこんな感じ。（https://dai65527.github.io/nuxttodo/ ）\n![スクリーンショット 2020-09-29 17.14.57.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/8125539e-836d-ffce-71d6-8b02262b5643.png)\n\nこのままだと、ページ更新したらまた元に戻ってしまうので、データベースに状態を保存できるように作っていきます。\n\n機能としては、以下の通り、基本的なCRUD機能を実装します。\n\n- Create: Todoアイテムの作成。\n- Read: 作成済Todoアイテムの読み取り。\n- Update: Todoアイテムの状態更新（実行済 or not）。\n- Delete: Todoアイテムの削除。実行済アイテムの一斉削除。\n\nなお、今回はローカル環境のみで動かすところまでにします。\n\n## Nest CLIでNestJSのプロジェクト作成\nNestJSのプロジェクトは、[Nest CLI](https://docs.nestjs.com/cli/overview)で簡単に作成できます。今回は`tstodo-server`というプロジェクトを作成します。\n\n```zsh\n% npm i -g @nestjs/cli\n% nest new tstodo-server\n```\n\nnpmかyarnかを聞かれるだけで、プロジェクトのフォルダが生成されます。\n（初学者にはcreate-nuxt-appほど怖くなくてよいです。逆に必要なものは自分でインストールします。）\n\nNest CLIをインストールするのが嫌ならnpxを使ってもOKぽいです。\nただ、この後使うと便利になるので、インストールしちゃうことをおすすめします。\n\n### Hello world\n既に動かせる状態になっているので、とりあえず動かしてみます。\n\n```zsh\n% cd tstodo-server \n% npm run start\n```\n\nデフォルトでは`localhost:3000`が指定されています。\n\n![スクリーンショット 2020-09-30 15.30.50.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/e10fa3b3-1ef5-9bab-42f6-e3900fb8aaa2.png)\n\n`curl`コマンドを使うとより玄人っぽい（駆け出し並感）\n\n```zsh\n% curl http://localhost:3000/\nHello World!\n```\n\n## プロジェクトフォルダの中身\nデフォルトでこんな構成になっています。\n\n```zsh\n% tree tstodo-server -L 1    \ntstodo-server\n├── README.md\n├── dist\n├── nest-cli.json\n├── node_modules\n├── package-lock.json\n├── package.json\n├── src\n├── test\n├── tsconfig.build.json\n└── tsconfig.json\n```\n\nメインのコードは基本`src`直下に書いていきます。デフォルトでは以下。\n\n```zsh\n% tree tstodo-server/src \ntstodo-server/src\n├── app.controller.spec.ts\n├── app.controller.ts\n├── app.module.ts\n├── app.service.ts\n└── main.ts\n```\n\n### main.ts\nmain.tsがNestのアプリケーションをCreateするところらしい。[らしい](https://docs.nestjs.com/first-steps)。\n基本は触らないで良いですが、ポートがフロントとかぶるので変えます。\n\nあと、CORSの設定用もここで追加しました。`{ cors: true }`\nこれを設定しないと、フロント側からアクセスできません。（実際デプロイするときは[適切に設定したほうがよさそう](https://qiita.com/att55/items/2154a8aad8bf1409db2b)）\n\n```ts:src/main.ts\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule, { cors: true });\n  await app.listen(4000);   //default 3000\n}\nbootstrap();\n```\n\n(参考にさせていただきました: https://note.com/daitasu/n/nd85a1c72350a)\n\n### app.control.ts\nコントローラ。ルーティングと、リクエスト、レスポンスの設定をするのがここです。\n\n```ts:src/app.control.ts\nimport { Controller, Get } from '@nestjs/common';\nimport { AppService } from './app.service';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Get()\n  getHello(): string {\n    return this.appService.getHello();\n  }\n}\n```\n\n`@Controller()`デコレータでルーティングの設定、`@get`デコレータでhttpリクエストメソッドの設定ができます。デフォルトの例だとルート`/`にGETリクエストを送ると、`this.appService.getHello()`の返り値をレスポンスとして返す。ってことになります。\n`@Controller()`と`@get()`の引数を指定することで、ルーティングを変えられます。例えば、`@Controller(hoge)`、`@get(fuga)`に変更した場合、`/hoge/fuga/`にGETリクエストした場合getHello()が帰ってきます。\n\n（公式ドキュメント：https://docs.nestjs.com/controllers )\n\nルートURLについてはとりあえず今回は使わないので、このまま残しておきます。\n\n### app.service.ts\nコントローラで呼び出されていた`appService`クラスはここで定義されています。データベース等のやりとりも基本はここにメソッドを書けばよいっぽいです。\n\n```ts:src/app.service.ts\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AppService {\n  getHello(): string {\n    return 'Hello World!';\n  }\n}\n```\n\nこういった`service`などのクラスをNestJSではプロバイダというらしい。`@injectable()`デコレータをつけて宣言すれば、プロバイダとして扱われます。（https://docs.nestjs.com/providers ）\n\n### app.modules.ts\nプロバイダとコントローラをまとめて、モジュール化しているのが`modules`です。`@modules`デコレータの引数に`controllers`やら`providers`をまとめたオブジェクトを渡します。\n\n```ts:src/app.modules.ts\nimport { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\n\n@Module({\n  imports: [],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n```\n\n`imports`は現在空になっていますが、ここには別のモジュールを加えることによって、NestJSの構造が作られていき、`app.modules`はその頂点となるモジュールになります。\n![スクリーンショット 2020-09-30 19.07.59.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/191176f1-50a2-c622-c5dd-8144b74034ab.png)\n↑[ドキュメント](https://docs.nestjs.com/modules)より引用。\n\n(公式ドキュメント：https://docs.nestjs.com/modules )\n\n基本機能はこんな感じで作れるみたいです。このままappモジュールに処理を記述していってもいいですが、今回は、Todoアイテムを操作する機能を持ったitemsモジュール（`item.modules.ts`）を作成しapp.modulesに追加していきます。\n\n（なお、`src`ディレクトリには`app.controller.spec.ts`というテスト用ファイルがありますが、本記事では割愛します。）\n\n## TypeOrmでデータベース操作\nNestJSでデータベースを操作するのに、今回は[TypeORM](https://typeorm.io/)というORMを使用します。（まず、ORMって何？って感じでしたが[こちらの記事](https://qiita.com/niisan-tokyo/items/156eb35c6eeaf07b9b65)がわかりやすかったです。ありがとうございます。）\n\nNestJSではTypeORM用のパッケージが提供されており、[ドキュメントの例](https://docs.nestjs.com/techniques/database)でもtypeOrmでmySQLを使用する例が示されています。今回はこの例をベースに作成しました。\n\n### TypeORMのインストール\nプロジェクトにTypeORMをインストールします。NestJS用のパッケージ`@nestjs/typeorm`と`typeorm`と`mysql`全部をインストールします。\n\n```zsh\n% npm install @nestjs/typeorm typeorm mysql\n```\n\n### ormconfig.json\nTypeORMの設定用JSONをプロジェクトのルートに作成します。\n\n```json:ormconfig.json\n{\n    \"type\": \"mysql\",\n    \"host\": \"localhost\",\n    \"port\": 3306,\n    \"username\": \"root\",\n    \"password\": \"password\",\n    \"database\": \"tstodo\",\n    \"entities\": [\"dist/**/*.entity{.ts,.js}\"],\n    \"synchronize\": true\n}\n```\n\n### app.modulesにTypeOrmModuleをインポート\nTypeORMを使うために`app.modules`に`TypeOrmModule`をインポートし、`@module`の引数のオブジェクトに`TypeOrmModule.forRoot()`を追加します。\n\n```ts:src/app.modules.ts\nimport { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { TypeOrmModule } from '@nestjs/typeorm';  // TypeOrmModuleをインポート\n\n@Module({\n  imports: [TypeOrmModule.forRoot()],   // TypeOrmModule.forRoot()を追加\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n```\n\nこれでTypeORMを使う準備は整いました！！\n\n## Todoアイテム操作の機能の実装\n前置きが長くなっちゃいましたが、肝心のTodoアイテムを操作する機能（CRUD）の実装をしていきます。\n今回は`items.*.ts`というtsファイルを`items`ディレクトリ以下に作成し、Itemsモジュールの中身を作っていきます。\n\n### itemsModule\nまず、`items.module.ts`に`itemModule`クラスを作成します。手動で、ディレクトリとファイルを作成してもいいのですが、Nest CLIの便利コマンドがあるので、それを使っていきましょう。\n\n```zsh\n% nest generate module items\nCREATE src/items/items.module.ts (82 bytes)\nUPDATE src/app.module.ts (460 bytes)\n```\n\nこれだけで、\n\n- `items`ディレクトリの作成\n- `items.module.ts`の作成\n- `app.modules.ts`の更新（インポート文の追加）\n\nを自動でやってくれます。楽！！ （ちなみに`nest ge mo items`でもOKです。詳しくは:[Nest CLI](https://docs.nestjs.com/cli/usages#nest-generate)）\n\n↓ItemsModuleが追加されている。\n\n```ts:src/app.module.ts\nimport { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { ItemsModule } from './items/items.module'; //ItemsModuleがインポートされている\n\n@Module({\n  imports: [TypeOrmModule.forRoot(), ItemsModule],   // ItemsModuleが追加されている\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n```\n\nこの段階では`items.modules.ts`はまだ空っぽの雛形だけが用意されている状態です。ここにTypeORMのモジュールのimportを記述します。\n\n```ts:src/items/items.modules.ts\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm'; // 追加\nimport { Item } from \"./item.entity\";\n\n@Module({})\nexport class ItemsModule {\n  imports: [TypeOrmModule.forFeature([Item])] // 追加\n}\n```\n\nひとまずこいつはこれでOK。\n\n### エンティティでカラムを設定する\n続いては、itemsディレクトリに`items.entity.ts`を作成して、Todoアイテムのエンティティを作成します。これに基づいて、TypeORMがデータベースに勝手にテーブルを作成してくれます。便利。\n`@Entitiy`デコレータをつけてクラスを宣言します。そして、各メンバに`@Column`デコレータを作成すれば、それをカラムにしたテーブルになります。\n\n```ts:src/items/item.entity\nimport { Entity, Column, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class Item {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  name: string;\n\n  @Column({ type: \"boolean\", default: false })\n  done: boolean;\n}\n```\n\nカラムの属性もここで記述します。\nまず、`id`についている`@PrimaryGeneratedColumn`デコレータですが、これでプライマリーキーとし、かつオートインクリメントするということが指定できます。なお、各エンティティは必ず一つはプライマリーカラムを作成する必要があるようです。（単に`@PrimaryColumn`というデコレータもあります）\nまた、`done`のデコレータの引数では、型とデフォルト値を設定しています。\n\nこの内容だと以下のようなテーブルが作成されます。`boolean`型を指定すると`tinyint`になるんですね。（そもそもSQLにboolean型と言うのはないらしい）\n\n```\n+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| id    | int          | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(255) | NO   |     | NULL    |                |\n| done  | tinyint      | NO   |     | 0       |                |\n+-------+--------------+------+-----+---------+----------------+\n```\n\n### データベース操作\n続いて、データベースの操作を記述するメソッドを含んだ`ItemsService`クラスを作成します。Nest CLIで`items.service.ts`ファイルを生成します。\n\n```zsh\n% nest generate service items\n```\n\nこのとき、`items`ディレクトリ以下に、`items.Service.ts`とともに`items.Service.spec.ts`というテスト用のファイルも生成されますが、今回は扱いません。（`--no-spec`オプションを付ければ生成されません。）\n\n生成した`itemsService.ts`を下記のように編集します。\n\n```ts:src/items/items.service.ts\nimport { Injectable } from '@nestjs/common';\nimport { InjectRepository } from \"@nestjs/typeorm\";\nimport { Repository } from \"typeorm\";\nimport { Item } from \"./item.entity\";\n\n@Injectable()\nexport class ItemsService {\n  constructor(\n    @InjectRepository(Item)\n    private itemsRepository: Repository<Item>,\n  ) {}\n\n  findAll(): Promise<Item[]> {\n    return this.itemsRepository.find();\n  }\n\n  async addItem(name: string): Promise<void> {\n    await this.itemsRepository.insert({name});\n  }\n\n  async changeDone(id: string): Promise<void> {\n    const item = await this.itemsRepository.findOne(id);\n    await this.itemsRepository.update(id, { done: !item.done });\n  }\n\n  async deleteItem(id: string): Promise<void> {\n    await this.itemsRepository.delete(id);\n  }\n\n  async deleteDone(): Promise<void> {\n    await this.itemsRepository.delete({done: true})\n  }\n}\n```\n\nTypeORMの`Repository`クラスのメソッドを使えば、SQLクエリを書かなくてもデータベースの操作を行うことができます。\n\n今回は、`find`、`findOne`、`insert`、`update`、`delete`だけでこと足りました。（詳しい使い方や、他のメソッドについては、[TypeORMのドキュメント](https://typeorm.io/#/repository-api)をご参照ください）\n\n### ルーティング\n最後にItemsControlにルーティングを記述します。serviceの場合と同様に`nest generate controller items`して、`items.controller.ts`を生成します。\n\n`/items/`以下にルーティングを作成して、先ほど記述した`ItemsService`クラスのメソッドを呼び出すようにしていきます。\n\n```ts:src/items/items.controller.ts\nimport { Body, Controller, Delete, Get, Param, Post, Put } from '@nestjs/common';\nimport { ItemsService } from \"./items.service\";\nimport { Item } from \"./item.entity\";\n\n@Controller('items')\nexport class ItemsController {\n  constructor(private itemsService: ItemsService) {}\n\n  @Get()\n  findAll(): Promise<Item[]> {\n    return this.itemsService.findAll();\n  }\n\n  @Post()\n  async addItem(@Body() item: { name: string }) {\n    return await this.itemsService.addItem(item.name);\n  }\n\n  @Put('done/:id')\n  async changeDone(@Param('id') id: string): Promise<void> {\n    return await this.itemsService.changeDone(id);\n  }\n\n  @Delete(':id')\n  async deleteOne(@Param('id') id: string): Promise<void> {\n    return await this.itemsService.deleteItem(id);\n  }\n\n  @Delete()\n  async deleteDone(): Promise<void> {\n    return await this.itemsService.deleteDone();\n  }\n}\n```\n\nルートパラメータは`@Param`デコレータ、POSTで送られてくるデータは`@Body`デコレータを使って取得できます。（ちなみに、GETのデータは`@Query`です。詳しくは：[ドキュメント](https://docs.nestjs.com/controllers#request-object)）\n\n### items.modules.tsにserviceとcontrollerが勝手にインポートされている\n`items.service.ts`と`items.controller.ts`を生成した際に、Nest CLIが`items.modules.ts`に勝手にインポートしてくれています。有能。\n\n```ts:src/items/items.module.ts\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { Item } from \"./item.entity\";\nimport { ItemsService } from './items.service';       // 勝手にインポート\nimport { ItemsController } from './items.controller'; // 勝手にインポート\n\n@Module({\n  imports: [TypeOrmModule.forFeature([Item])],\n  providers: [ItemsService],        // 勝手に追加\n  controllers: [ItemsController]    // 勝手に追加\n})\nexport class ItemsModule {}\n```\n\nこれで、NestJS側の作成は終了です。\n\n## フロント(Nuxt.js)側の修正\n前回作成したフロント側をnuxt.jsのaxiosモジュール`@nuxtjs/axios`を使ってhttp通信で取得できるようにします。\n前回、create-nuxt-appでaxiosを選択されていれば、`@nuxtjs/axios`が既にインストールされているはずです。\n\nされていない場合は、\n\n```\n% npm install @nuxtjs/axios\n```\n\nして、`nuxt.config.ts`でmodulesに追加します。\n\n```ts:@/nuxt.config.ts\nexport default {\n  (略)\n  modules: [\n    '@nuxtjs/axios',\n  ],\n  (略)\n}\n```\n\n\n### axiosの型定義の追加\nTypeScirptでaxiosモジュールを利用するには、`tsconfig.json`に型定義を追加する必要があります。\n\n```json:@/tsconfig.json\n{\n  \"compilerOptions\": {\n    (略)\n    \"types\": [\n      \"@types/node\",\n      \"@nuxt/types\",\n      \"@nuxtjs/axios\"\n    ]\n  },\n  (略)\n}\n```\n\n### index.vueの修正\n`@/pages/index.vue`を以下のように修正します。\n\n- Todoアイテムの操作を行うメソッドをaxiosを使ってデータベース操作をするよう書き直し\n- データベースからアイテムを全て取得する`getItems`メソッド追加\n- `mounted`時に`getItem`メソッドを実行し全アイテムを取得\n\n```ts:@/pages/index.vue\n<template>\n  <v-container class=\"pt-10\">\n    <List\n      :items=\"items\"\n      @add-item=\"addItem\"\n      @change-done=\"changeDone\"\n      @delete-item=\"deleteItem\"\n      @delete-done=\"deleteDone\"\n    />\n  </v-container>\n</template>\n\n<script lang=\"ts\">\nimport Vue from 'vue'\nimport Item from '@/models/Item'\nimport List from '@/components/List.vue'\n\nexport default Vue.extend({\n  components: {\n    List,\n  },\n  data: (): { items: Item[] } => ({\n    items: [],\n  }),\n  async created() {\n    await this.getItems()\n  },\n  methods: {\n    async getItems() {\n      const res = await this.$axios.get('http://localhost:4000/items/')\n      this.items = res.data\n    },\n    async addItem(itemName: string) {\n      await this.$axios.post(`http://localhost:4000/items/`, {\n        name: itemName,\n      })\n      await this.getItems()\n    },\n    async changeDone(id: number) {\n      await this.$axios.put(`http://localhost:4000/items/done/${id}/`)\n    },\n    async deleteItem(id: number) {\n      await this.$axios.delete(`http://localhost:4000/items/${id}/`)\n      await this.getItems()\n    },\n    async deleteDone() {\n      await this.$axios.delete(`http://localhost:4000/items/`)\n      await this.getItems()\n    },\n  },\n})\n<\/script>\n```\n\naxiosは`this.$axios`で呼び出せます。axiosモジュールの使い方は[ここ](https://axios.nuxtjs.org/usage)が詳しかったです。`get`メソッドの代わりに`＄get`メソッドを使えばさらにシンプルに書けたりします。\n\nこれで、フロント側の修正は終わりです。\n\n## DockerでMySQLコンテナを用意\n続いてデータベースを用意します。\nせっかくなので、Dockerの勉強もしてみようと思い、MySQLのコンテナを用意します。\n\n### docker-compose.yml\n[docker hubのmysqlのイメージ](https://hub.docker.com/_/mysql)を流用してみます。\n適当な（いい意味で）ディレクトリに以下のファイルを作成します。\n\n```yaml:docker-compose.yml\nversion: \"3.1\"\nservices:\n  db:\n    image: mysql\n    command: --default-authentication-plugin=mysql_native_password\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n      MYSQL_DATABASE: tstodo\n    ports:\n      - 3306:3306\n```\n\n`MYSQL_DATABASE: tstodo`を追加してやれば、コンテナ作成時に勝手にテーブル作ってくれます。というわけで、これだけでOK。\n\ndocker-composeについてはここがわかりやすかったです。（https://futureys.tokyo/lets-run-the-web-application-for-development-by-docker-desktop-and-access-it-by-browser/　）\n\n## 動かしてみる\n必要なものが一通り揃ったので動かしてみます。\n\nまず、先ほど作った`docker-compose.yml`があるディレクトリで、以下を実行。\n\n```zsh\n% docker-compose up -d\n```\n\n続いて、`tstodo-server`のディレクトリで以下を実行。\n\n```zsh\n% npm run start:dev\n```\n\nそして、`tstodo-client`のディレクトリで以下を実行。\n\n```zsh\n% npm run dev\n```\n\nブラウザで`localhost:3000`にアクセスします。\n![スクリーンショット 2020-10-01 16.25.33.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/9e92a0fc-71e6-2cc2-8859-5f3f926e50fa.png)\n動いてるっぽい。アイテム追加して、実行済みのチェックをつけてみます。\n![スクリーンショット 2020-10-01 16.26.46.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/85466fbc-ed29-3bba-825c-8ca79c3641fd.png)\nここで、ちゃんとMySQLにテーブルができているか確認してみましょう。（コンテナIDは`docker ps`コマンドで確認できます）\n\n```\n% docker exec -it <コンテナID> /bin/bash\n# mysql -uroot -p\n\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n| tstodo             |\n+--------------------+\n5 rows in set (0.01 sec)\n\nmysql> use tstodo;\nmysql> describe item;\n+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| id    | int          | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(255) | NO   |     | NULL    |                |\n| done  | tinyint      | NO   |     | 0       |                |\n+-------+--------------+------+-----+---------+----------------+\n3 rows in set (0.00 sec)\n\nmysql> select * from item;\n+----+--------+------+\n| id | name   | done |\n+----+--------+------+\n|  1 | item 1 |    0 |\n|  2 | item2  |    1 |\n|  3 | item3  |    0 |\n+----+--------+------+\n3 rows in set (0.00 sec)\n```\n\n正常に動いていそうです！！ アイテムの追加、削除も動きます。もちろん更新しても元どおりなんてことはありません。\n\n## まとめ\nNestJSを使ってTodoリストのバックエンド側を作成しました。TypeORMやDockerなどにも触れられていい勉強になりました！！\n\n### コード\n- フロントエンド： https://github.com/dai65527/tstodo-client\n- バックエンド： https://github.com/dai65527/tstodo_server\n- 完成品（こちらは見た目だけ）: https://dai65527.github.io/nuxttodo/\n\nここ変だぞ？ とか、ここもっとよくなるぞ？ ってとことかありましたらコメント等で教えていただけますと幸いです！！\n\n### 次は\n\n開発環境を全てDocker化したり、ログイン機能とかつけてデプロイすることに挑戦します。駆け出しの冒険は続く。\n\n### あとがき\n誰か仕事ください。\n",coediting:a,comments_count:0,created_at:"2020-10-01T17:54:52+09:00",group:s,id:"a5e744120492bcc2c591",likes_count:3,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:x,versions:[]},{name:p,versions:[]},{name:"TypeORM",versions:[]},{name:"NestJS",versions:[]}],title:"Nuxt.jsとNestJSでTypeScriptなTodoリストを作ってみる（バックエンド編）",updated_at:"2020-10-01T18:08:05+09:00",url:"https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591",user:{description:v,facebook_id:n,followees_count:0,followers_count:0,github_login_name:k,id:E,items_count:2,linkedin_id:n,location:y,name:n,organization:n,permanent_id:w,profile_image_url:A,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="warn" class="fragment"></span><a href="#warn"><i class="fa fa-link"></i></a>WARN</h1>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>WARN  mode option is deprecated. Please use ssr: true for universal mode or ssr: false for spa mode and remove mode from nuxt.config\n</pre></div></div>\n\n<p>v2.14.5にアップグレードすると上記の警告が出るようになりました。</p>\n\n<p><a href="https://github.com/nuxt/nuxt.js/releases/tag/v2.14.5" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nuxt/nuxt.js/releases/tag/v2.14.5</a></p>\n\n<h2>\n<span id="対応" class="fragment"></span><a href="#%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>対応</h2>\n\n<p>警告文に書いてあることをやるだけですが以下のような修正で対応できます。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="gd">-  mode: \'spa\',\n</span><span class="gi">+  ssr: false,\n</span></pre></div>\n</div>\n',body:"# WARN\n\n```\nWARN  mode option is deprecated. Please use ssr: true for universal mode or ssr: false for spa mode and remove mode from nuxt.config\n```\n\nv2.14.5にアップグレードすると上記の警告が出るようになりました。\n\nhttps://github.com/nuxt/nuxt.js/releases/tag/v2.14.5\n\n## 対応\n\n警告文に書いてあることをやるだけですが以下のような修正で対応できます。\n\n```diff:nuxt.config.js\n-  mode: 'spa',\n+  ssr: false,\n```\n",coediting:a,comments_count:0,created_at:_,group:s,id:"fd5a1a0dcaf263343494",likes_count:0,private:a,reactions_count:0,tags:[{name:p,versions:[]}],title:"WARN  mode option is deprecated. Please use ssr: true for universal mode or ssr: false for spa mode and remove mode from nuxt.config",updated_at:_,url:"https://qiita.com/abetomo/items/fd5a1a0dcaf263343494",user:{description:n,facebook_id:n,followees_count:0,followers_count:19,github_login_name:j,id:j,items_count:56,linkedin_id:n,location:n,name:n,organization:n,permanent_id:3800,profile_image_url:"https://qiita-image-store.s3.amazonaws.com/0/3800/profile-images/1535951212",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>個人的メモ</p>\n\n<h2>\n<span id="前提条件" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>前提条件</h2>\n\n<p>yarnを使用する。</p>\n\n<h4>\n<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn create nuxt-app アプリケーション名\n</pre></div></div>\n\n<h4>\n<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h4>\n\n<ol>\n<li>Project name -&gt; <strong>任意の名前</strong>\n</li>\n<li>Programming language -&gt; <strong>javascript or TypeScriptを選択</strong>\n</li>\n<li>Package manager -&gt; <strong>Yarn or Npmを選択</strong>\n</li>\n<li>UI framework -&gt; <strong>Elementやvuetify.jsなど複数あるのでお好みまたはNoneを選択</strong>\n</li>\n<li>Nuxt.js modules -&gt; <strong>Axios,Progressive Web App (PWA),Contentなどを選択、何も選択しない場合はEnterで進む</strong>\n</li>\n<li>Linting tools -&gt; <strong>ESLint,Prettier,StyleLintを選択する。</strong>\n</li>\n<li>Testing framework -&gt; <strong>何も選択しない場合はNone</strong>\n</li>\n<li>Rendering mode -&gt; <strong>SSRかSPAを選択する。(SPAは実装が簡単)</strong>\n</li>\n<li>Deployment target -&gt; <strong>Serverか、Staticを選択</strong>\n</li>\n<li>Development tools -&gt;<strong>jsconfig.json を設定しておくと、VS Codeで開発する際に正しくシンタックスエラーやハイライトが出るようになります。Semantic Pull Requests はGitのcommitメッセージとPull Requestにおけるタイトルの付け方をチェックしてくれます。</strong>\n</li>\n<li>\n</ol>\n\n<h4>\n<span id="アプリを起動する" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>アプリを起動する</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ cd hoge\n$ yarn dev\n</pre></div></div>\n\n<p>アプリが立ち上がったらlocalhost:3000にアクセスする。</p>\n\n<h4>\n<span id="scssを使用できるようにする" class="fragment"></span><a href="#scss%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>SCSSを使用できるようにする。</h4>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add -D node-sass sass-loader\n</pre></div></div>\n',body:"個人的メモ\n\n## 前提条件\nyarnを使用する。\n\n\n#### セットアップ\n```\n$ yarn create nuxt-app アプリケーション名\n```\n\n\n#### 設定\n1. Project name -> **任意の名前**\n2. Programming language -> **javascript or TypeScriptを選択**\n3. Package manager -> **Yarn or Npmを選択**\n4. UI framework -> **Elementやvuetify.jsなど複数あるのでお好みまたはNoneを選択**\n5. Nuxt.js modules -> **Axios,Progressive Web App (PWA),Contentなどを選択、何も選択しない場合はEnterで進む**\n6. Linting tools -> **ESLint,Prettier,StyleLintを選択する。**\n7. Testing framework -> **何も選択しない場合はNone**\n8. Rendering mode -> **SSRかSPAを選択する。(SPAは実装が簡単)**\n9. Deployment target -> **Serverか、Staticを選択**\n10. Development tools ->**jsconfig.json を設定しておくと、VS Codeで開発する際に正しくシンタックスエラーやハイライトが出るようになります。Semantic Pull Requests はGitのcommitメッセージとPull Requestにおけるタイトルの付け方をチェックしてくれます。**\n11. \n\n\n#### アプリを起動する\n```\n$ cd hoge\n$ yarn dev\n```\n\nアプリが立ち上がったらlocalhost:3000にアクセスする。\n\n#### SCSSを使用できるようにする。\n```\n$ yarn add -D node-sass sass-loader\n",coediting:a,comments_count:0,created_at:F,group:s,id:"18dc854cc40ee3752b6b",likes_count:0,private:a,reactions_count:0,tags:[{name:p,versions:[]}],title:"nuxtのローカル環境構築メモ",updated_at:F,url:"https://qiita.com/takahiro-0430/items/18dc854cc40ee3752b6b",user:{description:"見習い",facebook_id:n,followees_count:2,followers_count:2,github_login_name:s,id:q,items_count:3,linkedin_id:n,location:S,name:B,organization:C,permanent_id:N,profile_image_url:I,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>個人的なメモ</p>\n\n<h4>\n<span id="eslintによるコードの整形はデフォルトでは使用できないのでpackagejsonのscriptsの中に一行追加する" class="fragment"></span><a href="#eslint%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E6%95%B4%E5%BD%A2%E3%81%AF%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E3%81%AF%E4%BD%BF%E7%94%A8%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7packagejson%E3%81%AEscripts%E3%81%AE%E4%B8%AD%E3%81%AB%E4%B8%80%E8%A1%8C%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>eslintによるコードの整形はデフォルトでは使用できないので、package.jsonのscripts{}の中に一行追加する。</h4>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre>  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">dev</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nuxt</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">build</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nuxt build</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nuxt start</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">generate</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nuxt generate</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">lint:js</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eslint --ext .js,.vue --ignore-path .gitignore .</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">lint:style</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">stylelint **/*.{vue,css} --ignore-path .gitignore</span><span class="dl">"</span><span class="p">,</span>\n    <span class="dl">"</span><span class="s2">lint</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">yarn lint:js &amp;&amp; yarn lint:style</span><span class="dl">"</span><span class="p">,</span>\n    <span class="c1">// ここに一行追加</span>\n    <span class="dl">"</span><span class="s2">lintfix</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eslint --fix --ext .js,.vue --ignore-path .gitignore .</span><span class="dl">"</span>\n  <span class="p">},</span>\n</pre></div></div>\n\n<p>これで、<code>yarn lintfix</code>で規約に反した全てのコードを整形してくれる。</p>\n',body:'\n個人的なメモ\n\n\n#### eslintによるコードの整形はデフォルトでは使用できないので、package.jsonのscripts{}の中に一行追加する。\n```js\n  "scripts": {\n    "dev": "nuxt",\n    "build": "nuxt build",\n    "start": "nuxt start",\n    "generate": "nuxt generate",\n    "lint:js": "eslint --ext .js,.vue --ignore-path .gitignore .",\n    "lint:style": "stylelint **/*.{vue,css} --ignore-path .gitignore",\n    "lint": "yarn lint:js && yarn lint:style",\n    // ここに一行追加\n    "lintfix": "eslint --fix --ext .js,.vue --ignore-path .gitignore ."\n  },\n```\n  \nこれで、`yarn lintfix`で規約に反した全てのコードを整形してくれる。\n',coediting:a,comments_count:0,created_at:D,group:s,id:"e90ea94a05e45b210a82",likes_count:0,private:a,reactions_count:0,tags:[{name:"ESLint",versions:[]},{name:p,versions:[]}],title:"nuxtプロジェクトで、インストールしたPrettier,eslintの使用方法",updated_at:D,url:"https://qiita.com/takahiro-0430/items/e90ea94a05e45b210a82",user:{description:"見習い",facebook_id:n,followees_count:2,followers_count:2,github_login_name:s,id:q,items_count:3,linkedin_id:n,location:S,name:B,organization:C,permanent_id:N,profile_image_url:I,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>(バックエンド編: <a href="https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591" class="autolink" id="reference-37d1c7a33b1ef596286d">https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591</a> )</p>\n\n<p>Vue.jsとTypeScriptの練習のために、Nuxt.jsとNestJSでTodoリストを作ってみました。使用技術は以下の通り</p>\n\n<ul>\n<li>フロントエンド： Nuxt.js (UIフレームワークはVuetify、言語はTypeScript）</li>\n<li>バックエンド： NestJS + TypeORM(mySQL)</li>\n</ul>\n\n<p>「よくわかんないけどNuxt.jsとTypeScriptって今アツいんでしょ？」 っていう駆け出しエンジニアの安易な発想で選びました。（つよつよのみなさまコメントお待ちしております）</p>\n\n<p>今回はフロント編。完成形はこんな感じ。（<a href="https://dai65527.github.io/nuxttodo/" class="autolink" rel="nofollow noopener" target="_blank">https://dai65527.github.io/nuxttodo/</a> ）<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a11d37d86c9a06a7544666a65643ebab" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a11d37d86c9a06a7544666a65643ebab" alt="スクリーンショット 2020-09-29 17.14.57.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/8125539e-836d-ffce-71d6-8b02262b5643.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F8125539e-836d-ffce-71d6-8b02262b5643.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ef1533f01a71fcbf471b329c059d8d51 1x" loading="lazy"></a></p>\n\n<h3>\n<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h3>\n\n<ul>\n<li>MacOS Catalina v10.15.6</li>\n<li>Node.JS v14.10.1</li>\n<li>Nuxt.js v2.14.5</li>\n<li>create-nuxt-app v3.3.0</li>\n</ul>\n\n<h2>\n<span id="create-nuxt-appでプロジェクト作成" class="fragment"></span><a href="#create-nuxt-app%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>create-nuxt-appでプロジェクト作成</h2>\n\n<p>Nuxt.jsのプロジェクトを作成する際に便利な<code>create-nuxt-app</code>というツールが用意されています。これを使えば、超カンタンにNuxt.jsのプロジェクトが作成できます。<br>\n下のように実行。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% npx create-nuxt-app tstodo-client\n</pre></div></div>\n\n<h3>\n<span id="質問に負けない" class="fragment"></span><a href="#%E8%B3%AA%E5%95%8F%E3%81%AB%E8%B2%A0%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>質問に負けない</h3>\n\n<p><code>create-nuxt-app</code>を実行すると、いろいろ聞かれます。初心者なので面食らいますが、<a href="https://qiita.com/cheez921/items/fdfd224099f686e3173d" id="reference-e340b6dda171b7d2ff26">こちらの記事</a>に助けながら完答。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>create-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in tstodo-client\n? Project name: tstodo-client\n? Programming language: TypeScript\n? Package manager: Npm\n? UI framework: Vuetify.js\n? Nuxt.js modules: Axios\n? Linting tools: ESLint, Prettier\n? Testing framework: None\n? Rendering mode: Single Page App\n? Deployment target: Server (Node.js hosting)\n? Development tools: \n? Version control system: Git\n</pre></div></div>\n\n<ul>\n<li>言語はTypeScript。なんか人気らしいという安易な思想で選んであとで後悔する。</li>\n<li>UIフレームワークはVuetifyを選択。なんか人気らしいという理由で選択したが、こちらは後悔しなかった。</li>\n<li>サーバサイドとの通信は<code>axios</code>を使うため、<code>Nuxt.js modules</code>で忘れずに選択します。（あとから追加も簡単ですが）</li>\n<li>その他はいい感じに選んだ。たぶんいい感じ。</li>\n</ul>\n\n<h3>\n<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h3>\n\n<p><code>create-nuxt-app</code>が終了すると、既に雛形が実行できる状況で用意されています。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% <span class="nb">ls\n</span>tstodo-client\n</pre></div></div>\n\n<p>立ち上げてみます。</p>\n\n<div class="code-frame" data-lang="bash"><div class="highlight"><pre>% <span class="nb">cd </span>tstodo-client\n% npm run dev\n</pre></div></div>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F6c8f6ea6-2276-7784-ee47-fda3656cf8b6.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6267aed828b91f0f273f710ee548f313" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F6c8f6ea6-2276-7784-ee47-fda3656cf8b6.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6267aed828b91f0f273f710ee548f313" alt="スクリーンショット 2020-09-29 14.55.38.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/6c8f6ea6-2276-7784-ee47-fda3656cf8b6.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F6c8f6ea6-2276-7784-ee47-fda3656cf8b6.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1dd5206d644350f9c2d0568cb9876bdf 1x" loading="lazy"></a><br>\n表示されました！ （デフォルトではlocalhost:3000で起動します。）<br>\n初心者にも超カンタン。何もしてないのにここまでやってくれるなんて、、、至れり尽せりです。</p>\n\n<h2>\n<span id="ディレクトリ構造" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>ディレクトリ構造</h2>\n\n<h3>\n<span id="デフォルト" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88"><i class="fa fa-link"></i></a>デフォルト</h3>\n\n<p>Nuxt.jsのプロジェクトは下記のディレクトリで構成されています。適切な場所に<code>.vue</code>やら<code>.ts</code>やらをすれば、あとはNuxt.js側で良い感じにルーティングしてバンドルしてくれます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>% tree tstodo-client -L 1 \ntstodo-client\n├── README.md\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── package-lock.json\n├── package.json\n├── pages\n├── plugins\n├── static\n├── store\n└── tsconfig.json\n</pre></div></div>\n\n<p>各ディレクトリの意味は<a href="https://ja.nuxtjs.org/guide/directory-structure/" rel="nofollow noopener" target="_blank">ドキュメント参照</a>。（ちなみに.gitignore等のファイルも同時に生成されます）<br>\nちなみに私は半分くらい意味わからんって感じでしたが、今回はケースでは以下のディレクトリにファイルを作成orファイルを編集していけばOK。</p>\n\n<ul>\n<li>layouts: レイアウトを記述するためのファイルを配置。</li>\n<li>pages: アプリケーションのビュー及びルーティングを記述したファイルを配置。このディレクトリの構造を元に勝手にNuxtがルーティングしてくれます。（が、今回はルートURLのみ）</li>\n<li>components: アプリケーションを構成するコンポーネントファイルを配置。</li>\n<li>static: faviconなど変更されないで使われるファイルを配置。（今回はデフォルトのfavicon.ico以外使わない）</li>\n<li>assets: スタイルシートや画像等を配置。（今回はいじらない）</li>\n<li>nuxt.config.js: Nuxt.jsの設定ファイル</li>\n<li>tsconfig.json: TypeScriptの設定ファイル</li>\n<li>package.json: 略。</li>\n<li>package-lock.json: 略。</li>\n<li>node_modules: 略。</li>\n</ul>\n\n<p><code>middleware</code>、<code>plugin</code>、<code>store</code>フォルダと余計なREADME等は削除します。</p>\n\n<h3>\n<span id="最終的な構造" class="fragment"></span><a href="#%E6%9C%80%E7%B5%82%E7%9A%84%E3%81%AA%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>最終的な構造</h3>\n\n<p>不要なもの消して、いろいろファイル作ったらこうなりました。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>% tree tstodo-client\ntstodo-client\n├── README.md\n├── assets\n│   └── variables.scss\n├── components\n│   ├── ItemCard.vue\n│   └── List.vue\n├── layouts\n│   └── default.vue\n├── models\n│   └── Item.ts\n├── node_modules\n│   └── (略)\n├── nuxt.config.js\n├── package-lock.json\n├── package.json\n├── pages\n│   └── index.vue\n├── static\n│   └── favicon.ico\n└── tsconfig.json\n</pre></div></div>\n\n<h2>\n<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>\n\n<p>各ソースについて見ていきます。<br>\nなお、パス中の<code>@</code>はプロジェクトのルートディレクトリを指します。</p>\n\n<h3>\n<span id="vueファイルはtypescriptでこう書く" class="fragment"></span><a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AFtypescript%E3%81%A7%E3%81%93%E3%81%86%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>.vueファイルはTypeScriptでこう書く</h3>\n\n<p>今回はTypeScriptを採用しているので、<code>script</code>タグ内の様子がJavaScriptの<code>.vue</code>ファイルと異なります。<br>\nまず、<code>script</code>タグのプロパティとして、<code>lang="ts"</code>を含めることでTypeScriptを使えるようにします。タグ内の基本構造は以下のようにするのがよいっぽい。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>\n  <span class="c1">// script</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p><code>export default Vue.extend</code>の部分はいろいろ方法はあるようですが、これが一番JSの場合と差が小さいように思います。（<a href="https://typescript.nuxtjs.org/ja/cookbook/components/#template" rel="nofollow noopener" target="_blank">公式のドキュメント</a>でもこの方法となっています。）</p>\n\n<h3>\n<span id="modelsディレクトリ" class="fragment"></span><a href="#models%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>modelsディレクトリ</h3>\n\n<p>todoの各アイテムの構造を記述する<code>Item.ts</code>を作成しました。新しく<code>models</code>ディレクトリを作成して、その配下に配置。</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">@/models/Item.ts</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">IItem</span> <span class="p">{</span>\n  <span class="nl">id</span><span class="p">:</span> <span class="nx">number</span>\n  <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span>\n  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">Item</span> <span class="p">{</span>\n  <span class="kr">private</span> <span class="nx">_props</span><span class="p">:</span> <span class="nx">IItem</span>\n\n  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="nx">IItem</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">_props</span> <span class="o">=</span> <span class="nx">props</span>\n  <span class="p">}</span>\n\n  <span class="kd">get</span> <span class="nx">id</span><span class="p">():</span> <span class="nx">number</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_props</span><span class="p">.</span><span class="nx">id</span>\n  <span class="p">}</span>\n\n  <span class="kd">get</span> <span class="nx">name</span><span class="p">():</span> <span class="nx">string</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_props</span><span class="p">.</span><span class="nx">name</span>\n  <span class="p">}</span>\n\n  <span class="kd">set</span> <span class="nx">name</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">_props</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">value</span>\n  <span class="p">}</span>\n\n  <span class="kd">get</span> <span class="nx">done</span><span class="p">():</span> <span class="nx">boolean</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_props</span><span class="p">.</span><span class="nx">done</span>\n  <span class="p">}</span>\n\n  <span class="kd">set</span> <span class="nx">done</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">_props</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="nx">value</span>\n  <span class="p">}</span>\n\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>せっかく勉強したのでinterfaceとかsetterとかgetterとか使ってみました。</p>\n\n<h3>\n<span id="layoutsディレクトリ" class="fragment"></span><a href="#layouts%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>layoutsディレクトリ</h3>\n\n<p>ページ全体のレイアウト（ヘッダー、フッター、コンテンツなど）はここで記述します。今回は、コンテンツ（Todoリスト）だけなので、こんな感じに。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">@/layouts/default.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-app&gt;</span>\n    <span class="nt">&lt;nuxt</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/v-app&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p><code>nuxt</code>タグ内に<code>pages</code>ディレクトリの内容がレンダリングされます。<br>\nまた、vuetifyのクラス等を使う際は、<code>v-app</code>タグで囲わないと効きませんので注意してください。（僕はこれで半日悩みました。） 何も考えずに全体を囲んでしまいます。</p>\n\n<h3>\n<span id="pagesディレクトリ" class="fragment"></span><a href="#pages%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>pagesディレクトリ</h3>\n\n<p><code>@/layouts/default.vue</code>内の<code>nuxt</code>タグの内容はこの<code>pages</code>ディレクトリの内容になります。ページのルートにアクセスした場合、表示されるのが以下の<code>@/index.vue</code>になります。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">@/pages/index.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-container</span> <span class="na">class=</span><span class="s">"pt-10"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;List</span>\n      <span class="na">:items=</span><span class="s">"items"</span>\n      <span class="err">@</span><span class="na">add-item=</span><span class="s">"addItem"</span>\n      <span class="err">@</span><span class="na">change-done=</span><span class="s">"changeDone"</span>\n      <span class="err">@</span><span class="na">delete-item=</span><span class="s">"deleteItem"</span>\n      <span class="err">@</span><span class="na">delete-done=</span><span class="s">"deleteDone"</span>\n    <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/v-container&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">Item</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/models/Item</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">List</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/List.vue</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">List</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">data</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n    <span class="na">items</span><span class="p">:</span> <span class="p">[</span>\n      <span class="k">new</span> <span class="nx">Item</span><span class="p">({</span>\n        <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>\n        <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">task1</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="p">}),</span>\n      <span class="k">new</span> <span class="nx">Item</span><span class="p">({</span>\n        <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>\n        <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">task2</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="p">}),</span>\n      <span class="k">new</span> <span class="nx">Item</span><span class="p">({</span>\n        <span class="na">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>\n        <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">task3</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n      <span class="p">}),</span>\n    <span class="p">],</span>\n    <span class="na">newItemId</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>\n  <span class="p">}),</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">addItem</span><span class="p">(</span><span class="na">itemName</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>\n        <span class="k">new</span> <span class="nx">Item</span><span class="p">({</span>\n          <span class="na">id</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">newItemId</span><span class="o">++</span><span class="p">,</span>\n          <span class="na">name</span><span class="p">:</span> <span class="nx">itemName</span><span class="p">,</span>\n          <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n        <span class="p">})</span>\n      <span class="p">)</span>\n    <span class="p">},</span>\n    <span class="nx">changeDone</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="c1">// will access to database</span>\n    <span class="p">},</span>\n    <span class="nx">deleteItem</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="nx">deleteDone</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">done</span><span class="p">)</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>Todoリストのアイテムのデータはここに配置します。現状データはベタ打ちしていますが、次回サーバから引っ張ってくるように改造します。　</p>\n\n<p>Todoアイテムを操作する関数もここに書いていきます。基本機能として、</p>\n\n<ul>\n<li>addItem: アイテム追加</li>\n<li>changeDone: アイテムのステータス変更（実行済/未実行）</li>\n<li>deleteItem: アイテム削除</li>\n<li>deleteDone: 実行済みアイテム削除</li>\n</ul>\n\n<p>を用意しました。<br>\n関数内はとりあえず見た目だけ動作するようになってますが、こちらも次回サーバー側のデータベースとやりとりをするように改造します。</p>\n\n<p>（なお、データの場所については、Vuexを使ってもよいのでしょうが、今回はコンポーネント間データの受け渡しの練習としてこうしました。）</p>\n\n<p>Todoリスト自体の中身は<code>List</code>コンポーネントに記述します。<br>\n各関数を実行するボタン類もこの中に配置します。そのため、<code>List</code>にカスタムイベントを作成して、コンポーネント内で<code>$emit</code>するようにします。</p>\n\n<h3>\n<span id="componentsディレクトリ" class="fragment"></span><a href="#components%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>componentsディレクトリ</h3>\n\n<p>リストのコンポーネント<code>List.vue</code>とリスト内の各アイテムを収納する<code>ItemCard.vue</code>を作成しました。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">@/components/List.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;v-card</span> <span class="na">class=</span><span class="s">"mx-auto px-3 py-2"</span> <span class="na">width=</span><span class="s">"95%"</span> <span class="na">max-width=</span><span class="s">"500px"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;v-card-title</span> <span class="na">class=</span><span class="s">"d-flex justify-space-between"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"ma-0"</span><span class="nt">&gt;</span>Things to do...<span class="nt">&lt;/p&gt;</span>\n        <span class="nt">&lt;v-btn</span> <span class="na">small</span> <span class="na">outlined</span> <span class="na">color=</span><span class="s">"error"</span> <span class="na">class=</span><span class="s">"pl-2"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"deleteDone"</span>\n          <span class="nt">&gt;&lt;v-icon&gt;</span>mdi-delete-outline<span class="nt">&lt;/v-icon&gt;</span>Done<span class="nt">&lt;/v-btn</span>\n        <span class="nt">&gt;</span>\n      <span class="nt">&lt;/v-card-title&gt;</span>\n      <span class="nt">&lt;v-form</span> <span class="err">@</span><span class="na">submit.prevent=</span><span class="s">"addItem"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;v-text-field</span>\n          <span class="na">v-model=</span><span class="s">"newItemName"</span>\n          <span class="na">placeholder=</span><span class="s">"Add items..."</span>\n        <span class="nt">&gt;&lt;/v-text-field&gt;</span>\n      <span class="nt">&lt;/v-form&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">v-for=</span><span class="s">"item in items"</span> <span class="na">:key=</span><span class="s">"item.id"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;ItemCard</span>\n          <span class="na">:item=</span><span class="s">"item"</span>\n          <span class="err">@</span><span class="na">delete-item=</span><span class="s">"deleteItem"</span>\n          <span class="err">@</span><span class="na">change-done=</span><span class="s">"changeDone"</span>\n        <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/v-card&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">import</span> <span class="nx">ItemCard</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/components/ItemCard.vue</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">ItemCard</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">items</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">Array</span><span class="p">,</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n  <span class="na">data</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n    <span class="na">newItemName</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n  <span class="p">}),</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">addItem</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">newItemName</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">add-item</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">newItemName</span><span class="p">)</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">newItemName</span> <span class="o">=</span> <span class="dl">\'\'</span>\n      <span class="p">}</span>\n    <span class="p">},</span>\n    <span class="nx">changeDone</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">change-done</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="nx">deleteItem</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">delete-item</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="nx">deleteDone</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">delete-done</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>Listにはvuetifyの<code>v-card</code>コンポーネントを使いました。簡単シンプルな見た目にできるので、デザイン音痴な自分としてはとてもありがたいですね。propsやclassでいろいろ指定できてcssゼロで作れるっていうのもありがたや（駆け出し並感）。<br>\n今回は他にボタンとかチェックボックスとかしか使えなかったですが、今後他のコンポーネントもどんどん使っていきたいです。</p>\n\n<p>各アイテムの中身は<code>ItemCard</code>コンポーネントに切り出してみました。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">@/components/ItemCard.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-card</span> <span class="na">class=</span><span class="s">"my-1"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;v-card-title</span> <span class="na">class=</span><span class="s">"py-0 d-flex justify-space-between"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;v-checkbox</span>\n        <span class="na">v-model=</span><span class="s">"item.done"</span>\n        <span class="na">:label=</span><span class="s">"item.name"</span>\n        <span class="err">@</span><span class="na">change=</span><span class="s">"changeDone"</span>\n      <span class="nt">&gt;&lt;/v-checkbox&gt;</span>\n      <span class="nt">&lt;v-btn</span> <span class="na">icon</span> <span class="na">color=</span><span class="s">"error"</span> <span class="err">@</span><span class="na">click=</span><span class="s">"deleteItem"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;v-icon&gt;</span>mdi-close<span class="nt">&lt;/v-icon&gt;</span>\n      <span class="nt">&lt;/v-btn&gt;</span>\n    <span class="nt">&lt;/v-card-title&gt;</span>\n  <span class="nt">&lt;/v-card&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="k">export</span> <span class="k">default</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">item</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">Object</span><span class="p">,</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">changeDone</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">change-done</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>\n    <span class="p">},</span>\n    <span class="nx">deleteItem</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">delete-item</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<p>コンポーネント名の通りここでも<code>v-card</code>を使いました。汎用性高し。</p>\n\n<p>気になるのは<code>changeDone</code>と<code>deleteItem</code>をここで発火する。ってところです。<br>\n<code>ItemCard</code>→<code>List</code>→<code>index</code>って順に発火していくので、この階層がもっと深くなったら...めんどくさそうですね。　今後はvuexを活用することにします。</p>\n\n<h2>\n<span id="nuxtconfigjsの修正" class="fragment"></span><a href="#nuxtconfigjs%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>nuxt.config.jsの修正</h2>\n\n<p>必要なファイルは全て作成したので、もう一度<code>npm run dev</code>してみましょう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F5aa5a103-0f89-4264-a918-63886d988b94.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3e6cc36e8d060c619d4fceb3f917c2b8" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F5aa5a103-0f89-4264-a918-63886d988b94.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3e6cc36e8d060c619d4fceb3f917c2b8" alt="スクリーンショット 2020-09-29 19.55.54.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/5aa5a103-0f89-4264-a918-63886d988b94.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2F5aa5a103-0f89-4264-a918-63886d988b94.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=264e81fddf0ca6400bf8b46e6c346592 1x" loading="lazy"></a></p>\n\n<p>あれ、なんか思ってたんと違う。黒い。</p>\n\n<h3>\n<span id="nuxtconfigjs内のvuetifyの設定を変更" class="fragment"></span><a href="#nuxtconfigjs%E5%86%85%E3%81%AEvuetify%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>nuxt.config.js内のvuetifyの設定を変更</h3>\n\n<p><code>create-nuxt-app</code>で作成したvuetifyのプロジェクトの雛形はデフォルトでダークモードがオンになってたので、<code>vuetify.theme.dark</code>を<code>false</code>にしてダークモードを解除します。</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">colors</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuetify/es5/util/colors</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// (略)</span>\n  <span class="na">vuetify</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">customVariables</span><span class="p">:</span> <span class="p">[</span><span class="dl">\'</span><span class="s1">~/assets/variables.scss</span><span class="dl">\'</span><span class="p">],</span>\n    <span class="na">theme</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">dark</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>  <span class="c1">// default: true</span>\n      <span class="na">themes</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">dark</span><span class="p">:</span> <span class="p">{</span>\n          <span class="na">primary</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">blue</span><span class="p">.</span><span class="nx">darken2</span><span class="p">,</span>\n          <span class="na">accent</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">grey</span><span class="p">.</span><span class="nx">darken3</span><span class="p">,</span>\n          <span class="na">secondary</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">amber</span><span class="p">.</span><span class="nx">darken3</span><span class="p">,</span>\n          <span class="na">info</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">teal</span><span class="p">.</span><span class="nx">lighten1</span><span class="p">,</span>\n          <span class="na">warning</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">amber</span><span class="p">.</span><span class="nx">base</span><span class="p">,</span>\n          <span class="na">error</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">deepOrange</span><span class="p">.</span><span class="nx">accent4</span><span class="p">,</span>\n          <span class="na">success</span><span class="p">:</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">green</span><span class="p">.</span><span class="nx">accent3</span><span class="p">,</span>\n        <span class="p">},</span>\n      <span class="p">},</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="err">　</span><span class="c1">// (略)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>白くなりました。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fa16b6b08-810d-f51d-f25f-72f8ca6afa58.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=597dde8facb8db629e24be0cc336f3e3" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fa16b6b08-810d-f51d-f25f-72f8ca6afa58.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=597dde8facb8db629e24be0cc336f3e3" alt="スクリーンショット 2020-09-29 20.20.21.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/a16b6b08-810d-f51d-f25f-72f8ca6afa58.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F677011%2Fa16b6b08-810d-f51d-f25f-72f8ca6afa58.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0b94bf0bd155b47f5a0c03cea27b1776 1x" loading="lazy"></a></p>\n\n<p><code>theme</code>ごと消しちゃってもよいです。が、変更したくなったときのために取っておきます。<br>\nまた、<code>@/assets/variables.scss</code>を編集することでcssのカスタムもできます。（デザイン音痴なのでやめておきます）</p>\n\n<p>（参考：<a href="https://go.nuxtjs.dev/config-vuetify" class="autolink" rel="nofollow noopener" target="_blank">https://go.nuxtjs.dev/config-vuetify</a> ）</p>\n\n<h3>\n<span id="htmlのheadタグの設定" class="fragment"></span><a href="#html%E3%81%AEhead%E3%82%BF%E3%82%B0%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>htmlの<code>head</code>タグの設定</h3>\n\n<p>htmlの<code>head</code>の内容の設定なんかも<code>nuxt.config.js</code>でやります。せっかくなので、<code>title</code>を<code>tstodo</code>に修正します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="c1">// (中略)</span>\n\n  <span class="na">head</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">titleTemplate</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">%s - tstodo</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">tstodo</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">meta</span><span class="p">:</span> <span class="p">[</span>\n      <span class="p">{</span> <span class="na">charset</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">utf-8</span><span class="dl">\'</span> <span class="p">},</span>\n      <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">viewport</span><span class="dl">\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">width=device-width, initial-scale=1</span><span class="dl">\'</span> <span class="p">},</span>\n      <span class="p">{</span> <span class="na">hid</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">description</span><span class="dl">\'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">description</span><span class="dl">\'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">\'\'</span> <span class="p">},</span>\n    <span class="p">],</span>\n    <span class="na">link</span><span class="p">:</span> <span class="p">[{</span> <span class="na">rel</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">icon</span><span class="dl">\'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">image/x-icon</span><span class="dl">\'</span><span class="p">,</span> <span class="na">href</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">/favicon.ico</span><span class="dl">\'</span> <span class="p">}],</span>\n  <span class="p">},</span>\n  <span class="c1">// (中略)</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>（参考：<a href="https://go.nuxtjs.dev/config-head" class="autolink" rel="nofollow noopener" target="_blank">https://go.nuxtjs.dev/config-head</a> ）</p>\n\n<p>他にもmoduleの追加のときなどいじる場面が出てきます。</p>\n\n<h2>\n<span id="tsconfigjsonの修正" class="fragment"></span><a href="#tsconfigjson%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>tsconfig.jsonの修正</h2>\n\n<p>デフォルトの<code>target</code>が<code>ES2018</code>となっている（なぜ？）ので、<code>ES5</code>に修正します。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">tsconfig.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ES5"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ESNext"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"moduleResolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Node"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"lib"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"ESNext"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"ESNext.AsyncIterable"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"DOM"</span><span class="w">\n    </span><span class="p">],</span><span class="w">\n    </span><span class="err">(略)</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>また、axiosを使うのにも型宣言を追加する必要などもあるのですが、それは次にします。</p>\n\n<h2>\n<span id="完成" class="fragment"></span><a href="#%E5%AE%8C%E6%88%90"><i class="fa fa-link"></i></a>完成</h2>\n\n<p>これで、フロントの見た目が完成しました！！ <code>npm run build</code>すれば<code>dist</code>ディレクトリにリソースが生成されます。</p>\n\n<p>完成形：<a href="https://dai65527.github.io/nuxttodo/" class="autolink" rel="nofollow noopener" target="_blank">https://dai65527.github.io/nuxttodo/</a><br>\nソース最終版：<a href="https://github.com/dai65527/tstodo-client" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dai65527/tstodo-client</a><br>\n（githubページへのデプロイも簡単でした：<a href="https://ja.nuxtjs.org/faq/github-pages/" class="autolink" rel="nofollow noopener" target="_blank">https://ja.nuxtjs.org/faq/github-pages/</a> ）</p>\n\n<p>初心者でも割と簡単（？）にそれっぽいものが作ることができました。Nuxt.jsとVueはすごいですね。今後はもっと多機能なアプリを作ってみたいと思います。あとNuxt.jsとVue内部どうなってんねん、ってところも勉強したい。</p>\n\n<p><a href="https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591">バックエンド編</a>へ続く...</p>\n\n<h3>\n<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h3>\n\n<p>誰かお仕事ください。</p>\n',body:'(バックエンド編: https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591 )\n\nVue.jsとTypeScriptの練習のために、Nuxt.jsとNestJSでTodoリストを作ってみました。使用技術は以下の通り\n\n- フロントエンド： Nuxt.js (UIフレームワークはVuetify、言語はTypeScript）\n- バックエンド： NestJS + TypeORM(mySQL)\n\n「よくわかんないけどNuxt.jsとTypeScriptって今アツいんでしょ？」 っていう駆け出しエンジニアの安易な発想で選びました。（つよつよのみなさまコメントお待ちしております）\n\n今回はフロント編。完成形はこんな感じ。（https://dai65527.github.io/nuxttodo/ ）\n![スクリーンショット 2020-09-29 17.14.57.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/8125539e-836d-ffce-71d6-8b02262b5643.png)\n\n### 環境\n- MacOS Catalina v10.15.6\n- Node.JS v14.10.1\n- Nuxt.js v2.14.5\n- create-nuxt-app v3.3.0\n\n## create-nuxt-appでプロジェクト作成\nNuxt.jsのプロジェクトを作成する際に便利な`create-nuxt-app`というツールが用意されています。これを使えば、超カンタンにNuxt.jsのプロジェクトが作成できます。\n下のように実行。\n\n```zsh\n% npx create-nuxt-app tstodo-client\n```\n\n### 質問に負けない\n`create-nuxt-app`を実行すると、いろいろ聞かれます。初心者なので面食らいますが、[こちらの記事](https://qiita.com/cheez921/items/fdfd224099f686e3173d)に助けながら完答。\n\n```\ncreate-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in tstodo-client\n? Project name: tstodo-client\n? Programming language: TypeScript\n? Package manager: Npm\n? UI framework: Vuetify.js\n? Nuxt.js modules: Axios\n? Linting tools: ESLint, Prettier\n? Testing framework: None\n? Rendering mode: Single Page App\n? Deployment target: Server (Node.js hosting)\n? Development tools: \n? Version control system: Git\n```\n\n- 言語はTypeScript。なんか人気らしいという安易な思想で選んであとで後悔する。\n- UIフレームワークはVuetifyを選択。なんか人気らしいという理由で選択したが、こちらは後悔しなかった。\n- サーバサイドとの通信は`axios`を使うため、`Nuxt.js modules`で忘れずに選択します。（あとから追加も簡単ですが）\n- その他はいい感じに選んだ。たぶんいい感じ。\n\n### 実行してみる\n`create-nuxt-app`が終了すると、既に雛形が実行できる状況で用意されています。\n\n```zsh\n% ls\ntstodo-client\n```\n\n立ち上げてみます。\n\n```zsh\n% cd tstodo-client\n% npm run dev\n```\n\n![スクリーンショット 2020-09-29 14.55.38.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/6c8f6ea6-2276-7784-ee47-fda3656cf8b6.png)\n表示されました！ （デフォルトではlocalhost:3000で起動します。）\n初心者にも超カンタン。何もしてないのにここまでやってくれるなんて、、、至れり尽せりです。\n\n## ディレクトリ構造\n### デフォルト\nNuxt.jsのプロジェクトは下記のディレクトリで構成されています。適切な場所に`.vue`やら`.ts`やらをすれば、あとはNuxt.js側で良い感じにルーティングしてバンドルしてくれます。\n\n```\n% tree tstodo-client -L 1 \ntstodo-client\n├── README.md\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── package-lock.json\n├── package.json\n├── pages\n├── plugins\n├── static\n├── store\n└── tsconfig.json\n```\n\n各ディレクトリの意味は[ドキュメント参照](https://ja.nuxtjs.org/guide/directory-structure/)。（ちなみに.gitignore等のファイルも同時に生成されます）\nちなみに私は半分くらい意味わからんって感じでしたが、今回はケースでは以下のディレクトリにファイルを作成orファイルを編集していけばOK。\n\n- layouts: レイアウトを記述するためのファイルを配置。\n- pages: アプリケーションのビュー及びルーティングを記述したファイルを配置。このディレクトリの構造を元に勝手にNuxtがルーティングしてくれます。（が、今回はルートURLのみ）\n- components: アプリケーションを構成するコンポーネントファイルを配置。\n- static: faviconなど変更されないで使われるファイルを配置。（今回はデフォルトのfavicon.ico以外使わない）\n- assets: スタイルシートや画像等を配置。（今回はいじらない）\n- nuxt.config.js: Nuxt.jsの設定ファイル\n- tsconfig.json: TypeScriptの設定ファイル\n- package.json: 略。\n- package-lock.json: 略。\n- node_modules: 略。\n\n`middleware`、`plugin`、`store`フォルダと余計なREADME等は削除します。\n\n### 最終的な構造\n不要なもの消して、いろいろファイル作ったらこうなりました。\n\n```\n% tree tstodo-client\ntstodo-client\n├── README.md\n├── assets\n│   └── variables.scss\n├── components\n│   ├── ItemCard.vue\n│   └── List.vue\n├── layouts\n│   └── default.vue\n├── models\n│   └── Item.ts\n├── node_modules\n│   └── (略)\n├── nuxt.config.js\n├── package-lock.json\n├── package.json\n├── pages\n│   └── index.vue\n├── static\n│   └── favicon.ico\n└── tsconfig.json\n```\n\n## ソースコード\n各ソースについて見ていきます。\nなお、パス中の`@`はプロジェクトのルートディレクトリを指します。\n\n### .vueファイルはTypeScriptでこう書く\n今回はTypeScriptを採用しているので、`script`タグ内の様子がJavaScriptの`.vue`ファイルと異なります。\nまず、`script`タグのプロパティとして、`lang="ts"`を含めることでTypeScriptを使えるようにします。タグ内の基本構造は以下のようにするのがよいっぽい。\n\n```vue\n<script lang="ts">\nimport Vue from \'vue\'\n\nexport default Vue.extend({\n  // script\n})\n<\/script>\n```\n\n`export default Vue.extend`の部分はいろいろ方法はあるようですが、これが一番JSの場合と差が小さいように思います。（[公式のドキュメント](https://typescript.nuxtjs.org/ja/cookbook/components/#template)でもこの方法となっています。）\n\n### modelsディレクトリ\ntodoの各アイテムの構造を記述する`Item.ts`を作成しました。新しく`models`ディレクトリを作成して、その配下に配置。\n\n```typescript:@/models/Item.ts\nexport interface IItem {\n  id: number\n  name: string\n  done: boolean\n}\n\nexport default class Item {\n  private _props: IItem\n\n  constructor(props: IItem) {\n    this._props = props\n  }\n\n  get id(): number {\n    return this._props.id\n  }\n\n  get name(): string {\n    return this._props.name\n  }\n\n  set name(value: string) {\n    this._props.name = value\n  }\n\n  get done(): boolean {\n    return this._props.done\n  }\n\n  set done(value: boolean) {\n    this._props.done = value\n  }\n\n}\n```\n\nせっかく勉強したのでinterfaceとかsetterとかgetterとか使ってみました。\n\n### layoutsディレクトリ\nページ全体のレイアウト（ヘッダー、フッター、コンテンツなど）はここで記述します。今回は、コンテンツ（Todoリスト）だけなので、こんな感じに。\n\n```vue:@/layouts/default.vue\n<template>\n  <v-app>\n    <nuxt />\n  </v-app>\n</template>\n```\n\n`nuxt`タグ内に`pages`ディレクトリの内容がレンダリングされます。\nまた、vuetifyのクラス等を使う際は、`v-app`タグで囲わないと効きませんので注意してください。（僕はこれで半日悩みました。） 何も考えずに全体を囲んでしまいます。\n\n### pagesディレクトリ\n`@/layouts/default.vue`内の`nuxt`タグの内容はこの`pages`ディレクトリの内容になります。ページのルートにアクセスした場合、表示されるのが以下の`@/index.vue`になります。\n\n```vue:@/pages/index.vue\n<template>\n  <v-container class="pt-10">\n    <List\n      :items="items"\n      @add-item="addItem"\n      @change-done="changeDone"\n      @delete-item="deleteItem"\n      @delete-done="deleteDone"\n    />\n  </v-container>\n</template>\n\n<script lang="ts">\nimport Vue from \'vue\'\nimport Item from \'@/models/Item\'\nimport List from \'@/components/List.vue\'\n\nexport default Vue.extend({\n  components: {\n    List,\n  },\n  data: () => ({\n    items: [\n      new Item({\n        id: 1,\n        name: \'task1\',\n        done: false,\n      }),\n      new Item({\n        id: 2,\n        name: \'task2\',\n        done: true,\n      }),\n      new Item({\n        id: 3,\n        name: \'task3\',\n        done: false,\n      }),\n    ],\n    newItemId: 4,\n  }),\n  methods: {\n    addItem(itemName: string) {\n      this.items.push(\n        new Item({\n          id: this.newItemId++,\n          name: itemName,\n          done: false,\n        })\n      )\n    },\n    changeDone(id: number) {\n      // will access to database\n    },\n    deleteItem(id: number) {\n      this.items = this.items.filter((item) => item.id !== id)\n    },\n    deleteDone() {\n      this.items = this.items.filter((item) => !item.done)\n    },\n  },\n})\n<\/script>\n```\n\nTodoリストのアイテムのデータはここに配置します。現状データはベタ打ちしていますが、次回サーバから引っ張ってくるように改造します。　\n\nTodoアイテムを操作する関数もここに書いていきます。基本機能として、\n\n- addItem: アイテム追加\n- changeDone: アイテムのステータス変更（実行済/未実行）\n- deleteItem: アイテム削除\n- deleteDone: 実行済みアイテム削除\n\nを用意しました。\n関数内はとりあえず見た目だけ動作するようになってますが、こちらも次回サーバー側のデータベースとやりとりをするように改造します。\n\n（なお、データの場所については、Vuexを使ってもよいのでしょうが、今回はコンポーネント間データの受け渡しの練習としてこうしました。）\n\nTodoリスト自体の中身は`List`コンポーネントに記述します。\n各関数を実行するボタン類もこの中に配置します。そのため、`List`にカスタムイベントを作成して、コンポーネント内で`$emit`するようにします。\n\n### componentsディレクトリ\nリストのコンポーネント`List.vue`とリスト内の各アイテムを収納する`ItemCard.vue`を作成しました。\n\n```vue:@/components/List.vue\n<template>\n  <div>\n    <v-card class="mx-auto px-3 py-2" width="95%" max-width="500px">\n      <v-card-title class="d-flex justify-space-between">\n        <p class="ma-0">Things to do...</p>\n        <v-btn small outlined color="error" class="pl-2" @click="deleteDone"\n          ><v-icon>mdi-delete-outline</v-icon>Done</v-btn\n        >\n      </v-card-title>\n      <v-form @submit.prevent="addItem">\n        <v-text-field\n          v-model="newItemName"\n          placeholder="Add items..."\n        ></v-text-field>\n      </v-form>\n      <div v-for="item in items" :key="item.id">\n        <ItemCard\n          :item="item"\n          @delete-item="deleteItem"\n          @change-done="changeDone"\n        />\n      </div>\n    </v-card>\n  </div>\n</template>\n\n<script lang="ts">\nimport Vue from \'vue\'\nimport ItemCard from \'@/components/ItemCard.vue\'\n\nexport default Vue.extend({\n  components: {\n    ItemCard,\n  },\n  props: {\n    items: {\n      required: true,\n      type: Array,\n    },\n  },\n  data: () => ({\n    newItemName: \'\',\n  }),\n  methods: {\n    addItem() {\n      if (this.newItemName.length !== 0) {\n        this.$emit(\'add-item\', this.newItemName)\n        this.newItemName = \'\'\n      }\n    },\n    changeDone(id: number) {\n      this.$emit(\'change-done\', id)\n    },\n    deleteItem(id: number) {\n      this.$emit(\'delete-item\', id)\n    },\n    deleteDone() {\n      this.$emit(\'delete-done\')\n    },\n  },\n})\n<\/script>\n```\n\nListにはvuetifyの`v-card`コンポーネントを使いました。簡単シンプルな見た目にできるので、デザイン音痴な自分としてはとてもありがたいですね。propsやclassでいろいろ指定できてcssゼロで作れるっていうのもありがたや（駆け出し並感）。\n今回は他にボタンとかチェックボックスとかしか使えなかったですが、今後他のコンポーネントもどんどん使っていきたいです。\n\n各アイテムの中身は`ItemCard`コンポーネントに切り出してみました。\n\n```vue:@/components/ItemCard.vue\n<template>\n  <v-card class="my-1">\n    <v-card-title class="py-0 d-flex justify-space-between">\n      <v-checkbox\n        v-model="item.done"\n        :label="item.name"\n        @change="changeDone"\n      ></v-checkbox>\n      <v-btn icon color="error" @click="deleteItem">\n        <v-icon>mdi-close</v-icon>\n      </v-btn>\n    </v-card-title>\n  </v-card>\n</template>\n\n<script lang="ts">\nimport Vue from \'vue\'\nexport default Vue.extend({\n  props: {\n    item: {\n      required: true,\n      type: Object,\n    },\n  },\n  methods: {\n    changeDone() {\n      this.$emit(\'change-done\', this.item.id)\n    },\n    deleteItem() {\n      this.$emit(\'delete-item\', this.item.id)\n    },\n  },\n})\n<\/script>\n\n```\n\nコンポーネント名の通りここでも`v-card`を使いました。汎用性高し。\n\n気になるのは`changeDone`と`deleteItem`をここで発火する。ってところです。\n`ItemCard`→`List`→`index`って順に発火していくので、この階層がもっと深くなったら...めんどくさそうですね。　今後はvuexを活用することにします。\n\n## nuxt.config.jsの修正\n必要なファイルは全て作成したので、もう一度`npm run dev`してみましょう。\n\n![スクリーンショット 2020-09-29 19.55.54.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/5aa5a103-0f89-4264-a918-63886d988b94.png)\n\nあれ、なんか思ってたんと違う。黒い。\n\n### nuxt.config.js内のvuetifyの設定を変更\n`create-nuxt-app`で作成したvuetifyのプロジェクトの雛形はデフォルトでダークモードがオンになってたので、`vuetify.theme.dark`を`false`にしてダークモードを解除します。\n\n```js:nuxt.config.js\nimport colors from \'vuetify/es5/util/colors\'\n\nexport default {\n  // (略)\n  vuetify: {\n    customVariables: [\'~/assets/variables.scss\'],\n    theme: {\n      dark: false,  // default: true\n      themes: {\n        dark: {\n          primary: colors.blue.darken2,\n          accent: colors.grey.darken3,\n          secondary: colors.amber.darken3,\n          info: colors.teal.lighten1,\n          warning: colors.amber.base,\n          error: colors.deepOrange.accent4,\n          success: colors.green.accent3,\n        },\n      },\n    },\n  },\n　// (略)\n}\n```\n\n白くなりました。\n![スクリーンショット 2020-09-29 20.20.21.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/677011/a16b6b08-810d-f51d-f25f-72f8ca6afa58.png)\n\n\n`theme`ごと消しちゃってもよいです。が、変更したくなったときのために取っておきます。\nまた、`@/assets/variables.scss`を編集することでcssのカスタムもできます。（デザイン音痴なのでやめておきます）\n\n（参考：https://go.nuxtjs.dev/config-vuetify ）\n\n### htmlの`head`タグの設定\nhtmlの`head`の内容の設定なんかも`nuxt.config.js`でやります。せっかくなので、`title`を`tstodo`に修正します。\n\n\n\n```javascript:nuxt.config.js\nexport default {\n  // (中略)\n\n  head: {\n    titleTemplate: \'%s - tstodo\',\n    title: \'tstodo\',\n    meta: [\n      { charset: \'utf-8\' },\n      { name: \'viewport\', content: \'width=device-width, initial-scale=1\' },\n      { hid: \'description\', name: \'description\', content: \'\' },\n    ],\n    link: [{ rel: \'icon\', type: \'image/x-icon\', href: \'/favicon.ico\' }],\n  },\n  // (中略)\n}\n```\n\n（参考：https://go.nuxtjs.dev/config-head ）\n\n他にもmoduleの追加のときなどいじる場面が出てきます。\n\n## tsconfig.jsonの修正\nデフォルトの`target`が`ES2018`となっている（なぜ？）ので、`ES5`に修正します。\n\n```json:tsconfig.json\n{\n  "compilerOptions": {\n    "target": "ES5",\n    "module": "ESNext",\n    "moduleResolution": "Node",\n    "lib": [\n      "ESNext",\n      "ESNext.AsyncIterable",\n      "DOM"\n    ],\n    (略)\n}\n```\n\nまた、axiosを使うのにも型宣言を追加する必要などもあるのですが、それは次にします。\n\n## 完成\nこれで、フロントの見た目が完成しました！！ `npm run build`すれば`dist`ディレクトリにリソースが生成されます。\n\n完成形：https://dai65527.github.io/nuxttodo/\nソース最終版：https://github.com/dai65527/tstodo-client\n（githubページへのデプロイも簡単でした：https://ja.nuxtjs.org/faq/github-pages/ ）\n\n初心者でも割と簡単（？）にそれっぽいものが作ることができました。Nuxt.jsとVueはすごいですね。今後はもっと多機能なアプリを作ってみたいと思います。あとNuxt.jsとVue内部どうなってんねん、ってところも勉強したい。\n\n[バックエンド編](https://qiita.com/daitai-daidai/items/a5e744120492bcc2c591)へ続く...\n\n### あとがき\n誰かお仕事ください。\n',coediting:a,comments_count:0,created_at:"2020-09-30T18:26:09+09:00",group:s,id:"36d44f7caaee4841ef34",likes_count:2,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:e,versions:[]},{name:p,versions:[]},{name:"Vuetify",versions:[]}],title:"Nuxt.jsとNestJSでTypeScriptなTodoリストを作ってみる（フロント編）",updated_at:"2020-10-01T18:06:27+09:00",url:"https://qiita.com/daitai-daidai/items/36d44f7caaee4841ef34",user:{description:v,facebook_id:n,followees_count:0,followers_count:0,github_login_name:k,id:E,items_count:2,linkedin_id:n,location:y,name:n,organization:n,permanent_id:w,profile_image_url:A,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h2>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>\n\n<p>Nuxt.jsとElectronでWebとデスクトップアプリを両立させる方法として、Monorepoとして開発していくのがいいのではないかと思い、環境構築をしてみました。<br>\nその手順を残しておきたいと思います。</p>\n\n<p>この記事も参考になると思うので、是非合わせて読んでみてください！<br>\n<a href="https://qiita.com/282Haniwa/items/a3b0a7d3c622ad82ac8d" id="reference-95863c28c7baf268b4bf">Electron + Nuxt.js + TypeScriptの環境構築</a></p>\n\n<p>この記事のコードのリポジトリは<a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example" rel="nofollow noopener" target="_blank">こちら</a>です。</p>\n\n<h2>\n<span id="ディレクトリ構成" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>ディレクトリ構成</h2>\n\n<p>以下のようなディレクトリ構成で構築するため、最初に設定を行います。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>.\n├── packages\n│   ├── app\n│   │   └── App(Electron)のプロジェクト\n│   └── web\n│       └── Web(Nuxt.js)のプロジェクト\n├── package.json\n└── yarn.lock\n</pre></div></div>\n\n<p>まずは、プロジェクトのディレクトリを作ります。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span>midir nuxt-electron-monorepo-example\n<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>nuxt-electron-monorepo-example\n<span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>packages\n<span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>packages/app\n<span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>packages/web\n</pre></div></div>\n\n<p><code>yarn init</code>をして<code>package.json</code>を生成し、<code>package.json</code>にmonorepo用のコンフィグを書き足します。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn init\n</pre></div></div>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n  </span><span class="nl">"workspaces"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"packages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"packages/app"</span><span class="p">,</span><span class="w">\n      </span><span class="s2">"packages/web"</span><span class="w">\n    </span><span class="p">],</span><span class="w">\n    </span><span class="nl">"nohoist"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">\n      </span><span class="s2">"**"</span><span class="w">\n    </span><span class="p">]</span><span class="w">\n  </span><span class="p">}</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>この設定の意味は、<code>packages/app</code>と<code>packages/web</code>をそれぞれ別のプロジェクトとして扱い、<code>nohoist</code>を<code>"**"</code>に設定することで、<code>node_modules</code>を巻き上げないようにしています。<br>\n本来、<code>node_modules</code>はルートディレクトリに巻き上げられてそれぞれのプロジェクトではそれを参照するようになるのですが、問題が起こりやすい(ように感じる)ので今回はこのような設定にしています。<br>\n本来、monorepoではhoistが働くことで<code>node_modules</code>が削減されるなどのメリットがあります。</p>\n\n<h2>\n<span id="nuxtjsのプロジェクトを作る" class="fragment"></span><a href="#nuxtjs%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Nuxt.jsのプロジェクトを作る</h2>\n\n<p>新しくNuxtのプロジェクトを作る場合は、<code>create-nuxt-app</code>を使って作ってください。<br>\n今回は、以下のような設定でプロジェクトを作っているものとして、進めていきますが、必要に合わせて読み替えながら進めてください。</p>\n\n<p>既にあるプロジェクトをElectronに移植する場合は、プロジェクトの中身を全て<code>packages/web</code>ディレクトリの中に移動してください。<br>\n<strong>※ <code>.git</code>ディレクトリや、<code>.github</code>ディレクトリ、CI/CD用の設定ファイルなどは移動しないように注意してください。</strong></p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>packages/web\n<span class="gp">$</span><span class="w"> </span>yarn create nuxt-app <span class="nb">.</span>\n<span class="go">create-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in .\n? Project name: web\n? Programming language: TypeScript\n? Package manager: Yarn\n? UI framework: (Use arrow keys)\n? UI framework: \n? UI framework: Vuetify.js\n</span><span class="gp">? Nuxt.js modules: (Press &lt;space&gt;</span><span class="w"> </span>to <span class="k">select</span>, &lt;a&gt; to toggle all, &lt;i&gt;\n<span class="go"> to invert selection)\n? Linting tools: ESLint, Prettier, Lint staged files, StyleLint\n? Testing framework: Jest\n? Rendering mode: Single Page App\n? Deployment target: Static (Static/JAMStack hosting)\n</span><span class="gp">? Development tools: (Press &lt;space&gt;</span><span class="w"> </span>to <span class="k">select</span>, &lt;a&gt; to toggle all, &lt;\n<span class="gp">i&gt;</span><span class="w"> </span>to invert selection<span class="o">)</span>\n<span class="go">? Version control system: None\n</span></pre></div></div>\n\n<p>この時に、<code>package.json</code>の<code>name</code>プロパティがパッケージ名(<code>web</code>)と同じになるようにしてください。<br>\nまた、<code>Version control system</code>はNoneを選んでおきましょう。</p>\n\n<h2>\n<span id="electronのプロジェクトを作る" class="fragment"></span><a href="#electron%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Electronのプロジェクトを作る</h2>\n\n<p><code>packages/app</code>のなかにElectronのプロジェクトを作っていきます。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>packages/app\n</pre></div></div>\n\n<h3>\n<span id="electron関係のパッケージを追加する" class="fragment"></span><a href="#electron%E9%96%A2%E4%BF%82%E3%81%AE%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electron関係のパッケージを追加する</h3>\n\n<p>必要なパッケージを追加していきます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add --dev \\\n  electron  \\\n  electron-builder \\\n  electron-devtools-installer \\\n  typescript \\\n  @types/electron-devtools-installer\n</pre></div></div>\n\n<p>ビルド時に使うので<code>typescript</code>と<code>cross-env</code>を入れておきます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add --dev \\\n  typescript \\\n  cross-env\n</pre></div></div>\n\n<p>ついでに<code>eslint</code>と<code>husky</code>, <code>lint-staged</code>も入れておきましょう</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add --dev \\\n  eslint \\\n  @typescript-eslint/eslint-plugin \\\n  prettier \\\n  eslint-config-prettier \\\n  eslint-plugin-prettier \\\n  husky \\\n  lint-staged\n</pre></div></div>\n\n<p>後で使うので、<code>npm-run-all</code>も入れておきます。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span>yarn add <span class="nt">--dev</span> npm-run-all\n</pre></div></div>\n\n<h3>\n<span id="electronのスクリプトを用意する" class="fragment"></span><a href="#electron%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electronのスクリプトを用意する</h3>\n\n<p>長くなるので、ここは省略します。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/app/src/main" rel="nofollow noopener" target="_blank">pacages/app/src/main</a>のスクリプトを参考にして実装してください。</p>\n\n<p><code>tsconfig.json</code>の設定で<code>../../dist</code>に成果物を出力するようにしているのがポイントです。</p>\n\n<h3>\n<span id="rendererのシンボリックリンクを貼ってビルドできるようにする" class="fragment"></span><a href="#renderer%E3%81%AE%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%92%E8%B2%BC%E3%81%A3%E3%81%A6%E3%83%93%E3%83%AB%E3%83%89%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>rendererのシンボリックリンクを貼ってビルドできるようにする</h3>\n\n<p><code>packages/app/renderer</code>が<code>packages/web</code>を指すようにシンボリックリンクを貼ります。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>packages/app/src\n<span class="gp">$</span><span class="w"> </span><span class="nb">ln</span> <span class="nt">-s</span> ../../web renderer\n</pre></div></div>\n\n<h3>\n<span id="nuxtのプロジェクトのコンフィグを修正する" class="fragment"></span><a href="#nuxt%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Nuxtのプロジェクトのコンフィグを修正する</h3>\n\n<p>cross-evnでコンフィグを書き換えるためにenvの設定を作ります。</p>\n\n<p><a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/env" rel="nofollow noopener" target="_blank">packages/web/env</a></p>\n\n<p>そして、<code>nuxt.config.js</code>をapp用のコンフィグとweb用のコンフィグをenvの値によって変えられるように記述します。</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">packages/web/nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="kd">const</span> <span class="nx">appConfig</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="p">...</span><span class="nx">baseConfig</span><span class="p">,</span>\n  <span class="c1">// ssr: false,</span>\n  <span class="c1">// target: \'static\',</span>\n  <span class="na">dev</span><span class="p">:</span> <span class="nx">isDev</span><span class="p">,</span>\n  <span class="na">server</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">host</span><span class="p">:</span> <span class="nx">env</span><span class="p">.</span><span class="nx">NUXT_HOST</span><span class="p">,</span>\n    <span class="na">port</span><span class="p">:</span> <span class="nx">env</span><span class="p">.</span><span class="nx">NUXT_PORT</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="cm">/*\n   ** Electronではhashモードじゃないとだめ\n   ** https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/commonIssues.html#blank-screen-on-builds-but-works-fine-on-serve\n   */</span>\n  <span class="na">router</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">baseConfig</span><span class="p">.</span><span class="nx">router</span><span class="p">,</span>\n    <span class="na">base</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>\n    <span class="na">mode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">hash</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">baseConfig</span><span class="p">.</span><span class="nx">build</span><span class="p">,</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">baseConfig</span><span class="p">.</span><span class="nx">build</span><span class="p">?.</span><span class="nx">extend</span> <span class="o">&amp;&amp;</span> <span class="nx">baseConfig</span><span class="p">.</span><span class="nx">build</span><span class="p">?.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span>\n      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDev</span><span class="p">)</span> <span class="p">{</span>\n        <span class="c1">// absolute path to files on production (default value: \'/_nuxt/\')</span>\n        <span class="c1">// @ts-ignore</span>\n        <span class="nx">config</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">publicPath</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">_nuxt/</span><span class="dl">\'</span>\n      <span class="p">}</span>\n      <span class="nx">config</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">web</span><span class="dl">\'</span>\n      <span class="nx">config</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="c1">// eslint-disable-next-line @typescript-eslint/naming-convention</span>\n        <span class="na">__dirname</span><span class="p">:</span> <span class="o">!</span><span class="nx">isProduction</span><span class="p">,</span>\n        <span class="c1">// eslint-disable-next-line @typescript-eslint/naming-convention</span>\n        <span class="na">__filename</span><span class="p">:</span> <span class="o">!</span><span class="nx">isProduction</span><span class="p">,</span>\n      <span class="p">}</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n  <span class="nx">loaders</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">ts</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">loaderOptions</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">compileOptions</span><span class="p">:</span> <span class="p">{</span>\n          <span class="na">target</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">es5</span><span class="dl">\'</span><span class="p">,</span>\n          <span class="na">module</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">commonjs</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="p">},</span>\n      <span class="p">},</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n  <span class="nx">generate</span><span class="p">:</span> <span class="p">{</span>\n    <span class="p">...</span><span class="nx">baseConfig</span><span class="p">.</span><span class="nx">generate</span><span class="p">,</span>\n    <span class="na">dir</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">../../packages/app/dist/nuxt-build</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">telemetry</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">isApp</span> <span class="p">?</span> <span class="nx">appConfig</span> <span class="p">:</span> <span class="nx">baseConfig</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">config</span>\n</pre></div>\n</div>\n\n<p><a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/nuxt.config.js" rel="nofollow noopener" target="_blank">packages/web/nuxt.config.js</a></p>\n\n<p>このように、ビルド時のenvによってコンフィグを切り替えられるようにします。</p>\n\n<h3>\n<span id="scriptsを修正する" class="fragment"></span><a href="#scripts%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>scripts</code>を修正する</h3>\n\n<p>そして、ビルドできるようにwebとappの<code>package.json</code>を編集します。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/app/package.json" rel="nofollow noopener" target="_blank">packages/app/package.json</a>と<a href="https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/package.json" rel="nofollow noopener" target="_blank">packages/web/package.json</a>を参考にしてください。</p>\n\n<p>webの方でも<code>cross-env</code>を使うので、忘れずに追加しておいてください。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>packages/web\n<span class="gp">$</span><span class="w"> </span>yarn add <span class="nt">--dev</span> cross-env\n</pre></div></div>\n\n<h2>\n<span id="ルートのpackagejsonを編集する" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AEpackagejson%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ルートのpackage.jsonを編集する</h2>\n\n<p>ルートから簡単にdevやbuildを実行できるように<code>scripts</code>を編集します。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">\n    </span><span class="nl">"dev:app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yarn workspace app dev"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"dev:web"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yarn workspace web dev"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"build:app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yarn workspace app build"</span><span class="p">,</span><span class="w">\n    </span><span class="nl">"build:web"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yarn workspace web build"</span><span class="w">\n  </span><span class="p">},</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>これで環境構築は終了です！</p>\n\n<h2>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>\n\n<p>今回、Nuxt.jsで作成したプロジェクトをElectronに移植するニーズがあり、試行錯誤しながら環境構築をしていました。<br>\nせっかく苦労して作り上げたので、もし同じ問題で困っている人がいれば助けになれば良いかなぁと思います！</p>\n\n<p>もっといい方法があるよって人は是非コメントで教えてください！<br>\n最後まで読んでいただきありがとうございました！！</p>\n',body:'## はじめに\n\nNuxt.jsとElectronでWebとデスクトップアプリを両立させる方法として、Monorepoとして開発していくのがいいのではないかと思い、環境構築をしてみました。\nその手順を残しておきたいと思います。\n\nこの記事も参考になると思うので、是非合わせて読んでみてください！\n[Electron + Nuxt.js + TypeScriptの環境構築](https://qiita.com/282Haniwa/items/a3b0a7d3c622ad82ac8d)\n\nこの記事のコードのリポジトリは[こちら](https://github.com/282Haniwa/nuxt-electron-monorepo-example)です。\n\n## ディレクトリ構成\n\n以下のようなディレクトリ構成で構築するため、最初に設定を行います。\n\n```\n.\n├── packages\n│   ├── app\n│   │   └── App(Electron)のプロジェクト\n│   └── web\n│       └── Web(Nuxt.js)のプロジェクト\n├── package.json\n└── yarn.lock\n```\n\nまずは、プロジェクトのディレクトリを作ります。\n\n```shell-session\n$ midir nuxt-electron-monorepo-example\n$ cd nuxt-electron-monorepo-example\n$ mkdir packages\n$ mkdir packages/app\n$ mkdir packages/web\n```\n\n`yarn init`をして`package.json`を生成し、`package.json`にmonorepo用のコンフィグを書き足します。\n\n```shell\n$ yarn init\n```\n\n```json:package.json\n{\n  ...\n  "workspaces": {\n    "packages": [\n      "packages/app",\n      "packages/web"\n    ],\n    "nohoist": [\n      "**"\n    ]\n  }\n}\n```\n\nこの設定の意味は、`packages/app`と`packages/web`をそれぞれ別のプロジェクトとして扱い、`nohoist`を`"**"`に設定することで、`node_modules`を巻き上げないようにしています。\n本来、`node_modules`はルートディレクトリに巻き上げられてそれぞれのプロジェクトではそれを参照するようになるのですが、問題が起こりやすい(ように感じる)ので今回はこのような設定にしています。\n本来、monorepoではhoistが働くことで`node_modules`が削減されるなどのメリットがあります。\n\n\n## Nuxt.jsのプロジェクトを作る\n\n新しくNuxtのプロジェクトを作る場合は、`create-nuxt-app`を使って作ってください。\n今回は、以下のような設定でプロジェクトを作っているものとして、進めていきますが、必要に合わせて読み替えながら進めてください。\n\n既にあるプロジェクトをElectronに移植する場合は、プロジェクトの中身を全て`packages/web`ディレクトリの中に移動してください。\n**※ `.git`ディレクトリや、`.github`ディレクトリ、CI/CD用の設定ファイルなどは移動しないように注意してください。**\n\n```shell-session\n$ cd packages/web\n$ yarn create nuxt-app .\ncreate-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in .\n? Project name: web\n? Programming language: TypeScript\n? Package manager: Yarn\n? UI framework: (Use arrow keys)\n? UI framework: \n? UI framework: Vuetify.js\n? Nuxt.js modules: (Press <space> to select, <a> to toggle all, <i>\n to invert selection)\n? Linting tools: ESLint, Prettier, Lint staged files, StyleLint\n? Testing framework: Jest\n? Rendering mode: Single Page App\n? Deployment target: Static (Static/JAMStack hosting)\n? Development tools: (Press <space> to select, <a> to toggle all, <\ni> to invert selection)\n? Version control system: None\n```\n\nこの時に、`package.json`の`name`プロパティがパッケージ名(`web`)と同じになるようにしてください。\nまた、`Version control system`はNoneを選んでおきましょう。\n\n\n## Electronのプロジェクトを作る\n\n`packages/app`のなかにElectronのプロジェクトを作っていきます。\n\n```shell-session\n$ cd packages/app\n```\n\n### Electron関係のパッケージを追加する\n\n必要なパッケージを追加していきます。\n\n```\n$ yarn add --dev \\\n  electron  \\\n  electron-builder \\\n  electron-devtools-installer \\\n  typescript \\\n  @types/electron-devtools-installer\n```\n\nビルド時に使うので`typescript`と`cross-env`を入れておきます。\n\n```\n$ yarn add --dev \\\n  typescript \\\n  cross-env\n```\n\nついでに`eslint`と`husky`, `lint-staged`も入れておきましょう\n\n```\n$ yarn add --dev \\\n  eslint \\\n  @typescript-eslint/eslint-plugin \\\n  prettier \\\n  eslint-config-prettier \\\n  eslint-plugin-prettier \\\n  husky \\\n  lint-staged\n```\n\n後で使うので、`npm-run-all`も入れておきます。\n\n```shell-session\n$ yarn add --dev npm-run-all\n```\n\n### Electronのスクリプトを用意する\n\n長くなるので、ここは省略します。\n[pacages/app/src/main](https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/app/src/main)のスクリプトを参考にして実装してください。\n\n`tsconfig.json`の設定で`../../dist`に成果物を出力するようにしているのがポイントです。\n\n### rendererのシンボリックリンクを貼ってビルドできるようにする\n\n`packages/app/renderer`が`packages/web`を指すようにシンボリックリンクを貼ります。\n\n```shell-session\n$ cd packages/app/src\n$ ln -s ../../web renderer\n```\n\n### Nuxtのプロジェクトのコンフィグを修正する\n\ncross-evnでコンフィグを書き換えるためにenvの設定を作ります。\n\n[packages/web/env](https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/env)\n\nそして、`nuxt.config.js`をapp用のコンフィグとweb用のコンフィグをenvの値によって変えられるように記述します。\n\n```js:packages/web/nuxt.config.js\nconst appConfig = {\n  ...baseConfig,\n  // ssr: false,\n  // target: \'static\',\n  dev: isDev,\n  server: {\n    host: env.NUXT_HOST,\n    port: env.NUXT_PORT,\n  },\n  /*\n   ** Electronではhashモードじゃないとだめ\n   ** https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/commonIssues.html#blank-screen-on-builds-but-works-fine-on-serve\n   */\n  router: {\n    ...baseConfig.router,\n    base: undefined,\n    mode: \'hash\',\n  },\n  build: {\n    ...baseConfig.build,\n    extend(config, ctx) {\n      baseConfig.build?.extend && baseConfig.build?.extend(config, ctx)\n      if (!isDev) {\n        // absolute path to files on production (default value: \'/_nuxt/\')\n        // @ts-ignore\n        config.output.publicPath = \'_nuxt/\'\n      }\n      config.target = \'web\'\n      config.node = {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        __dirname: !isProduction,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        __filename: !isProduction,\n      }\n    },\n  },\n  loaders: {\n    ts: {\n      loaderOptions: {\n        compileOptions: {\n          target: \'es5\',\n          module: \'commonjs\',\n        },\n      },\n    },\n  },\n  generate: {\n    ...baseConfig.generate,\n    dir: \'../../packages/app/dist/nuxt-build\',\n  },\n  telemetry: false,\n}\n\nconst config = isApp ? appConfig : baseConfig\n\nexport default config\n```\n\n[packages/web/nuxt.config.js](https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/nuxt.config.js)\n\nこのように、ビルド時のenvによってコンフィグを切り替えられるようにします。\n\n### `scripts`を修正する\n\nそして、ビルドできるようにwebとappの`package.json`を編集します。\n[packages/app/package.json](https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/app/package.json)と[packages/web/package.json](https://github.com/282Haniwa/nuxt-electron-monorepo-example/tree/master/packages/web/package.json)を参考にしてください。\n\nwebの方でも`cross-env`を使うので、忘れずに追加しておいてください。\n\n```shell-session\n$ cd packages/web\n$ yarn add --dev cross-env\n```\n\n## ルートのpackage.jsonを編集する\n\nルートから簡単にdevやbuildを実行できるように`scripts`を編集します。\n\n```json:package.json\n{\n  ...\n  "scripts": {\n    "dev:app": "yarn workspace app dev",\n    "dev:web": "yarn workspace web dev",\n    "build:app": "yarn workspace app build",\n    "build:web": "yarn workspace web build"\n  },\n  ...\n}\n```\n\nこれで環境構築は終了です！\n\n## まとめ\n\n今回、Nuxt.jsで作成したプロジェクトをElectronに移植するニーズがあり、試行錯誤しながら環境構築をしていました。\nせっかく苦労して作り上げたので、もし同じ問題で困っている人がいれば助けになれば良いかなぁと思います！\n\nもっといい方法があるよって人は是非コメントで教えてください！\n最後まで読んでいただきありがとうございました！！\n',coediting:a,comments_count:0,created_at:T,group:s,id:"c051a39ecf4069c9a392",likes_count:1,private:a,reactions_count:0,tags:[{name:P,versions:[]},{name:"monorepo",versions:[]},{name:p,versions:[]}],title:"Electron + Webアプリ(Nuxt.js)でMonorepoな環境を作る",updated_at:T,url:"https://qiita.com/282Haniwa/items/c051a39ecf4069c9a392",user:{description:s,facebook_id:s,followees_count:1,followers_count:1,github_login_name:l,id:l,items_count:7,linkedin_id:s,location:s,name:n,organization:s,permanent_id:R,profile_image_url:O,team_only:a,twitter_screen_name:M,website_url:s},page_views_count:s},{rendered_body:'<p>←<a href="https://qiita.com/rf_p/items/b714298e1f9effa32cad" id="reference-d8339ef89dfeb3b38183">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装</a></p>\n\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>今回はNuxt編の最終回。<br>\n記事投稿フォームをindexに設置します。</p>\n\n<p>ログインしていないと書き込めないので、ログイン中のみフォームを表示します。</p>\n\n<h1>\n<span id="railsのレスポンスコード修正" class="fragment"></span><a href="#rails%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>Railsのレスポンスコード修正</h1>\n\n<p>まず下準備として、Rails側の修正漏れ箇所を直します。<br>\npostのsave失敗時、ステータスが200(正常)で返ってきてしまっておりエラーがキャッチできないので、レスポンスコードを422で返すようにします。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">app/controllers/v1/posts_controller.rb</span></div>\n<div class="highlight"><pre><span class="err">...</span>\n       if post.save\n         render json: post\n       else\n<span class="gd">-        render json: { errors: post.errors }\n</span><span class="gi">+        render json: { errors: post.errors }, status: 422\n</span>       end\n     end\n<span class="err">...</span>\n       if @post.update(post_params)\n         render json: @post\n       else\n<span class="gd">-        render json: { errors: @post.errors }\n</span><span class="gi">+        render json: { errors: @post.errors }, status: 422\n</span>       end\n     end\n<span class="err">...</span>\n</pre></div>\n</div>\n\n<p>postした時にNuxt側でtry catchを使っていますが、エラーが出てもレスポンスコードが200だとcatchブロックに行きません。ここは以前の設定ミスなのであらかじめ塞いでおきます。</p>\n\n<h1>\n<span id="pagesindexvueとstoreindexjsの修正" class="fragment"></span><a href="#pagesindexvue%E3%81%A8storeindexjs%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>pages/index.vueとstore/index.jsの修正</h1>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">pages/index.vue</span></div>\n<div class="highlight"><pre>       sm8\n       md6\n     &gt;\n<span class="gi">+      &lt;form v-if="logged_in" @submit.prevent="newPost"&gt;\n+        &lt;v-card&gt;\n+          &lt;v-card-title class="headline"&gt;\n+            新規投稿\n+          &lt;/v-card-title&gt;\n+          &lt;v-card-text&gt;\n+            &lt;ul v-if="errors"&gt;\n+              &lt;li v-for="(message, key) in errors" :key="key"&gt;\n+                {{ key }}\n+                &lt;span v-for="(m, i) in message" :key="i"&gt;\n+                  {{ m }}\n+                &lt;/span&gt;\n+              &lt;/li&gt;\n+            &lt;/ul&gt;\n+            &lt;v-text-field\n+              id="subject"\n+              v-model="subject"\n+              label="subject"\n+              name="subject"\n+              prepend-icon="mdi-subtitles"\n+            /&gt;\n+            &lt;v-textarea\n+              id="body"\n+              v-model="body"\n+              label="body"\n+              name="body"\n+              prepend-icon="mdi-comment-text"\n+            /&gt;\n+          &lt;/v-card-text&gt;\n+          &lt;v-card-actions&gt;\n+            &lt;v-spacer /&gt;\n+            &lt;v-btn color="primary" type="submit"&gt;\n+              投稿\n+            &lt;/v-btn&gt;\n+          &lt;/v-card-actions&gt;\n+        &lt;/v-card&gt;\n+      &lt;/form&gt;\n</span>       &lt;v-card v-for="post in posts" :key="post.id"&gt;\n         &lt;v-card-title class="headline"&gt;\n           &lt;n-link :to="`/posts/${post.id}`"&gt;\n<span class="err">...</span>\n &lt;script&gt;\n export default {\n<span class="gi">+  data () {\n+    return {\n+      subject: \'\',\n+      body: \'\',\n+      errors: []\n+    }\n+  },\n</span>   computed: {\n     posts () {\n       return this.$store.getters[\'posts/posts\']\n<span class="gi">+    },\n+    logged_in () {\n+      return this.$store.getters.logged_in\n+    }\n+  },\n+  methods: {\n+    async newPost () {\n+      try {\n+        await this.$store.dispatch(\'posts/newPost\', {\n+          subject: this.subject,\n+          body: this.body\n+        })\n+        this.subject = \'\'\n+        this.body = \'\'\n+        this.errors = []\n+      } catch (e) {\n+        this.errors = e.data.errors\n+      }\n+      const posts = await this.$store.dispatch(\'posts/fetchPosts\')\n+      this.$store.commit(\'posts/setPosts\', posts.posts)\n</span>     }\n   }\n }\n</pre></div>\n</div>\n\n<p>エラーメッセージの表示箇所や、投稿後のposts再取得あたりがやっつけ感満載ですが。<br>\nやっていることはログインフォーム等と大差無いですね。</p>\n\n<p>最後にstore/posts.jsにnewPostを定義して終わりです。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">store/posts.js</span></div>\n<div class="highlight"><pre> export const actions = {\n   async fetchPosts () {\n     return await this.$axios.$get(\'/v1/posts\')\n<span class="gi">+  },\n+  async newPost (_c, post) {\n+    return await this.$axios.$post(\'/v1/posts\', post)\n</span>   }\n }\n</pre></div>\n</div>\n\n<h1>\n<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h1>\n\n<p>今回でNuxt.js編最終回です。<br>\nRails編からご覧いただいていた場合、18+6で24章にも及ぶ連載です。ご覧いただいたり、プログラムを書いていただいた皆様ありがとうございました。</p>\n\n<p>Railsで実装したCRUD処理でNuxt側未実装の点も多いため、ここからは自力で実装に挑戦してみてください。</p>\n\n<p>また、RailsもNuxtも（特にNuxtは）初心者でお見苦しいコードも多々あったかと思いますが、これをきっかけにオリジナルのアプリケーション構築への挑戦をオススメします。</p>\n\n<h1>\n<span id="終わり" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A"><i class="fa fa-link"></i></a>終わり</h1>\n\n<p>【<a href="https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1" id="reference-e7fb059ca0457ffbe79b">連載目次へ</a>】</p>\n',body:'←[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装](https://qiita.com/rf_p/items/b714298e1f9effa32cad)\n\n# はじめに\n\n今回はNuxt編の最終回。\n記事投稿フォームをindexに設置します。\n\nログインしていないと書き込めないので、ログイン中のみフォームを表示します。\n\n# Railsのレスポンスコード修正\n\nまず下準備として、Rails側の修正漏れ箇所を直します。\npostのsave失敗時、ステータスが200(正常)で返ってきてしまっておりエラーがキャッチできないので、レスポンスコードを422で返すようにします。\n\n```diff:app/controllers/v1/posts_controller.rb\n...\n       if post.save\n         render json: post\n       else\n-        render json: { errors: post.errors }\n+        render json: { errors: post.errors }, status: 422\n       end\n     end\n...\n       if @post.update(post_params)\n         render json: @post\n       else\n-        render json: { errors: @post.errors }\n+        render json: { errors: @post.errors }, status: 422\n       end\n     end\n...\n```\n\npostした時にNuxt側でtry catchを使っていますが、エラーが出てもレスポンスコードが200だとcatchブロックに行きません。ここは以前の設定ミスなのであらかじめ塞いでおきます。\n\n# pages/index.vueとstore/index.jsの修正\n\n```diff:pages/index.vue\n       sm8\n       md6\n     >\n+      <form v-if="logged_in" @submit.prevent="newPost">\n+        <v-card>\n+          <v-card-title class="headline">\n+            新規投稿\n+          </v-card-title>\n+          <v-card-text>\n+            <ul v-if="errors">\n+              <li v-for="(message, key) in errors" :key="key">\n+                {{ key }}\n+                <span v-for="(m, i) in message" :key="i">\n+                  {{ m }}\n+                </span>\n+              </li>\n+            </ul>\n+            <v-text-field\n+              id="subject"\n+              v-model="subject"\n+              label="subject"\n+              name="subject"\n+              prepend-icon="mdi-subtitles"\n+            />\n+            <v-textarea\n+              id="body"\n+              v-model="body"\n+              label="body"\n+              name="body"\n+              prepend-icon="mdi-comment-text"\n+            />\n+          </v-card-text>\n+          <v-card-actions>\n+            <v-spacer />\n+            <v-btn color="primary" type="submit">\n+              投稿\n+            </v-btn>\n+          </v-card-actions>\n+        </v-card>\n+      </form>\n       <v-card v-for="post in posts" :key="post.id">\n         <v-card-title class="headline">\n           <n-link :to="`/posts/${post.id}`">\n...\n <script>\n export default {\n+  data () {\n+    return {\n+      subject: \'\',\n+      body: \'\',\n+      errors: []\n+    }\n+  },\n   computed: {\n     posts () {\n       return this.$store.getters[\'posts/posts\']\n+    },\n+    logged_in () {\n+      return this.$store.getters.logged_in\n+    }\n+  },\n+  methods: {\n+    async newPost () {\n+      try {\n+        await this.$store.dispatch(\'posts/newPost\', {\n+          subject: this.subject,\n+          body: this.body\n+        })\n+        this.subject = \'\'\n+        this.body = \'\'\n+        this.errors = []\n+      } catch (e) {\n+        this.errors = e.data.errors\n+      }\n+      const posts = await this.$store.dispatch(\'posts/fetchPosts\')\n+      this.$store.commit(\'posts/setPosts\', posts.posts)\n     }\n   }\n }\n```\n\nエラーメッセージの表示箇所や、投稿後のposts再取得あたりがやっつけ感満載ですが。\nやっていることはログインフォーム等と大差無いですね。\n\n最後にstore/posts.jsにnewPostを定義して終わりです。\n\n```diff:store/posts.js\n export const actions = {\n   async fetchPosts () {\n     return await this.$axios.$get(\'/v1/posts\')\n+  },\n+  async newPost (_c, post) {\n+    return await this.$axios.$post(\'/v1/posts\', post)\n   }\n }\n```\n\n# 終わりに\n\n今回でNuxt.js編最終回です。\nRails編からご覧いただいていた場合、18+6で24章にも及ぶ連載です。ご覧いただいたり、プログラムを書いていただいた皆様ありがとうございました。\n\nRailsで実装したCRUD処理でNuxt側未実装の点も多いため、ここからは自力で実装に挑戦してみてください。\n\nまた、RailsもNuxtも（特にNuxtは）初心者でお見苦しいコードも多々あったかと思いますが、これをきっかけにオリジナルのアプリケーション構築への挑戦をオススメします。\n\n# 終わり\n\n【[連載目次へ](https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1)】\n',coediting:a,comments_count:0,created_at:"2020-09-29T21:19:10+09:00",group:s,id:"496a5eb49289a90633e2",likes_count:3,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:e,versions:[]},{name:p,versions:[]}],title:"Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #6 記事投稿フォームの作成",updated_at:"2020-09-29T21:20:34+09:00",url:"https://qiita.com/rf_p/items/496a5eb49289a90633e2",user:{description:c,facebook_id:n,followees_count:31,followers_count:64,github_login_name:o,id:i,items_count:96,linkedin_id:n,location:r,name:d,organization:m,permanent_id:g,profile_image_url:u,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h2>\n<span id="nuxtjs--headless-cms-で快適ネットショップ開発" class="fragment"></span><a href="#nuxtjs--headless-cms-%E3%81%A7%E5%BF%AB%E9%81%A9%E3%83%8D%E3%83%83%E3%83%88%E3%82%B7%E3%83%A7%E3%83%83%E3%83%97%E9%96%8B%E7%99%BA"><i class="fa fa-link"></i></a>Nuxt.JS + Headless CMS で快適ネットショップ開発。</h2>\n\n<p>現在、とあるネットショップのリニューアル案件を進めています。<br>\n一般的な通販用CMSですと、思ったようなレイアウトが作りにくかったり、カートの見せ方や遷移の自由度が小さくて妥協せざるを得ないことが多いのですが、Headless CMS + Nuxtで構築することによって、思った通りのネットショップを作ることが出来てとても楽しいです。</p>\n\n<h2>\n<span id="ieを切り捨てたいけどまだ無理か" class="fragment"></span><a href="#ie%E3%82%92%E5%88%87%E3%82%8A%E6%8D%A8%E3%81%A6%E3%81%9F%E3%81%84%E3%81%91%E3%81%A9%E3%81%BE%E3%81%A0%E7%84%A1%E7%90%86%E3%81%8B"><i class="fa fa-link"></i></a>IEを切り捨てたいけど、まだ無理か…。</h2>\n\n<p>さすがにIE11対応はもういいだろうと思いつつ、現状調査をしたところ、IE11経由での売上は無視できるレベルの金額ではなく、まだしばらく対応が必要という結論に。</p>\n\n<p>しかし、そこはNuxt.JS。「Polyfill追加してやれば楽勝や！」と開発を進めていたところ、いつの間にかIE11がエラーを吐くようになっていました。最初の内はIEでも順調に動いていたのですが、どこかの時点から不具合が生じたようです。</p>\n\n<h2>\n<span id="nuxtjsの出力するコードにアロー関数が混ざる" class="fragment"></span><a href="#nuxtjs%E3%81%AE%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E3%82%A2%E3%83%AD%E3%83%BC%E9%96%A2%E6%95%B0%E3%81%8C%E6%B7%B7%E3%81%96%E3%82%8B"><i class="fa fa-link"></i></a>Nuxt.JSの出力するコードにアロー関数が混ざる。</h2>\n\n<p>出力されたソース眺めていると、ところどころにアロー関数が混ざっていることに気づきました。<br>\nNuxtの設定で、ブラウザのバージョン指定を調整しても変わらず、modernバンドルを試してもなぜかアロー関数が混ざります。</p>\n\n<h2>\n<span id="markdownit-のプラグインが怪しい" class="fragment"></span><a href="#markdownit-%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%8C%E6%80%AA%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>markdownit のプラグインが怪しい？</h2>\n\n<p>minifyされて訳の分からないコードを眺めていると、使われているメソッドなどから、なんとなくmarkdownitのプラグインではないかという気がしてきました。</p>\n\n<p>「@nuxtjs/markdownit」を使用する場合、nuxt.config.jsに、以下のように記述してプラグインを読み込ませます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>  modules: [\n    \'@nuxtjs/markdownit\',\n  ],\n\n  markdownit: {\n    injected: true,\n    html: true,\n    use: [\'markdown-it-attrs\', \'markdown-it-div\'],\n  },\n</pre></div></div>\n\n<p>もしや use で読み込ませるプラグインのコードは、トランスパイルをすり抜けるのでは？</p>\n\n<p>そこで、強制的にトランスパイルされるよう、以下の設定をnuxt.config.jsに追加してみました。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>  build: {\n    transpile: [\'markdown-it-attrs\', \'markdown-it-div\'],\n  },\n</pre></div></div>\n\n<p>その結果、無事にIE11でもエラーを吐かなくなりました！（ぜえぜえ）</p>\n\n<p>IEと戦い始めて20年。いつまでIEとの戦いは続くのか…。</p>\n',body:"## Nuxt.JS + Headless CMS で快適ネットショップ開発。\n\n現在、とあるネットショップのリニューアル案件を進めています。\n一般的な通販用CMSですと、思ったようなレイアウトが作りにくかったり、カートの見せ方や遷移の自由度が小さくて妥協せざるを得ないことが多いのですが、Headless CMS + Nuxtで構築することによって、思った通りのネットショップを作ることが出来てとても楽しいです。\n\n## IEを切り捨てたいけど、まだ無理か…。\n\nさすがにIE11対応はもういいだろうと思いつつ、現状調査をしたところ、IE11経由での売上は無視できるレベルの金額ではなく、まだしばらく対応が必要という結論に。\n\nしかし、そこはNuxt.JS。「Polyfill追加してやれば楽勝や！」と開発を進めていたところ、いつの間にかIE11がエラーを吐くようになっていました。最初の内はIEでも順調に動いていたのですが、どこかの時点から不具合が生じたようです。\n\n## Nuxt.JSの出力するコードにアロー関数が混ざる。\n\n出力されたソース眺めていると、ところどころにアロー関数が混ざっていることに気づきました。\nNuxtの設定で、ブラウザのバージョン指定を調整しても変わらず、modernバンドルを試してもなぜかアロー関数が混ざります。\n\n## markdownit のプラグインが怪しい？\n\nminifyされて訳の分からないコードを眺めていると、使われているメソッドなどから、なんとなくmarkdownitのプラグインではないかという気がしてきました。\n\n「@nuxtjs/markdownit」を使用する場合、nuxt.config.jsに、以下のように記述してプラグインを読み込ませます。\n\n```\n  modules: [\n    '@nuxtjs/markdownit',\n  ],\n\n  markdownit: {\n    injected: true,\n    html: true,\n    use: ['markdown-it-attrs', 'markdown-it-div'],\n  },\n```\n\nもしや use で読み込ませるプラグインのコードは、トランスパイルをすり抜けるのでは？\n\nそこで、強制的にトランスパイルされるよう、以下の設定をnuxt.config.jsに追加してみました。\n\n```\n  build: {\n    transpile: ['markdown-it-attrs', 'markdown-it-div'],\n  },\n```\n\nその結果、無事にIE11でもエラーを吐かなくなりました！（ぜえぜえ）\n\nIEと戦い始めて20年。いつまでIEとの戦いは続くのか…。\n",coediting:a,comments_count:0,created_at:z,group:s,id:"3960cb8c0a55e5779d3c",likes_count:0,private:a,reactions_count:0,tags:[{name:"IE11",versions:[]},{name:p,versions:[]},{name:"markdown-it",versions:[]}],title:"@nuxtjs/markdownit + プラグインを入れたら、IE11がエラーを吐くようになって困った話",updated_at:z,url:"https://qiita.com/bagooon/items/3960cb8c0a55e5779d3c",user:{description:"50歳を過ぎて、サラリーマン（営業）を辞めて、業界に一切のコネなしで独立。\r\n20年以上のネットショップ運営（写真撮影、コピーライティングからhtml、カートのプログラミングまで全部自前）の経験を強みに活動中。\r\nNuxt.JS, Node.js, Docker, etc.\r\nWEBサイト制作者向けのウェブサービスCrew'sHubをリリースしました。制作用の情報やファイルをクラウドで簡単共有。",facebook_id:n,followees_count:4,followers_count:1,github_login_name:s,id:"bagooon",items_count:8,linkedin_id:n,location:"名古屋",name:"橋本 たかし",organization:n,permanent_id:532063,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/532063/profile-images/1573550204",team_only:a,twitter_screen_name:s,website_url:"https://crewshub.net"},page_views_count:s},{rendered_body:'\n<h1>\n<span id="nuxtjscomposition-api--nuxtcontent-とは" class="fragment"></span><a href="#nuxtjscomposition-api--nuxtcontent-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>@nuxtjs/composition-api / @nuxt/content とは</h1>\n\n<p>Nuxt v2.13(2020-06-19)辺りから使えるレベルになってきている様子<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F7f59b5e1-e5b0-539d-5e47-0d06931f7190.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cde4cb584be2f29fe86e071528cf6de8" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F7f59b5e1-e5b0-539d-5e47-0d06931f7190.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=cde4cb584be2f29fe86e071528cf6de8" alt="nuxt2.13.0.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/7f59b5e1-e5b0-539d-5e47-0d06931f7190.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F7f59b5e1-e5b0-539d-5e47-0d06931f7190.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c95a2171e6dc7ff3f7968150f4d96b6e 1x" loading="lazy"></a></p>\n\n<p>専用のページもある</p>\n\n<ul>\n<li><a href="https://content.nuxtjs.org/ja/" class="autolink" rel="nofollow noopener" target="_blank">https://content.nuxtjs.org/ja/</a></li>\n<li><a href="https://composition-api.nuxtjs.org/" class="autolink" rel="nofollow noopener" target="_blank">https://composition-api.nuxtjs.org/</a></li>\n</ul>\n\n<h2>\n<span id="nuxtjscomposition-api-の概要" class="fragment"></span><a href="#nuxtjscomposition-api-%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>@nuxtjs/composition-api の概要</h2>\n\n<ul>\n<li>Vue 3 のComposition APIをNuxtの仕様に合わせたもの</li>\n</ul>\n\n<h2>\n<span id="nuxtcontent-の概要" class="fragment"></span><a href="#nuxtcontent-%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>@nuxt/content の概要</h2>\n\n<ul>\n<li>MarkdownやJSONなどのファイルからAPIのようにfetchできるようにするもの</li>\n</ul>\n\n<h1>\n<span id="create-nuxt-app-を使用してnuxtアプリを生成" class="fragment"></span><a href="#create-nuxt-app-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6nuxt%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>create-nuxt-app を使用してnuxtアプリを生成</h1>\n\n<p><a href="https://github.com/nuxt/create-nuxt-app" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nuxt/create-nuxt-app</a><br>\n1.Package manager: Yarn<br>\n2.Programming language: TypeScript<br>\n3.UI framework: Vuetify<br>\n4.Nuxt.js modules: Axios / PWA / Content<br>\n5.Linting tools: ESLint / Prettier / Lint staged files / StyleLint<br>\n6.Testing framework: Jest<br>\n7.Rendering mode: Universal(SSR / Static)<br>\n8.Deployment target: Server<br>\n9.Deployment tools: none</p>\n\n<p>@nuxt/contentはmodulesへ記載される</p>\n\n<p>@nuxtjs/composition-apiをインストールする<br>\n<a href="https://composition-api.nuxtjs.org/setup" class="autolink" rel="nofollow noopener" target="_blank">https://composition-api.nuxtjs.org/setup</a></p>\n\n<p>追記する</p>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre><span class="nx">buildModules</span><span class="p">:</span> <span class="p">[</span>\n  <span class="c1">// https://github.com/nuxt-community/composition-api</span>\n  <span class="dl">\'</span><span class="s1">@nuxtjs/composition-api</span><span class="dl">\'</span><span class="p">,</span>\n<span class="p">],</span>\n</pre></div>\n</div>\n\n<p>試したリポジトリ<br>\n<a href="https://github.com/seiy4/nuxt214/tree/master/src" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/seiy4/nuxt214/tree/master/src</a></p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fd414aa76-2d61-37c2-73a9-81a8c39a69a1.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4eee4eafc24bab71bdcad0816d55c990" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fd414aa76-2d61-37c2-73a9-81a8c39a69a1.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4eee4eafc24bab71bdcad0816d55c990" alt="directry-structure.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/d414aa76-2d61-37c2-73a9-81a8c39a69a1.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fd414aa76-2d61-37c2-73a9-81a8c39a69a1.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=97c16c9b5e73909a565ecfe4058d02d1 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="nuxtjscomposition-api" class="fragment"></span><a href="#nuxtjscomposition-api"><i class="fa fa-link"></i></a>@nuxtjs/composition-api</h1>\n\n<p><a href="https://www.npmjs.com/package/@nuxtjs/composition-api" class="autolink" rel="nofollow noopener" target="_blank">https://www.npmjs.com/package/@nuxtjs/composition-api</a><br>\n<a href="https://github.com/nuxt-community/composition-api/blob/main/src/entrypoint.ts" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nuxt-community/composition-api/blob/main/src/entrypoint.ts</a><br>\n <a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F4c1d3290-3de5-a556-9958-5001382c7d1e.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bf9298d88b96079e07cc704097e10759" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F4c1d3290-3de5-a556-9958-5001382c7d1e.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bf9298d88b96079e07cc704097e10759" alt="nuxt-entrypoint.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/4c1d3290-3de5-a556-9958-5001382c7d1e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F4c1d3290-3de5-a556-9958-5001382c7d1e.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=afcd9fb26ff73544f4947dfb4d8f9baf 1x" loading="lazy"></a></p>\n\n<p>componentを定義</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">components/TheUser.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>Name: <span class="si">{{</span> <span class="nx">fullName</span> <span class="si">}}</span>, Message: <span class="si">{{</span> <span class="nx">message</span> <span class="si">}}</span><span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">computed</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxtjs/composition-api</span><span class="dl">\'</span>\n\n<span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>\n  <span class="nl">firstName</span><span class="p">:</span> <span class="nx">string</span>\n  <span class="nx">lastName</span><span class="p">:</span> <span class="nx">string</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>\n  <span class="na">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">Object</span> <span class="k">as</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="p">,</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n\n  <span class="nx">setup</span><span class="p">({</span> <span class="nx">user</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">fullName</span> <span class="o">=</span> <span class="nx">computed</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="dl">\'</span><span class="s1">This is a message</span><span class="dl">\'</span><span class="p">)</span>\n\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">fullName</span><span class="p">,</span>\n      <span class="nx">message</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">})</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">components/TheCounter.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;v-btn</span> <span class="err">@</span><span class="na">click=</span><span class="s">"decrement"</span><span class="nt">&gt;</span>-<span class="nt">&lt;/v-btn&gt;</span>\n    <span class="nt">&lt;span&gt;</span><span class="si">{{</span> <span class="nx">count</span> <span class="si">}}</span><span class="nt">&lt;/span&gt;</span>\n    <span class="nt">&lt;v-btn</span> <span class="err">@</span><span class="na">click=</span><span class="s">"increment"</span><span class="nt">&gt;</span>+<span class="nt">&lt;/v-btn&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">reactive</span><span class="p">,</span> <span class="nx">computed</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxtjs/composition-api</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">reactive</span><span class="p">({</span>\n      <span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>\n    <span class="p">})</span>\n    <span class="kd">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">computed</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>\n\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">count</span><span class="p">,</span>\n      <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>\n      <span class="p">},</span>\n      <span class="nx">decrement</span><span class="p">()</span> <span class="p">{</span>\n        <span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">--</span>\n      <span class="p">},</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<p>実際に使うとき</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">main.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;the-counter</span> <span class="nt">/&gt;</span>\n    <span class="nt">&lt;the-user</span> <span class="na">:user=</span><span class="s">"user"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">user</span><span class="p">:</span> <span class="p">{</span>\n        <span class="na">firstName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Taro</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="na">lastName</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Yamada</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="p">},</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="nuxtcontent" class="fragment"></span><a href="#nuxtcontent"><i class="fa fa-link"></i></a>@nuxt/content</h1>\n\n<p><a href="https://content.nuxtjs.org/ja/writing" class="autolink" rel="nofollow noopener" target="_blank">https://content.nuxtjs.org/ja/writing</a><br>\n<code>content</code> ディレクトリへMarkdownを追加する</p>\n\n<h2>\n<span id="code" class="fragment"></span><a href="#code"><i class="fa fa-link"></i></a>Code</h2>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">hello.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div&gt;</span>\n    <span class="nt">&lt;h3&gt;</span><span class="si">{{</span> <span class="nx">page</span><span class="p">.</span><span class="nx">title</span> <span class="si">}}</span><span class="nt">&lt;/h3&gt;</span>\n    <span class="nt">&lt;nuxt-content</span> <span class="na">:document=</span><span class="s">"page"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">({</span> <span class="nx">$content</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">$content</span><span class="p">(</span><span class="dl">\'</span><span class="s1">hello</span><span class="dl">\'</span><span class="p">).</span><span class="nx">fetch</span><span class="p">()</span>\n\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="nx">page</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div>\n</div>\n\n<h2>\n<span id="markdown-sample" class="fragment"></span><a href="#markdown-sample"><i class="fa fa-link"></i></a>markdown sample</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F6d34bc49-c413-d504-2275-dd4e8d1bc7ee.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6d95ae32c54bee8658fdb77c4f223ff1" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F6d34bc49-c413-d504-2275-dd4e8d1bc7ee.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6d95ae32c54bee8658fdb77c4f223ff1" alt="markdown-sample.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/6d34bc49-c413-d504-2275-dd4e8d1bc7ee.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2F6d34bc49-c413-d504-2275-dd4e8d1bc7ee.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=af22fc3e71a83b09a4c4cc346086f776 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="output" class="fragment"></span><a href="#output"><i class="fa fa-link"></i></a>output</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fdc573e67-2e7a-1da6-2735-9c5989fcc100.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c37923351af8b64d18f2f24598c82aa3" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fdc573e67-2e7a-1da6-2735-9c5989fcc100.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c37923351af8b64d18f2f24598c82aa3" alt="nuxt:content-output.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/dc573e67-2e7a-1da6-2735-9c5989fcc100.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F52777%2Fdc573e67-2e7a-1da6-2735-9c5989fcc100.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6c6918e32f53e6dff9abebc3b87bef55 1x" loading="lazy"></a></p>\n',body:"# @nuxtjs/composition-api / @nuxt/content とは\n\nNuxt v2.13(2020-06-19)辺りから使えるレベルになってきている様子\n![nuxt2.13.0.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/7f59b5e1-e5b0-539d-5e47-0d06931f7190.png)\n\n専用のページもある\n\n* https://content.nuxtjs.org/ja/\n* https://composition-api.nuxtjs.org/\n\n## @nuxtjs/composition-api の概要\n* Vue 3 のComposition APIをNuxtの仕様に合わせたもの\n\n## @nuxt/content の概要\n* MarkdownやJSONなどのファイルからAPIのようにfetchできるようにするもの\n\n# create-nuxt-app を使用してnuxtアプリを生成\nhttps://github.com/nuxt/create-nuxt-app\n1.Package manager: Yarn\n2.Programming language: TypeScript\n3.UI framework: Vuetify\n4.Nuxt.js modules: Axios / PWA / Content\n5.Linting tools: ESLint / Prettier / Lint staged files / StyleLint\n6.Testing framework: Jest\n7.Rendering mode: Universal(SSR / Static)\n8.Deployment target: Server\n9.Deployment tools: none\n\n@nuxt/contentはmodulesへ記載される\n\n@nuxtjs/composition-apiをインストールする\nhttps://composition-api.nuxtjs.org/setup\n\n追記する\n\n```nuxt.config.ts\nbuildModules: [\n  // https://github.com/nuxt-community/composition-api\n  '@nuxtjs/composition-api',\n],\n```\n\n試したリポジトリ\nhttps://github.com/seiy4/nuxt214/tree/master/src\n\n![directry-structure.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/d414aa76-2d61-37c2-73a9-81a8c39a69a1.png)\n\n\n# @nuxtjs/composition-api\nhttps://www.npmjs.com/package/@nuxtjs/composition-api\nhttps://github.com/nuxt-community/composition-api/blob/main/src/entrypoint.ts\n ![nuxt-entrypoint.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/4c1d3290-3de5-a556-9958-5001382c7d1e.png)\n\n\n\ncomponentを定義\n\n```components/TheUser.vue\n<template>\n  <div>Name: {{ fullName }}, Message: {{ message }}</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref } from '@nuxtjs/composition-api'\n\ninterface User {\n  firstName: string\n  lastName: string\n}\n\nexport default defineComponent({\n  props: {\n    user: {\n      type: Object as () => User,\n      required: true,\n    },\n  },\n\n  setup({ user }) {\n    const fullName = computed(() => `${user.firstName} ${user.lastName}`)\n    const message = ref('This is a message')\n\n    return {\n      fullName,\n      message,\n    }\n  },\n})\n<\/script>\n```\n\n```components/TheCounter.vue\n<template>\n  <div>\n    <v-btn @click=\"decrement\">-</v-btn>\n    <span>{{ count }}</span>\n    <v-btn @click=\"increment\">+</v-btn>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { reactive, computed } from '@nuxtjs/composition-api'\n\nexport default {\n  setup() {\n    const state = reactive({\n      count: 0,\n    })\n    const count = computed(() => state.count)\n\n    return {\n      count,\n      increment() {\n        state.count++\n      },\n      decrement() {\n        state.count--\n      },\n    }\n  },\n}\n<\/script>\n```\n\n実際に使うとき\n\n```main.vue\n<template>\n  <div>\n    <the-counter />\n    <the-user :user=\"user\" />\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      user: {\n        firstName: 'Taro',\n        lastName: 'Yamada',\n      },\n    }\n  },\n}\n<\/script>\n```\n\n\n# @nuxt/content\n\nhttps://content.nuxtjs.org/ja/writing\n`content` ディレクトリへMarkdownを追加する\n\n## Code\n\n```hello.vue\n<template>\n  <div>\n    <h3>{{ page.title }}</h3>\n    <nuxt-content :document=\"page\" />\n  </div>\n</template>\n\n<script>\nexport default {\n  async asyncData({ $content }) {\n    const page = await $content('hello').fetch()\n\n    return {\n      page,\n    }\n  },\n<\/script>\n```\n\n## markdown sample\n![markdown-sample.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/6d34bc49-c413-d504-2275-dd4e8d1bc7ee.png)\n\n## output\n![nuxt:content-output.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/dc573e67-2e7a-1da6-2735-9c5989fcc100.png)\n\n\n\n\n",coediting:a,comments_count:0,created_at:"2020-09-29T07:22:36+09:00",group:s,id:"e922f8054188ec7ec45c",likes_count:1,private:a,reactions_count:0,tags:[{name:e,versions:[]},{name:p,versions:[]}],title:"@nuxtjs/composition-apiと@nuxt/contentを使ってみる",updated_at:"2020-09-29T11:31:20+09:00",url:"https://qiita.com/seiy4/items/e922f8054188ec7ec45c",user:{description:s,facebook_id:s,followees_count:26,followers_count:4,github_login_name:$,id:$,items_count:1,linkedin_id:s,location:s,name:n,organization:s,permanent_id:52777,profile_image_url:"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/52777/profile-images/1578132765",team_only:a,twitter_screen_name:s,website_url:s},page_views_count:s},{rendered_body:'<p>みなさんこんにちわ。<strong>Headless</strong>というスペルを<strong>Headress</strong>とたまに間違えるいとうです。最近HeadlessCMSはやってますね。<a href="https://www.contentful.com/" rel="nofollow noopener" target="_blank">Contentful</a>や<a href="https://craftcms.com/" rel="nofollow noopener" target="_blank">CraftCMS</a>、<a href="https://ja.wp-api.org/" rel="nofollow noopener" target="_blank">WP REST API</a>、国産の<a href="https://microcms.io/" rel="nofollow noopener" target="_blank">microCMS</a>など様々なHeadlessCMSが生まれています。とても便利で案件でも増えてきました。</p>\n\n<p>その背景にはやはり低コスト、アジャイル、自由度の増したデザインetc.....メリットしかありません。世界の3割のサイトがWordpressでできていると言われていたのがすごく前のように感じます。</p>\n\n<p>いえーい、Wordpressくんみてるー?</p>\n\n<h2>\n<span id="本題リンクカードとは" class="fragment"></span><a href="#%E6%9C%AC%E9%A1%8C%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%AB%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>本題、リンクカードとは</h2>\n\n<p>本題です。案件でNuxtでつくったブログにリンクカードを表示したいと言われたのでどうしたら実装できるのかを備忘録程度に書いておきます。</p>\n\n<p>リンクカードというのはその名前の通り、リンクのカードです。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204436%2Ffddc5f1b-347a-333b-ae30-2beb88e8f877.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dd7c2376ffa69b3ac00c3e1e086795ee" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204436%2Ffddc5f1b-347a-333b-ae30-2beb88e8f877.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dd7c2376ffa69b3ac00c3e1e086795ee" alt="_2020-09-29_2.12.36.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204436/fddc5f1b-347a-333b-ae30-2beb88e8f877.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F204436%2Ffddc5f1b-347a-333b-ae30-2beb88e8f877.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7daa51c2ca56aedca994950857f015b1 1x" loading="lazy"></a></p>\n\n<p>Notionでいう↑こういうやつです。</p>\n\n<p>要件としてはURLの文字列から、<strong>タイトル</strong>、<strong>ディスクリプション</strong>、<strong>favicon</strong>、<strong>og:image</strong>を取得するというものです。</p>\n\n<p>今回の記事では前提として、フレームワークにNuxt、CMSはmicroCMSを使用します。</p>\n\n<h2>\n<span id="とりあえずurlを表示する" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Aurl%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>とりあえずURLを表示する。</h2>\n\n<p>とりあえず好きなサイトのURLを取得しましょう。</p>\n\n<p>URLの文字列からfetchしてHTMLを取得し、ヘッドの情報を抜き取りましょう。簡単なスクレイピングです。</p>\n\n<div class="code-frame" data-lang="jsx"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">link</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">https://www.awwwards.com/</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">link</span>\n\n    <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">().</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">text/html</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="kd">const</span> <span class="nx">headEls</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">children</span>\n        <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">headEls</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>\n          <span class="kd">const</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">property</span><span class="dl">\'</span><span class="p">)</span>\n          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prop</span><span class="p">)</span> <span class="k">return</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">))</span>\n        <span class="p">})</span>\n      <span class="p">})</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="p">&lt;</span><span class="err">/</span><span class="nt">script</span><span class="p">&gt;</span>\n</pre></div></div>\n\n<p>こんな感じのコードになります。</p>\n\n<p>簡単に説明すると、URLの文字列をもとにfetchしheadの情報を抜き取ってproperty とcontentをタグに関係なく表示します。</p>\n\n<p>しかしこのままだとCORSエラーになります</p>\n\n<p>URLをfetchする場合、セキュリティの都合上からCORSに怒られてしまうのです。</p>\n\n<p>なのでCORSエラーを回避するためにURLの頭に <code>https://cors-anywhere.herokuapp.com/</code> をつけてあげます。</p>\n\n<div class="code-frame" data-lang="jsx"><div class="highlight"><pre><span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">CORS_PROXY</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://cors-anywhere.herokuapp.com/</span><span class="dl">\'</span>\n    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">CORS_PROXY</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">link</span>\n\n    <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">().</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">text/html</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="kd">const</span> <span class="nx">headEls</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">children</span>\n        <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">headEls</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>\n          <span class="kd">const</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">property</span><span class="dl">\'</span><span class="p">)</span>\n          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prop</span><span class="p">)</span> <span class="k">return</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">))</span>\n        <span class="p">})</span>\n      <span class="p">})</span>\n  <span class="p">},</span>\n</pre></div></div>\n\n<p>これでエラーは出ません。やったね。</p>\n\n<h2>\n<span id="headlesscmsと組み合わせる" class="fragment"></span><a href="#headlesscms%E3%81%A8%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>HeadlessCMSと組み合わせる。</h2>\n\n<p>HeadlessCMSと組み合わせます。</p>\n\n<div class="code-frame" data-lang="jsx"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">template</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">pug</span><span class="dl">"</span><span class="o">&gt;</span>\n  <span class="p">.</span><span class="nx">container</span>\n    <span class="nx">div</span><span class="p">(</span><span class="nx">v</span><span class="o">-</span><span class="nx">html</span><span class="o">=</span><span class="dl">"</span><span class="s2">singleData</span><span class="dl">"</span><span class="p">)</span>\n<span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;\n</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">fetch</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">[</span><span class="nx">single</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">CMSのAPI</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">),</span>\n    <span class="p">])</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">singleData</span> <span class="o">=</span> <span class="nx">single</span>\n  <span class="p">},</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">link</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">https://www.awwwards.com/</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">singleData</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span>\n    <span class="kd">const</span> <span class="nx">CORS_PROXY</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://cors-anywhere.herokuapp.com/</span><span class="dl">\'</span>\n    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">CORS_PROXY</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">link</span>\n\n    <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>\n      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">().</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">text/html</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="kd">const</span> <span class="nx">headEls</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">children</span>\n        <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">headEls</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>\n          <span class="kd">const</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">property</span><span class="dl">\'</span><span class="p">)</span>\n          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prop</span><span class="p">)</span> <span class="k">return</span>\n          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">))</span>\n        <span class="p">})</span>\n      <span class="p">})</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="p">&lt;</span><span class="err">/</span><span class="nt">script</span><span class="p">&gt;</span>\n</pre></div></div>\n\n<p>ざっくりですが、こんな感じになるかと思います。<code>this.header</code>  はヘッダーの情報とかそんな感じです。</p>\n\n<p><code>div(v-html="singleData")</code> の中にCMSから取得したhtmlが吐き出されます。NuxtでSSRを使用している場合、レンダリングされたhtmlは<code>mounted</code>  などで取得することはできません。</p>\n\n<p>これはライフサイクルの仕様です。なので、<code>moutend</code>  関数ではなく、<code>updated</code>関数を使います。<code>updated</code>関数は内容がDOMにレンダリングされたあとに実行されます。</p>\n\n<div class="code-frame" data-lang="jsx"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">template</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">pug</span><span class="dl">"</span><span class="o">&gt;</span>\n  <span class="p">.</span><span class="nx">container</span>\n    <span class="nx">div</span><span class="p">.</span><span class="nx">container__body</span><span class="p">(</span><span class="nx">v</span><span class="o">-</span><span class="nx">html</span><span class="o">=</span><span class="dl">"</span><span class="s2">singleData</span><span class="dl">"</span><span class="p">)</span>\n<span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;\n</span>\n<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">fetch</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">[</span><span class="nx">single</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">CMSのAPI</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">headers</span><span class="p">),</span>\n    <span class="p">])</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">singleData</span> <span class="o">=</span> <span class="nx">single</span>\n  <span class="p">},</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">link</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">https://www.awwwards.com/</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">singleData</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">updated</span><span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">bodyArray</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">\'</span><span class="s1">.container__body</span><span class="dl">\'</span><span class="p">)</span>\n    <span class="nx">bodyArray</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">bodyEl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">linkElArray</span> <span class="o">=</span> <span class="nx">bodyEl</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">\'</span><span class="s1">a</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="nx">linkElArray</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">linkEl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">getHead</span><span class="p">(</span><span class="nx">linkEl</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">linkEl</span><span class="p">)</span>\n      <span class="p">})</span>\n    <span class="p">})</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">getHead</span><span class="p">(</span><span class="nx">linkString</span><span class="p">,</span> <span class="nx">linkEl</span><span class="p">)</span> <span class="p">{</span>\n      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span>\n      <span class="kd">const</span> <span class="nx">CORS_PROXY</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">https://cors-anywhere.herokuapp.com/</span><span class="dl">\'</span>\n      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">CORS_PROXY</span> <span class="o">+</span> <span class="nx">linkString</span>\n\n      <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">().</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">text/html</span><span class="dl">\'</span><span class="p">)</span>\n          <span class="kd">const</span> <span class="nx">headEls</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">children</span>\n          <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">headEls</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n            <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">.</span><span class="nx">textContent</span>\n            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span>\n            <span class="nx">linkEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`&lt;p&gt;</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">&lt;/p&gt;`</span>\n          <span class="p">})</span>\n        <span class="p">})</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="p">&lt;</span><span class="err">/</span><span class="nt">script</span><span class="p">&gt;</span>\n</pre></div></div>\n\n<p><code>update</code>関数をつかってレンダリング後にレンダリングしたエレメントオブジェクトを配列で取得します。その中からaタグだけを抜き出し<code>getHead</code>メソッドにURLと要素を渡しましょう。</p>\n\n<p>あとは上に書かれたコードの通りです。最終的には要素の内容を書き換えることで pタグの中にURLから取得されたサイトタイトルを表示しています。</p>\n\n<h2>\n<span id="やっていることは簡単だけど" class="fragment"></span><a href="#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E7%B0%A1%E5%8D%98%E3%81%A0%E3%81%91%E3%81%A9"><i class="fa fa-link"></i></a>やっていることは簡単...だけど</h2>\n\n<p><code>https://cors-anywhere.herokuapp.com/</code>　は魔法の文字列ですが、もちろんデメリットもあります。もともとCORSというのはサイトのセキュリティを保守するためにあるのでこれを無条件で回避しようとすると悪意あるサイトからの攻撃も許してしまう可能性があります。</p>\n\n<p>ですので、絶対信頼できるURLしか貼らないようにしましょう。</p>\n\n<p>みなさまも良いHeadlessCMSライフを！</p>\n',body:"みなさんこんにちわ。**Headless**というスペルを**Headress**とたまに間違えるいとうです。最近HeadlessCMSはやってますね。[Contentful](https://www.contentful.com/)や[CraftCMS](https://craftcms.com/)、[WP REST API](https://ja.wp-api.org/)、国産の[microCMS](https://microcms.io/)など様々なHeadlessCMSが生まれています。とても便利で案件でも増えてきました。\n\nその背景にはやはり低コスト、アジャイル、自由度の増したデザインetc.....メリットしかありません。世界の3割のサイトがWordpressでできていると言われていたのがすごく前のように感じます。\n\nいえーい、Wordpressくんみてるー?\n\n## 本題、リンクカードとは\n\n本題です。案件でNuxtでつくったブログにリンクカードを表示したいと言われたのでどうしたら実装できるのかを備忘録程度に書いておきます。\n\nリンクカードというのはその名前の通り、リンクのカードです。\n\n![_2020-09-29_2.12.36.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/204436/fddc5f1b-347a-333b-ae30-2beb88e8f877.png)\n\nNotionでいう↑こういうやつです。\n\n要件としてはURLの文字列から、**タイトル**、**ディスクリプション**、**favicon**、**og:image**を取得するというものです。\n\n今回の記事では前提として、フレームワークにNuxt、CMSはmicroCMSを使用します。\n\n## とりあえずURLを表示する。\n\nとりあえず好きなサイトのURLを取得しましょう。\n\nURLの文字列からfetchしてHTMLを取得し、ヘッドの情報を抜き取りましょう。簡単なスクレイピングです。\n\n```jsx\n<script>\nexport default {\n  data() {\n    return {\n      link: 'https://www.awwwards.com/',\n    }\n  },\n  mounted() {\n    console.log(this.link)\n    const url = this.link\n\n    fetch(url)\n      .then((res) => res.text())\n      .then((text) => {\n        const el = new DOMParser().parseFromString(text, 'text/html')\n        const headEls = el.head.children\n        Array.from(headEls).map((v) => {\n          console.log(v)\n          const prop = v.getAttribute('property')\n          if (!prop) return\n          console.log(prop, v.getAttribute('content'))\n        })\n      })\n  },\n}\n<\/script>\n```\n\nこんな感じのコードになります。\n\n簡単に説明すると、URLの文字列をもとにfetchしheadの情報を抜き取ってproperty とcontentをタグに関係なく表示します。\n\nしかしこのままだとCORSエラーになります\n\nURLをfetchする場合、セキュリティの都合上からCORSに怒られてしまうのです。\n\nなのでCORSエラーを回避するためにURLの頭に `https://cors-anywhere.herokuapp.com/` をつけてあげます。\n\n```jsx\nmounted() {\n    console.log(this.link)\n    const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/'\n    const url = CORS_PROXY + this.link\n\n    fetch(url)\n      .then((res) => res.text())\n      .then((text) => {\n        const el = new DOMParser().parseFromString(text, 'text/html')\n        const headEls = el.head.children\n        Array.from(headEls).map((v) => {\n          console.log(v)\n          const prop = v.getAttribute('property')\n          if (!prop) return\n          console.log(prop, v.getAttribute('content'))\n        })\n      })\n  },\n```\n\nこれでエラーは出ません。やったね。\n\n## HeadlessCMSと組み合わせる。\n\nHeadlessCMSと組み合わせます。\n\n```jsx\n<template lang=\"pug\">\n  .container\n    div(v-html=\"singleData\")\n</template>\n\n<script>\nexport default {\n  async fetch() {\n    const [single] = await Promise.all([\n      this.$axios.get('CMSのAPI', this.headers),\n    ])\n    this.singleData = single\n  },\n  data() {\n    return {\n      link: 'https://www.awwwards.com/',\n      singleData: '',\n    }\n  },\n  mounted() {\n    console.log(this.link)\n    const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/'\n    const url = CORS_PROXY + this.link\n\n    fetch(url)\n      .then((res) => res.text())\n      .then((text) => {\n        const el = new DOMParser().parseFromString(text, 'text/html')\n        const headEls = el.head.children\n        Array.from(headEls).map((v) => {\n          console.log(v)\n          const prop = v.getAttribute('property')\n          if (!prop) return\n          console.log(prop, v.getAttribute('content'))\n        })\n      })\n  },\n}\n<\/script>\n```\n\nざっくりですが、こんな感じになるかと思います。`this.header`  はヘッダーの情報とかそんな感じです。\n\n`div(v-html=\"singleData\")` の中にCMSから取得したhtmlが吐き出されます。NuxtでSSRを使用している場合、レンダリングされたhtmlは`mounted`  などで取得することはできません。\n\nこれはライフサイクルの仕様です。なので、`moutend`  関数ではなく、`updated`関数を使います。`updated`関数は内容がDOMにレンダリングされたあとに実行されます。\n\n```jsx\n<template lang=\"pug\">\n  .container\n    div.container__body(v-html=\"singleData\")\n</template>\n\n<script>\nexport default {\n  async fetch() {\n    const [single] = await Promise.all([\n      this.$axios.get('CMSのAPI', this.headers),\n    ])\n    this.singleData = single\n  },\n  data() {\n    return {\n      link: 'https://www.awwwards.com/',\n      singleData: '',\n    }\n  },\n  updated() {\n    const bodyArray = document.querySelector('.container__body')\n    bodyArray.forEach((bodyEl) => {\n      const linkElArray = bodyEl.querySelectorAll('a')\n      linkElArray.forEach((linkEl) => {\n        this.getHead(linkEl.href, linkEl)\n      })\n    })\n  },\n  methods: {\n    getHead(linkString, linkEl) {\n      console.log(this.link)\n      const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/'\n      const url = CORS_PROXY + linkString\n\n      fetch(url)\n        .then((res) => res.text())\n        .then((text) => {\n          const el = new DOMParser().parseFromString(text, 'text/html')\n          const headEls = el.head.children\n          Array.from(headEls).map((v) => {\n            const title = el.head.querySelector.textContent\n            console.log(title)\n            linkEl.innerHTML = `<p>${title}</p>`\n          })\n        })\n    },\n  },\n}\n<\/script>\n```\n\n`update`関数をつかってレンダリング後にレンダリングしたエレメントオブジェクトを配列で取得します。その中からaタグだけを抜き出し`getHead`メソッドにURLと要素を渡しましょう。\n\nあとは上に書かれたコードの通りです。最終的には要素の内容を書き換えることで pタグの中にURLから取得されたサイトタイトルを表示しています。\n\n## やっていることは簡単...だけど\n\n`https://cors-anywhere.herokuapp.com/`　は魔法の文字列ですが、もちろんデメリットもあります。もともとCORSというのはサイトのセキュリティを保守するためにあるのでこれを無条件で回避しようとすると悪意あるサイトからの攻撃も許してしまう可能性があります。\n\nですので、絶対信頼できるURLしか貼らないようにしましょう。\n\nみなさまも良いHeadlessCMSライフを！\n",coediting:a,comments_count:0,created_at:"2020-09-29T02:57:58+09:00",group:s,id:"7051701ce1185713c5e4",likes_count:1,private:a,reactions_count:0,tags:[{name:"CMS",versions:[]},{name:L,versions:[]},{name:p,versions:[]},{name:"HeadlessCMS",versions:[]}],title:"【URLから】HeadlessCMSでつくったブログにリンクカードを表示する話【タイトルを取得する】",updated_at:"2020-09-29T03:31:45+09:00",url:"https://qiita.com/usaginoniku/items/7051701ce1185713c5e4",user:{description:n,facebook_id:n,followees_count:4,followers_count:3,github_login_name:s,id:"usaginoniku",items_count:6,linkedin_id:n,location:n,name:"yuki ito",organization:n,permanent_id:204436,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/204436/b589ba79fbdfb4f0981009476cc925cf43ca6488/x_large.png?1581037160",team_only:a,twitter_screen_name:"_Frontart",website_url:n},page_views_count:s},{rendered_body:'\n<h2>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>\n\n<p>Electron + Nuxt.js + TypeScriptの環境を作る必要があったのですが、様々な問題から1から構築した方が良さそうと思ったので、自分で構築してみました。<br>\nもし、同じような状況にある人がいればその助けになればいいかなと思い、記事にしてみました！</p>\n\n<p>完成品のリポジトリは<a href="https://github.com/282Haniwa/nuxt-electron-example" rel="nofollow noopener" target="_blank">こちら</a>ですので、見ながらもしくは、これをcloneして使っていただいても大丈夫です！</p>\n\n<h2>\n<span id="nuxtjs--typescriptのプロジェクトを作る" class="fragment"></span><a href="#nuxtjs--typescript%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Nuxt.js + TypeScriptのプロジェクトを作る</h2>\n\n<p><code>create-nuxt-app</code>を利用して、プロジェクトを作ります。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span>yarn create nuxt-app nuxt-electron-example\n<span class="c">...\n</span><span class="go">create-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in nuxt-electron-test\n? Project name: nuxt-electron-test\n? Programming language: TypeScript\n? Package manager: Yarn\n? UI framework: Vuetify.js\n</span><span class="gp">? Nuxt.js modules: (Press &lt;space&gt;</span><span class="w"> </span>to <span class="k">select</span>, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection<span class="o">)</span>\n<span class="go">? Linting tools: ESLint, Prettier, Lint staged files, StyleLint\n? Testing framework: Jest\n? Rendering mode: Single Page App\n? Deployment target: Static (Static/JAMStack hosting)\n</span><span class="gp">? Development tools: (Press &lt;space&gt;</span><span class="w"> </span>to <span class="k">select</span>, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection<span class="o">)</span>\n<span class="go">? Version control system: Git\n</span></pre></div></div>\n\n<p>今回は、上の通りにプロジェクトを構築している前提で進めていきますが、自分の環境でお好みの設定にしながら読み進めてください。</p>\n\n<h2>\n<span id="electronの対応をする" class="fragment"></span><a href="#electron%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electronの対応をする</h2>\n\n<p>Electronを導入して、ElectronのrendererでNuxt.jsが動くように設定していきます。</p>\n\n<h3>\n<span id="ディレクトリ構成を変更する" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ディレクトリ構成を変更する</h3>\n\n<p>最終的に以下のようなディレクトリ構成になります。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>.\n├── README.md\n├── build\n├── dist\n├── electron-builder.yml\n├── package.json\n├── src\n│   ├── main\n│   └── renderer\n└── yarn.lock\n</pre></div></div>\n\n<p>先ほど生成したNuxt.jsの必要なコードを<code>src/renderer</code>のなかに移動します。<br>\n移動した後は、以下のようになります。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>src/renderer\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── pages\n├── plugins\n├── static\n├── store\n├── test\n└── tsconfig.json\n</pre></div></div>\n\n<h3>\n<span id="コンフィグを書き換える" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%82%92%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>コンフィグを書き換える</h3>\n\n<p>この状態でNuxt.jsのプロジェクトを普通に実行できるようにコンフィグを書き換えていきます。</p>\n\n<p>このあと使っていくのはこの二つのスクリプトのみなので、nuxtのbuildなどに関するscriptはこの二つだけにします。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="err">...</span><span class="w">\n</span><span class="nl">"dev:renderer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts src/renderer"</span><span class="err">,</span><span class="w">\n</span><span class="nl">"build:renderer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-ts generate src/renderer"</span><span class="err">,</span><span class="w">\n</span><span class="err">...</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>この状態で<code>yarn dev:renderer</code>を実行して、Nuxt.jsのプロジェクトが正しく実行できることを確認します。</p>\n\n<p>ついでに、jestの設定も書き換えておきましょう。</p>\n\n<p>スクリプトを貼ると長くなるのでリンクを置いておきます。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/jest.config.js" rel="nofollow noopener" target="_blank">jest.config.js</a></p>\n\n<h3>\n<span id="electronで動かす" class="fragment"></span><a href="#electron%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99"><i class="fa fa-link"></i></a>Electronで動かす</h3>\n\n<p>次に実際にElectronで動かせるようにしていきましょう。</p>\n\n<h4>\n<span id="electronとそれに関連する必要なパッケージをインストールする" class="fragment"></span><a href="#electron%E3%81%A8%E3%81%9D%E3%82%8C%E3%81%AB%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electronとそれに関連する必要なパッケージをインストールする</h4>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn add <span class="nt">--dev</span> electron electron-builder electron-devtools-installer\n</pre></div></div>\n\n<p>ElectronのmainプロセスのスクリプトもTypeScriptで書きたいのでtypescriptをインストールします。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn add <span class="nt">--dev</span> typescript\n</pre></div></div>\n\n<p>build時のコンフィグを変えたいのでcross-envをインストールします。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span class="nv">$ </span>yarn add <span class="nt">--dev</span> cross-env\n</pre></div></div>\n\n<h4>\n<span id="electronの実行に必要な設定をする" class="fragment"></span><a href="#electron%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electronの実行に必要な設定をする</h4>\n\n<p>Electronを実行できるように、<code>src/main/index.ts</code>を書きます。<br>\n後々必要になってくると思うので、<code>src/main/preload.ts</code>も空ファイルのままで生成して設定しておきます。</p>\n\n<p>スクリプトを貼ると長くなるのでリンクを置いておきます。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/main/index.ts" rel="nofollow noopener" target="_blank">src/main/index.ts</a></p>\n\n<p>※ preload.tsには、electronのmainプロセスからrendererプロセスにオブジェクトを渡したりするために使ったりします。<br>\n例) <a href="https://qiita.com/pochman/items/64b34e9827866664d436" id="reference-0f3cfc74c67dab9ae673">ElectronでcontextBridgeによる安全なIPC通信</a></p>\n\n<p>TypeSciprtで書いたのでコンパイル用に<code>tsconfig.json</code>を生成しておきます。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/main/tsconfig.json" rel="nofollow noopener" target="_blank">src/main/tsconfig.json</a></p>\n\n<p>ポイントとしては、以下の3点です。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>"target": "es5"\n"module": "commonjs"\n"outDir": "../../dist"\n</pre></div></div>\n\n<p>Electronで実行するので、<code>target</code>に<code>es5</code>と<code>module</code>に<code>commonjs</code>を設定しています。<br>\nまた、<code>outDir</code>を<code>../../dist</code>にしておくことで、ルートの<code>dist</code>ディレクトリにコンパイルされたものが出力されるようになっています。</p>\n\n<h4>\n<span id="electronでnuxtjsを使うための設定をする" class="fragment"></span><a href="#electron%E3%81%A7nuxtjs%E3%82%92%E4%BD%BF%E3%81%86%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ElectronでNuxt.jsを使うための設定をする</h4>\n\n<p>次に、Nuxt.jsの設定を書き換えていきます。<br>\nNuxt.jsをアプリに向けてビルドするためにいくつかの設定を書き足します。</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="kd">const</span> <span class="nx">isProduction</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">production</span><span class="dl">\'</span>\n<span class="kd">const</span> <span class="nx">isDev</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">\'</span><span class="s1">development</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="na">dev</span><span class="p">:</span> <span class="nx">isDev</span><span class="p">,</span>\n  <span class="na">router</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">mode</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">hash</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDev</span><span class="p">)</span> <span class="p">{</span>\n        <span class="c1">// absolute path to files on production (default value: \'/_nuxt/\')</span>\n        <span class="nx">config</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">publicPath</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">_nuxt/</span><span class="dl">\'</span>\n      <span class="p">}</span>\n      <span class="nx">config</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="na">__dirname</span><span class="p">:</span> <span class="o">!</span><span class="nx">isProduction</span><span class="p">,</span>\n        <span class="na">__filename</span><span class="p">:</span> <span class="o">!</span><span class="nx">isProduction</span><span class="p">,</span>\n      <span class="p">}</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n  <span class="na">generate</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">dir</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">../../dist/nuxt-build</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">},</span>\n  <span class="na">telemetry</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>上のように記述を足してください。<br>\n特に重要な部分は<br>\n<code>publicPath</code>とrouterの<code>mode: \'hash\'</code>です。<br>\nElectronではrouterのモードが<code>hash</code>でないと動かないのと、publicPathを相対パスにしておかないと、ビルドしたjsなどのファイルを読み込むことができません。<br>\n後の設定はお好みですが、今回は全ての出力をルートディレクトリの<code>dist</code>に出力するために設定しています。</p>\n\n<p>細かい設定は<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/renderer/nuxt.config.js" rel="nofollow noopener" target="_blank">src/renderer/nuxt.config.js</a>を参考にしてください。</p>\n\n<p><strong>※ この時に<code>nuxt.config.js</code>でimportしているパッケージがあれば注意してください。</strong><br>\n例) <code>import colors from \'vuetify/es5/util/colors\'</code>など</p>\n\n<p>Electronがそれらのパッケージをバインドできるように、<code>dependencies</code>に追加しておく必要があります。<br>\n例) <code>yarn add vuetify</code></p>\n\n<p>その他にいい方法があれば、コメントで教えてください。</p>\n\n<h4>\n<span id="electronのビルド用コンフィグを作成する" class="fragment"></span><a href="#electron%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Electronのビルド用コンフィグを作成する</h4>\n\n<p>下のリンクを参考にして作成してください。<br>\n適宜必要な部分を書き換えてください。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/electron-builder.yml" rel="nofollow noopener" target="_blank">electron-builder.yml</a></p>\n\n<h4>\n<span id="packagejsonのscriptsを整理する" class="fragment"></span><a href="#packagejson%E3%81%AEscripts%E3%82%92%E6%95%B4%E7%90%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>package.jsonのscriptsを整理する</h4>\n\n<p>先に、Electronを実行するために、package.jsonの<code>main</code>を設定しなければいけないので、<code>dist/main/index.js</code>を実行するようにしておきましょう。</p>\n\n<div class="code-frame" data-lang="json">\n<div class="code-lang"><span class="bold">package.json</span></div>\n<div class="highlight"><pre><span class="p">{</span><span class="w">\n  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nuxt-electron-example"</span><span class="p">,</span><span class="w">\n  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">\n  </span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">\n  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist/main/index.js"</span><span class="p">,</span><span class="w">\n  </span><span class="err">...</span><span class="w">\n</span><span class="p">}</span><span class="w">\n</span></pre></div>\n</div>\n\n<p>下のリンクを参考にして作成してください。<br>\n<a href="https://github.com/282Haniwa/nuxt-electron-example/blob/master/package.json" rel="nofollow noopener" target="_blank">package.json</a></p>\n\n<p>一部パッケージを追加しています。</p>\n\n<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span class="gp">$</span><span class="w"> </span>yarn add <span class="nt">--dev</span> npm-run-all rimraf\n</pre></div></div>\n\n<h3>\n<span id="動くか確認する" class="fragment"></span><a href="#%E5%8B%95%E3%81%8F%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>動くか確認する</h3>\n\n<p><code>yarn dev</code>や<code>yarn build</code>などのコマンドを実行して、きちんと意図した通りに動くか確認します。</p>\n\n<h2>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>\n\n<p>最後まで読んでいただき、ありがとうございました!</p>\n\n<p>かなり試行錯誤しながら環境構築を行ったので、その備忘録として残しておこうと思いました。</p>\n\n<p>もっといい方法があるよ！って方は、コメント欄で教えていただけると嬉しいです！</p>\n\n<h2>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>\n\n<ul>\n<li>参考にさせていただいたリポジトリ → <a href="https://github.com/michalzaq12/electron-nuxt" rel="nofollow noopener" target="_blank">electron-nuxt</a>\n</li>\n<li><a href="https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/commonIssues.html#blank-screen-on-builds-but-works-fine-on-serve" rel="nofollow noopener" target="_blank">roure modeをhashに設定する理由</a></li>\n<li><a href="https://qiita.com/pochman/items/64b34e9827866664d436">ElectronでcontextBridgeによる安全なIPC通信</a></li>\n</ul>\n',body:'## はじめに\n\nElectron + Nuxt.js + TypeScriptの環境を作る必要があったのですが、様々な問題から1から構築した方が良さそうと思ったので、自分で構築してみました。\nもし、同じような状況にある人がいればその助けになればいいかなと思い、記事にしてみました！\n\n完成品のリポジトリは[こちら](https://github.com/282Haniwa/nuxt-electron-example)ですので、見ながらもしくは、これをcloneして使っていただいても大丈夫です！\n\n## Nuxt.js + TypeScriptのプロジェクトを作る\n\n`create-nuxt-app`を利用して、プロジェクトを作ります。\n\n```shell-session\n$ yarn create nuxt-app nuxt-electron-example\n...\ncreate-nuxt-app v3.3.0\n✨  Generating Nuxt.js project in nuxt-electron-test\n? Project name: nuxt-electron-test\n? Programming language: TypeScript\n? Package manager: Yarn\n? UI framework: Vuetify.js\n? Nuxt.js modules: (Press <space> to select, <a> to toggle all, <i> to invert selection)\n? Linting tools: ESLint, Prettier, Lint staged files, StyleLint\n? Testing framework: Jest\n? Rendering mode: Single Page App\n? Deployment target: Static (Static/JAMStack hosting)\n? Development tools: (Press <space> to select, <a> to toggle all, <i> to invert selection)\n? Version control system: Git\n```\n\n今回は、上の通りにプロジェクトを構築している前提で進めていきますが、自分の環境でお好みの設定にしながら読み進めてください。\n\n## Electronの対応をする\n\nElectronを導入して、ElectronのrendererでNuxt.jsが動くように設定していきます。\n\n### ディレクトリ構成を変更する\n\n最終的に以下のようなディレクトリ構成になります。\n\n```\n.\n├── README.md\n├── build\n├── dist\n├── electron-builder.yml\n├── package.json\n├── src\n│   ├── main\n│   └── renderer\n└── yarn.lock\n```\n\n先ほど生成したNuxt.jsの必要なコードを`src/renderer`のなかに移動します。\n移動した後は、以下のようになります。\n\n```\nsrc/renderer\n├── assets\n├── components\n├── layouts\n├── middleware\n├── node_modules\n├── nuxt.config.js\n├── pages\n├── plugins\n├── static\n├── store\n├── test\n└── tsconfig.json\n```\n\n### コンフィグを書き換える\n\nこの状態でNuxt.jsのプロジェクトを普通に実行できるようにコンフィグを書き換えていきます。\n\nこのあと使っていくのはこの二つのスクリプトのみなので、nuxtのbuildなどに関するscriptはこの二つだけにします。\n\n```json:package.json\n...\n"dev:renderer": "nuxt-ts src/renderer",\n"build:renderer": "nuxt-ts generate src/renderer",\n...\n```\n\nこの状態で`yarn dev:renderer`を実行して、Nuxt.jsのプロジェクトが正しく実行できることを確認します。\n\nついでに、jestの設定も書き換えておきましょう。\n\nスクリプトを貼ると長くなるのでリンクを置いておきます。\n[jest.config.js](https://github.com/282Haniwa/nuxt-electron-example/blob/master/jest.config.js)\n\n### Electronで動かす\n\n次に実際にElectronで動かせるようにしていきましょう。\n\n#### Electronとそれに関連する必要なパッケージをインストールする\n\n```shell\n$ yarn add --dev electron electron-builder electron-devtools-installer\n```\n\nElectronのmainプロセスのスクリプトもTypeScriptで書きたいのでtypescriptをインストールします。\n\n```shell\n$ yarn add --dev typescript\n```\n\nbuild時のコンフィグを変えたいのでcross-envをインストールします。\n\n```shell\n$ yarn add --dev cross-env\n```\n\n#### Electronの実行に必要な設定をする\n\nElectronを実行できるように、`src/main/index.ts`を書きます。\n後々必要になってくると思うので、`src/main/preload.ts`も空ファイルのままで生成して設定しておきます。\n\nスクリプトを貼ると長くなるのでリンクを置いておきます。\n[src/main/index.ts](https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/main/index.ts)\n\n※ preload.tsには、electronのmainプロセスからrendererプロセスにオブジェクトを渡したりするために使ったりします。\n例) [ElectronでcontextBridgeによる安全なIPC通信](https://qiita.com/pochman/items/64b34e9827866664d436)\n\nTypeSciprtで書いたのでコンパイル用に`tsconfig.json`を生成しておきます。\n[src/main/tsconfig.json](https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/main/tsconfig.json)\n\nポイントとしては、以下の3点です。\n\n```\n"target": "es5"\n"module": "commonjs"\n"outDir": "../../dist"\n```\n\nElectronで実行するので、`target`に`es5`と`module`に`commonjs`を設定しています。\nまた、`outDir`を`../../dist`にしておくことで、ルートの`dist`ディレクトリにコンパイルされたものが出力されるようになっています。\n\n#### ElectronでNuxt.jsを使うための設定をする\n\n次に、Nuxt.jsの設定を書き換えていきます。\nNuxt.jsをアプリに向けてビルドするためにいくつかの設定を書き足します。\n\n```js:nuxt.config.js\nconst isProduction = process.env.NODE_ENV === \'production\'\nconst isDev = process.env.NODE_ENV === \'development\'\n\nexport default {\n  ...\n  dev: isDev,\n  router: {\n    mode: \'hash\',\n  },\n  build: {\n    extend(config) {\n      if (!isDev) {\n        // absolute path to files on production (default value: \'/_nuxt/\')\n        config.output.publicPath = \'_nuxt/\'\n      }\n      config.node = {\n        __dirname: !isProduction,\n        __filename: !isProduction,\n      }\n    },\n  },\n  generate: {\n    dir: \'../../dist/nuxt-build\',\n  },\n  telemetry: false,\n}\n```\n\n上のように記述を足してください。\n特に重要な部分は\n`publicPath`とrouterの`mode: \'hash\'`です。\nElectronではrouterのモードが`hash`でないと動かないのと、publicPathを相対パスにしておかないと、ビルドしたjsなどのファイルを読み込むことができません。\n後の設定はお好みですが、今回は全ての出力をルートディレクトリの`dist`に出力するために設定しています。\n\n細かい設定は[src/renderer/nuxt.config.js](https://github.com/282Haniwa/nuxt-electron-example/blob/master/src/renderer/nuxt.config.js)を参考にしてください。\n\n**※ この時に`nuxt.config.js`でimportしているパッケージがあれば注意してください。**\n例) `import colors from \'vuetify/es5/util/colors\'`など\n\nElectronがそれらのパッケージをバインドできるように、`dependencies`に追加しておく必要があります。\n例) `yarn add vuetify`\n\nその他にいい方法があれば、コメントで教えてください。\n\n#### Electronのビルド用コンフィグを作成する\n\n下のリンクを参考にして作成してください。\n適宜必要な部分を書き換えてください。\n[electron-builder.yml](https://github.com/282Haniwa/nuxt-electron-example/blob/master/electron-builder.yml)\n\n#### package.jsonのscriptsを整理する\n\n先に、Electronを実行するために、package.jsonの`main`を設定しなければいけないので、`dist/main/index.js`を実行するようにしておきましょう。\n\n```json:package.json\n{\n  "name": "nuxt-electron-example",\n  "version": "1.0.0",\n  "private": true,\n  "main": "dist/main/index.js",\n  ...\n}\n```\n\n下のリンクを参考にして作成してください。\n[package.json](https://github.com/282Haniwa/nuxt-electron-example/blob/master/package.json)\n\n一部パッケージを追加しています。\n\n```shell-session\n$ yarn add --dev npm-run-all rimraf\n```\n\n### 動くか確認する\n\n`yarn dev`や`yarn build`などのコマンドを実行して、きちんと意図した通りに動くか確認します。\n\n## まとめ\n\n最後まで読んでいただき、ありがとうございました!\n\nかなり試行錯誤しながら環境構築を行ったので、その備忘録として残しておこうと思いました。\n\nもっといい方法があるよ！って方は、コメント欄で教えていただけると嬉しいです！\n\n## 参考\n\n- 参考にさせていただいたリポジトリ → [electron-nuxt](https://github.com/michalzaq12/electron-nuxt)\n- [roure modeをhashに設定する理由](https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/commonIssues.html#blank-screen-on-builds-but-works-fine-on-serve)\n- [ElectronでcontextBridgeによる安全なIPC通信](https://qiita.com/pochman/items/64b34e9827866664d436)\n',coediting:a,comments_count:0,created_at:U,group:s,id:"a3b0a7d3c622ad82ac8d",likes_count:0,private:a,reactions_count:0,tags:[{name:"環境構築",versions:[]},{name:f,versions:[]},{name:P,versions:[]},{name:p,versions:[]}],title:"Electron + Nuxt.js + TypeScriptの環境構築",updated_at:U,url:"https://qiita.com/282Haniwa/items/a3b0a7d3c622ad82ac8d",user:{description:s,facebook_id:s,followees_count:1,followers_count:1,github_login_name:l,id:l,items_count:7,linkedin_id:s,location:s,name:n,organization:s,permanent_id:R,profile_image_url:O,team_only:a,twitter_screen_name:M,website_url:s},page_views_count:s},{rendered_body:'<p>Nuxt.js(Vue.js)で<code>Cannot read property \'_normalized\' of undefined</code>のエラーが出た時の対処法です。</p>\n\n<h2>\n<span id="nuxt-linkにtoを指定していないのが原因" class="fragment"></span><a href="#nuxt-link%E3%81%ABto%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8C%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>nuxt-linkにtoを指定していないのが原因</h2>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;nuxt-link&gt;</span>HOME<span class="nt">&lt;/nuxt-link&gt;</span>\n</pre></div></div>\n\n<p>上記のように<code>nuxt-link</code>に<code>to</code>を指定しないと、上記のエラーが起きます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;nuxt-link</span> <span class="na">to=</span><span class="s">"/"</span><span class="nt">&gt;</span>HOME<span class="nt">&lt;/nuxt-link&gt;</span>\n</pre></div></div>\n\n<p><code>to</code>を指定することでエラーが解消されました。</p>\n',body:"Nuxt.js(Vue.js)で`Cannot read property '_normalized' of undefined`のエラーが出た時の対処法です。\n\n## nuxt-linkにtoを指定していないのが原因\n\n```vue\n<nuxt-link>HOME</nuxt-link>\n```\n上記のように\b`nuxt-link`に`to`を指定しないと、上記のエラーが起きます。\n\n```vue\n<nuxt-link to=\"/\">HOME</nuxt-link>\n```\n`to`を指定することでエラーが解消されました。\n",coediting:a,comments_count:0,created_at:H,group:s,id:"3cb711d3c00b4b0d6771",likes_count:0,private:a,reactions_count:0,tags:[{name:p,versions:[]}],title:"Nuxt.js 【Cannot read property '_normalized' of undefined】エラー時の対処法",updated_at:H,url:"https://qiita.com/TK-C/items/3cb711d3c00b4b0d6771",user:{description:"フロントエンドエンジニア目指し中",facebook_id:n,followees_count:0,followers_count:2,github_login_name:"To-Ko5",id:"TK-C",items_count:63,linkedin_id:n,location:n,name:"C",organization:n,permanent_id:559347,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/559347/385b5207b6e67b42cb332c929269fd29937c74ae/x_large.png?1578901134",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h1>\n\n<p>・<a href="#vue%E3%81%A7timer%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%97%E3%81%9F%E3%81%84">vueでtimer設定をしたい</a><br>\n・<a href="#timer%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE">timer設定するために必要なもの</a><br>\n・<a href="#vue-moment%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">vue-momentのインストール</a><br>\n・<a href="#vue-moment%E3%81%AEts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90">vue-momentのtsファイル作成</a><br>\n・<a href="#momentts%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80">moment.tsを読み込む</a><br>\n・<a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7moment%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">vueファイルでmomentを試してみる</a><br>\n・<a href="#moment%E3%81%A7timer%E8%A8%AD%E5%AE%9A%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">momentでtimer設定を試してみる</a></p>\n\n<h2>\n<span id="vueでtimer設定をしたい" class="fragment"></span><a href="#vue%E3%81%A7timer%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>vueでtimer設定をしたい</h2>\n\n<p>vueで一定期間表示する枠や時期が来たら表示または非表示にするためにタイマー設定をして実装したい場合ってありますよね？<br>\n実際、私はその事例に当たったので今回対応したことをお伝えしたいと思います。</p>\n\n<h2>\n<span id="timer設定するために必要なもの" class="fragment"></span><a href="#timer%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>timer設定するために必要なもの</h2>\n\n<p>vueでtimer設定するために</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>vue-moment\n</pre></div></div>\n\n<p>を使用します。</p>\n\n<p>vue-momentは、日付の解析・検証等をするライブラリで、<br>\n日付のフォーマットを「YYYY-MM-DD」に変更した場合や、日付の期間を検証するのに便利なメソッドが揃っています。<br>\nVue.jsプロジェクトに便利なmoment.jsフィルターを提供してくれます。</p>\n\n<h2>\n<span id="vue-momentのインストール" class="fragment"></span><a href="#vue-moment%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>vue-momentのインストール</h2>\n\n<p>npm</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ npm install vue-moment\n</pre></div></div>\n\n<p>yarn</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ yarn add vue-moment\n</pre></div></div>\n\n<p>インストールが終わったら共通で使えるようにjsファイルを作成します。</p>\n\n<h2>\n<span id="vue-momentのtsファイル作成" class="fragment"></span><a href="#vue-moment%E3%81%AEts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>vue-momentのtsファイル作成</h2>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">src/plugins/moment.ts</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="dl">\'</span><span class="s1">vue-moment</span><span class="dl">\'</span><span class="p">))</span>\n</pre></div>\n</div>\n\n<p>ファイルを作成したらnuxt.configで読み込んでおきましょう。</p>\n\n<h2>\n<span id="momenttsを読み込む" class="fragment"></span><a href="#momentts%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>moment.tsを読み込む</h2>\n\n<div class="code-frame" data-lang="typescript">\n<div class="code-lang"><span class="bold">nuxt.config.ts</span></div>\n<div class="highlight"><pre><span class="nx">plugins</span><span class="p">:</span> <span class="p">[{</span> <span class="na">src</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">~/plugins/moment.ts</span><span class="dl">\'</span> <span class="p">}],</span>\n</pre></div>\n</div>\n\n<p>pluginsに先ほど作成したmoment.tsを読み込んでおきます。</p>\n\n<p>ここまでできたらあとは、vue側での実装です。</p>\n\n<h2>\n<span id="vueファイルでmomentを試してみる" class="fragment"></span><a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7moment%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>vueファイルでmomentを試してみる</h2>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;p&gt;</span>\n      <span class="si">{{</span> <span class="nx">now</span> <span class="si">}}</span>\n    <span class="nt">&lt;/p&gt;</span>\n    <span class="nt">&lt;p&gt;</span>\n      <span class="si">{{</span> <span class="nx">end</span> <span class="si">}}</span>\n    <span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">now</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">YYYYMMDDHHmmss</span><span class="dl">\'</span><span class="p">),</span>\n      <span class="na">end</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">20200825150000</span><span class="dl">\'</span><span class="p">),</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>このようなファイルを作ると<br>\nnowは今の日時・時間・分・秒まで取得します。<br>\n今回はendとしてますが、表示を開始するなどの場合はstartなどにするといいと思います。<br>\nendには表示を終了する日時・時間・分・秒を設定しておきます。</p>\n\n<p>この状態で上記を表示すると</p>\n\n<p class="codepen" data-height="265" data-default-tab="js,result" data-slug-hash="zYqZqLW">\n  See the Pen <a href="https://codepen.io/miyawash/pen/zYqZqLW" rel="nofollow noopener" target="_blank">\n  vue-moment</a> by miyawash (<a href="https://codepen.io/miyawash" rel="nofollow noopener" target="_blank">@miyawash</a>)\n  on <a href="https://codepen.io" rel="nofollow noopener" target="_blank">CodePen</a>.\n</p>\n\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\n<p>これをベースにタイマー設定をしてみます。</p>\n\n<h2>\n<span id="momentでtimer設定を試してみる" class="fragment"></span><a href="#moment%E3%81%A7timer%E8%A8%AD%E5%AE%9A%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>momentでtimer設定を試してみる</h2>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;p&gt;</span>\n      <span class="si">{{</span> <span class="nx">now</span> <span class="si">}}</span>\n    <span class="nt">&lt;/p&gt;</span>\n    <span class="nt">&lt;p&gt;</span>\n      <span class="si">{{</span> <span class="nx">end</span> <span class="si">}}</span>\n    <span class="nt">&lt;/p&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">v-if=</span><span class="s">"now </span><span class="nt">&lt;</span> <span class="nt">end</span><span class="err">"</span><span class="nt">&gt;</span>まだ設定時間ではない<span class="nt">&lt;/p&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">v-else</span><span class="nt">&gt;</span>設定時間をすぎた<span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">now</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">YYYYMMDDHHmmss</span><span class="dl">\'</span><span class="p">),</span>\n      <span class="na">end</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">\'</span><span class="s1">20200825150000</span><span class="dl">\'</span><span class="p">),</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<p>このように実装すると設定時間までは<br>\n「まだ設定時間ではない」が表示され、設定時間後は「設定時間をすぎた」が表示される<br>\nこれにより、設定時間までの表示や設定時間からの表示などができるようになりました！</p>\n\n<p class="codepen" data-height="265" data-default-tab="js,result" data-slug-hash="GRZWZLg">\n  See the Pen <a href="https://codepen.io/miyawash/pen/GRZWZLg" rel="nofollow noopener" target="_blank">\n  vue-moment timer</a> by miyawash (<a href="https://codepen.io/miyawash" rel="nofollow noopener" target="_blank">@miyawash</a>)\n  on <a href="https://codepen.io" rel="nofollow noopener" target="_blank">CodePen</a>.\n</p>\n\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\n<p>参考資料<br>\n<a href="https://classic.yarnpkg.com/ja/package/vue-moment" class="autolink" rel="nofollow noopener" target="_blank">https://classic.yarnpkg.com/ja/package/vue-moment</a><br>\n<a href="https://www.npmjs.com/package/vue-moment" class="autolink" rel="nofollow noopener" target="_blank">https://www.npmjs.com/package/vue-moment</a><br>\n<a href="https://momentjs.com/" class="autolink" rel="nofollow noopener" target="_blank">https://momentjs.com/</a><br>\n<a href="https://qiita.com/taizo/items/3a5505308ca2e303c099" class="autolink" id="reference-9ddf8b30cfebdd49977c">https://qiita.com/taizo/items/3a5505308ca2e303c099</a><br>\n<a href="https://blog.capilano-fw.com/?p=908#24_8_20" class="autolink" rel="nofollow noopener" target="_blank">https://blog.capilano-fw.com/?p=908#24_8_20</a></p>\n',body:'# 目次\n・[vueでtimer設定をしたい](#vueでtimer設定をしたい)\n・[timer設定するために必要なもの](#timer設定するために必要なもの)\n・[vue-momentのインストール](#vue-momentのインストール)\n・[vue-momentのtsファイル作成](#vue-momentのtsファイル作成)\n・[moment.tsを読み込む](#momenttsを読み込む)\n・[vueファイルでmomentを試してみる](#vueファイルでmomentを試してみる)\n・[momentでtimer設定を試してみる](#momentでtimer設定を試してみる)\n\n## vueでtimer設定をしたい\nvueで一定期間表示する枠や時期が来たら表示または非表示にするためにタイマー設定をして実装したい場合ってありますよね？\n実際、私はその事例に当たったので今回対応したことをお伝えしたいと思います。\n\n## timer設定するために必要なもの\nvueでtimer設定するために\n\n```\nvue-moment\n```\nを使用します。\n\nvue-momentは、日付の解析・検証等をするライブラリで、\n日付のフォーマットを「YYYY-MM-DD」に変更した場合や、日付の期間を検証するのに便利なメソッドが揃っています。\nVue.jsプロジェクトに便利なmoment.jsフィルターを提供してくれます。\n\n## vue-momentのインストール\n\nnpm\n\n```\n$ npm install vue-moment\n```\n\nyarn\n\n```\n$ yarn add vue-moment\n```\n\nインストールが終わったら共通で使えるようにjsファイルを作成します。\n\n## vue-momentのtsファイル作成\n\n```src/plugins/moment.ts\nimport Vue from \'vue\'\nVue.use(require(\'vue-moment\'))\n```\n\nファイルを作成したらnuxt.configで読み込んでおきましょう。\n\n## moment.tsを読み込む\n\n```nuxt.config.ts\nplugins: [{ src: \'~/plugins/moment.ts\' }],\n```\npluginsに先ほど作成したmoment.tsを読み込んでおきます。\n\nここまでできたらあとは、vue側での実装です。\n\n## vueファイルでmomentを試してみる\n\n```vue\n<template>\n    <p>\n      {{ now }}\n    </p>\n    <p>\n      {{ end }}\n    </p>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      now: this.$moment().format(\'YYYYMMDDHHmmss\'),\n      end: this.$moment().format(\'20200825150000\'),\n    }\n  },\n}\n<\/script>\n```\nこのようなファイルを作ると\nnowは今の日時・時間・分・秒まで取得します。\n今回はendとしてますが、表示を開始するなどの場合はstartなどにするといいと思います。\nendには表示を終了する日時・時間・分・秒を設定しておきます。\n\nこの状態で上記を表示すると\n\n<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="miyawash" data-slug-hash="zYqZqLW" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="vue-moment">\n  <span>See the Pen <a href="https://codepen.io/miyawash/pen/zYqZqLW">\n  vue-moment</a> by miyawash (<a href="https://codepen.io/miyawash">@miyawash</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nこれをベースにタイマー設定をしてみます。\n\n## momentでtimer設定を試してみる\n\n```vue\n<template>\n    <p>\n      {{ now }}\n    </p>\n    <p>\n      {{ end }}\n    </p>\n    <p v-if="now < end">まだ設定時間ではない</p>\n    <p v-else>設定時間をすぎた</p>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      now: this.$moment().format(\'YYYYMMDDHHmmss\'),\n      end: this.$moment().format(\'20200825150000\'),\n    }\n  },\n}\n<\/script>\n```\nこのように実装すると設定時間までは\n「まだ設定時間ではない」が表示され、設定時間後は「設定時間をすぎた」が表示される\nこれにより、設定時間までの表示や設定時間からの表示などができるようになりました！\n\n<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="miyawash" data-slug-hash="GRZWZLg" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="vue-moment timer">\n  <span>See the Pen <a href="https://codepen.io/miyawash/pen/GRZWZLg">\n  vue-moment timer</a> by miyawash (<a href="https://codepen.io/miyawash">@miyawash</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\n\n参考資料\nhttps://classic.yarnpkg.com/ja/package/vue-moment\nhttps://www.npmjs.com/package/vue-moment\nhttps://momentjs.com/\nhttps://qiita.com/taizo/items/3a5505308ca2e303c099\nhttps://blog.capilano-fw.com/?p=908#24_8_20\n',coediting:a,comments_count:0,created_at:"2020-09-28T19:53:24+09:00",group:s,id:"244ca83f80ab50afa19c",likes_count:1,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:"moment.js",versions:[]},{name:"timer",versions:[]},{name:e,versions:[]},{name:p,versions:[]}],title:"【vue-moment】vueでtimer設定する方法",updated_at:"2020-09-28T19:59:49+09:00",url:"https://qiita.com/miyawash/items/244ca83f80ab50afa19c",user:{description:n,facebook_id:n,followees_count:0,followers_count:1,github_login_name:s,id:Y,items_count:4,linkedin_id:n,location:n,name:Y,organization:n,permanent_id:547952,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/547952/01a27ad55f8242070dd998226ae7060dba4c2168/x_large.png?1598347488",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>netlifyはgitと連携しておけば勝手にビルド＆デプロイをしてくれるのでめちゃくちゃ楽なんだけど、無料プランではビルド時間が月300分までとなっている。<br>\nこれを回避するためにgithub actionsを使ってgithub側でビルドしてあげよう。という作戦。</p>\n\n<p>何よりも最初に注意しておくべきなのは、1度gitと連携してしまうと勝手にビルドする設定になってしまうこと。<br>\n自動ビルドを停止することはできるけど、それをやるとデプロイまで停止される。<br>\nそのためこの方法を取るときは、gitとは連携せずに、ファイルをドラッグアンドドロップで追加することでサイトを追加する方法を取る必要がある。<br>\n(運営に連絡したら連携済みのgitとの連携を解除してくれるみたいだけど)</p>\n\n<p>ドラッグ&amp;ドロップする画面スクショ<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2F8d5c39bd-a735-50f8-57a8-f8bf9431cdc5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=16f146104d8a80259a5a4ca8f4504596" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2F8d5c39bd-a735-50f8-57a8-f8bf9431cdc5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=16f146104d8a80259a5a4ca8f4504596" alt="スクリーンショット 2020-09-28 16.19.14.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/306936/8d5c39bd-a735-50f8-57a8-f8bf9431cdc5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2F8d5c39bd-a735-50f8-57a8-f8bf9431cdc5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=08a924cb28de8ef00860994f74206160 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h1>\n\n<p>githubとnetlifyの設定はぐぐったらわかると思うので割愛します。<br>\nトークンとサイトIDの設定だけしておいてください。</p>\n\n<p>【参考】<br>\n<a href="https://qiita.com/nwtgck/items/e9a355c2ccb03d8e8eb0" class="autolink" id="reference-ec2268c627ff729c0e79">https://qiita.com/nwtgck/items/e9a355c2ccb03d8e8eb0</a></p>\n\n<p>あとは.github/workflow.deploy.ymlを追加するだけ。<br>\nここで注意したいのはnetlify/actions/cliの部分で--prodを使うこと。<br>\nこれはぐぐってもよくわからなかったけど、--prodをつけないとnetlifyのデプロイがDeploy Previewになってしまい、publishedにならない。<br>\nこのせいで結構困ったけど、--prodをつけたらちゃんと自動でデプロイしてくれた。</p>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">github/workflow.deploy.yml</span></div>\n<div class="highlight"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">production deploy</span>\n\n<span class="na">on</span><span class="pi">:</span>\n  <span class="na">push</span><span class="pi">:</span>\n    <span class="na">branches</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="s">master</span>\n\n<span class="na">jobs</span><span class="pi">:</span>\n  <span class="na">deploy</span><span class="pi">:</span>\n    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-18.04</span>\n    <span class="na">env</span><span class="pi">:</span>\n      <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GIT_TOKEN_COVID19 }}</span>\n    <span class="na">steps</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">ref</span><span class="pi">:</span> <span class="s">master</span>\n\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Node</span>\n        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">node-version</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">10.x\'</span>\n\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get yarn cache directory path</span>\n        <span class="na">id</span><span class="pi">:</span> <span class="s">yarn-cache-dir-path</span>\n        <span class="na">run</span><span class="pi">:</span> <span class="s">echo "::set-output name=dir::$(yarn cache dir)"</span>\n\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache dependencies</span>\n        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v2</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">path</span><span class="pi">:</span> <span class="s">${{ steps.yarn-cache-dir-path.outputs.dir }}</span>\n          <span class="na">key</span><span class="pi">:</span> <span class="s">${{ runner.os }}-yarn-${{ hashFiles(\'yarn.lock\') }}</span>\n          <span class="na">restore-keys</span><span class="pi">:</span> <span class="pi">|</span>\n            <span class="s">${{ runner.os }}-yarn-</span>\n\n      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">yarn install --frozen-lockfile</span>\n      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">yarn run test</span>\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">generate</span>\n        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>\n          <span class="s">yarn run generate:deploy --fail-on-page-error</span>\n\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>\n        <span class="na">uses</span><span class="pi">:</span> <span class="s">netlify/actions/cli@master</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">args</span><span class="pi">:</span> <span class="s">deploy --dir=dist --prod</span>\n        <span class="na">env</span><span class="pi">:</span>\n          <span class="na">NETLIFY_SITE_ID</span><span class="pi">:</span> <span class="s">${{ secrets.NETLIFY_SITE_ID }}</span>\n          <span class="na">NETLIFY_AUTH_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GIT_TOKEN_COVID19 }}</span>\n</pre></div>\n</div>\n\n<h1>\n<span id="補足---prod問題" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3---prod%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>補足 --prod問題</h1>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2Fe35d15f1-7832-fc63-dbc7-ca659f1b3c6d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=82c413906f358d46e3c2ae3b5b5ff04f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2Fe35d15f1-7832-fc63-dbc7-ca659f1b3c6d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=82c413906f358d46e3c2ae3b5b5ff04f" alt="スクリーンショット 2020-09-28 11.37.55.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/306936/e35d15f1-7832-fc63-dbc7-ca659f1b3c6d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F306936%2Fe35d15f1-7832-fc63-dbc7-ca659f1b3c6d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fc70f158dcc946c0765d8ce024f55c11 1x" loading="lazy"></a></p>\n\n<p>公開されるデプロイには緑のpublishedというマークがつくが、gitにpushしてもnetlify上ではDeploy Previewというデプロイが表示されるだけで、publishedにならない。</p>\n\n<p>ymlファイルのnetlify/actions/cliの部分で--prodをつけたら解決した。<br>\nぐぐってもよくわからなかったけど、--prodはproductionの略なのかな？</p>\n',body:"netlifyはgitと連携しておけば勝手にビルド＆デプロイをしてくれるのでめちゃくちゃ楽なんだけど、無料プランではビルド時間が月300分までとなっている。\nこれを回避するためにgithub actionsを使ってgithub側でビルドしてあげよう。という作戦。\n\n何よりも最初に注意しておくべきなのは、1度gitと連携してしまうと勝手にビルドする設定になってしまうこと。\n自動ビルドを停止することはできるけど、それをやるとデプロイまで停止される。\nそのためこの方法を取るときは、gitとは連携せずに、ファイルをドラッグアンドドロップで追加することでサイトを追加する方法を取る必要がある。\n(運営に連絡したら連携済みのgitとの連携を解除してくれるみたいだけど)\n\nドラッグ&ドロップする画面スクショ\n![スクリーンショット 2020-09-28 16.19.14.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/306936/8d5c39bd-a735-50f8-57a8-f8bf9431cdc5.png)\n\n\n#設定\ngithubとnetlifyの設定はぐぐったらわかると思うので割愛します。\nトークンとサイトIDの設定だけしておいてください。\n\n【参考】\nhttps://qiita.com/nwtgck/items/e9a355c2ccb03d8e8eb0\n\nあとは.github/workflow.deploy.ymlを追加するだけ。\nここで注意したいのはnetlify/actions/cliの部分で--prodを使うこと。\nこれはぐぐってもよくわからなかったけど、--prodをつけないとnetlifyのデプロイがDeploy Previewになってしまい、publishedにならない。\nこのせいで結構困ったけど、--prodをつけたらちゃんと自動でデプロイしてくれた。\n\n\n```.github/workflow.deploy.yml\nname: production deploy\n\non:\n  push:\n    branches:\n      - master\n\njobs:\n  deploy:\n    runs-on: ubuntu-18.04\n    env:\n      GITHUB_TOKEN: ${{ secrets.GIT_TOKEN_COVID19 }}\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          ref: master\n\n      - name: Setup Node\n        uses: actions/setup-node@v1\n        with:\n          node-version: '10.x'\n\n      - name: Get yarn cache directory path\n        id: yarn-cache-dir-path\n        run: echo \"::set-output name=dir::$(yarn cache dir)\"\n\n      - name: Cache dependencies\n        uses: actions/cache@v2\n        with:\n          path: ${{ steps.yarn-cache-dir-path.outputs.dir }}\n          key: ${{ runner.os }}-yarn-${{ hashFiles('yarn.lock') }}\n          restore-keys: |\n            ${{ runner.os }}-yarn-\n\n      - run: yarn install --frozen-lockfile\n      - run: yarn run test\n      - name: generate\n        run: |\n          yarn run generate:deploy --fail-on-page-error\n\n      - name: Deploy\n        uses: netlify/actions/cli@master\n        with:\n          args: deploy --dir=dist --prod\n        env:\n          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}\n          NETLIFY_AUTH_TOKEN: ${{ secrets.GIT_TOKEN_COVID19 }}\n```\n\n#補足 --prod問題\n![スクリーンショット 2020-09-28 11.37.55.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/306936/e35d15f1-7832-fc63-dbc7-ca659f1b3c6d.png)\n\n公開されるデプロイには緑のpublishedというマークがつくが、gitにpushしてもnetlify上ではDeploy Previewというデプロイが表示されるだけで、publishedにならない。\n\nymlファイルのnetlify/actions/cliの部分で--prodをつけたら解決した。\nぐぐってもよくわからなかったけど、--prodはproductionの略なのかな？\n",coediting:a,comments_count:0,created_at:"2020-09-28T11:49:40+09:00",group:s,id:"3918152f15dd0901f0ba",likes_count:1,private:a,reactions_count:0,tags:[{name:"GitHub",versions:[]},{name:"Netlify",versions:[]},{name:p,versions:[]}],title:"nuxtをgithub actionsでnetlifyに自動デプロイする",updated_at:"2020-09-28T16:22:13+09:00",url:"https://qiita.com/banzyyy/items/3918152f15dd0901f0ba",user:{description:s,facebook_id:s,followees_count:0,followers_count:1,github_login_name:V,id:V,items_count:8,linkedin_id:s,location:s,name:n,organization:s,permanent_id:306936,profile_image_url:"https://avatars3.githubusercontent.com/u/41957838?v=4",team_only:a,twitter_screen_name:s,website_url:s},page_views_count:s},{rendered_body:'\n<h1>\n<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h1>\n\n<p>以前AnsibleのDockerモジュールを活用してDockerコンテナのイメージビルドからコンテナ作成までをAnsible上で行いました。<a href="https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323" id="reference-8452ad43cefa83daff04">Ansibleを使ってNuxt.jsのDockerコンテナを構築してみた</a><br>\nその時はAnsible-Containerというコンテナ管理に便利なツールがあることを紹介しましたが、2020年現在は開発終了されています。ただし、その後ansible-benderというAnsible Containerの機能を一部引き継いだツールが新しく登場しました。<br>\n今回はansible-benderを使ってコンテナイメージをビルドしていきたいと思います。</p>\n\n<h1>\n<span id="ansible-benderについて" class="fragment"></span><a href="#ansible-bender%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>ansible-benderについて</h1>\n\n<p>ansible-benderはAnsible Playbookを使ってコンテナイメージをビルドすることができるツールです。(<a href="https://github.com/ansible-community/ansible-bender" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ansible-community/ansible-bender</a>)<br>\nDockerモジュールでは、Dockerfileの宛先パスをPlaybookで指定してコンテナイメージのビルドを行いましたが、ansible-benderでは直接Playbook内にコンテナイメージを記述することでコンテナイメージのビルドが可能となります。pipパッケージからインストールすることが可能です。<br>\n<code>pip install ansible-bender</code></p>\n\n<h1>\n<span id="必須要件" class="fragment"></span><a href="#%E5%BF%85%E9%A0%88%E8%A6%81%E4%BB%B6"><i class="fa fa-link"></i></a>必須要件</h1>\n\n<p>ansible-benderを動かすには予めPodmanとBuildahをインストールする必要があります。<br>\nこちらのツールは<a href="https://qiita.com/Yuhta/private/c2597bef7a5eb3bb6c53" id="reference-14e88e19d124e343caae">前回の記事</a>で紹介していますので、初めてツールの存在を知った方はそちらの記事もご参照ください。<br>\nまたコンテナイメージをビルドする際、Pythonのインストールされたコンテナベースイメージが必要です。(Python2系3系問わない)<br>\n事前にPythonを含む最小コンテナイメージを用意しておくと後々便利です。参考記事<a href="https://qiita.com/tsuchm/items/90a49b827130f80f5e46" id="reference-6ac11dbdcb0be38802fe">ansible-bender でコンテナイメージを作成する</a></p>\n\n<div class="code-frame" data-lang="Dockerfile"><div class="highlight"><pre><span class="k">FROM</span><span class="s"> debian:buster</span>\n<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get <span class="nb">install</span> <span class="nt">-y</span> python3 <span class="o">&amp;&amp;</span> apt-get clean\n</pre></div></div>\n\n<h1>\n<span id="コンテナイメージのビルド" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>コンテナイメージのビルド</h1>\n\n<p>ansible-benderの準備ができましたら、コンテナイメージのビルドを行っていきます。<br>\nここでは、前回の<a href="https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323">記事</a>で構築したNuxt.jsのコンテナイメージをansible-benderでビルドできるか検証していきます。</p>\n\n<h6>\n<span id="ベースコンテナイメージの取得" class="fragment"></span><a href="#%E3%83%99%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>ベースコンテナイメージの取得</h6>\n\n<div class="code-frame" data-lang="dockerfile">\n<div class="code-lang"><span class="bold">Dockerfile</span></div>\n<div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:latest  </span>\n<span class="k">WORKDIR</span><span class="s"> /app  </span>\n<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive apt-get <span class="nb">install</span> <span class="nt">-y</span> python3 <span class="o">&amp;&amp;</span> apt-get clean\n</pre></div>\n</div>\n\n<p>Debianコンテナをベースイメージにするよりもnodeイメージをベースにした方が後々のコンテナイメージビルドが楽になりますので、nodeイメージにPythonをインストールしてベースイメージを取得しました。続いてディレクトリ構成について紹介します。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>├── Prototype  \n│   └── app/(Nuxt.jsのひな型)    \n└── build_nuxtimage.yml\n</pre></div></div>\n\n<p>前回<a href="https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323">記事</a>を踏襲していますが、変更点としてはDockerfileがなくなっております。コンテナイメージの作成を<code>build_nuxtimage.yml</code>で作成するので、不要となります。<br>\n比較用に前回のDockerfileの中身も載せて置きます。</p>\n\n<div class="code-frame" data-lang="dockerfile">\n<div class="code-lang"><span class="bold">Dockerfile</span></div>\n<div class="highlight"><pre><span class="k">FROM</span><span class="s"> node:latest</span>\n<span class="k">ENV</span><span class="s"> NUXT_HOST=0.0.0.0</span>\n<span class="k">ENV</span><span class="s"> NUXT_TELEMETRY_DISABLED=1</span>\n<span class="k">WORKDIR</span><span class="s"> /app</span>\n\n<span class="k">COPY</span><span class="s"> ./app/package.json ./app/yarn.lock ./</span>\n<span class="k">RUN </span>yarn <span class="nb">install</span>\n\n<span class="k">COPY</span><span class="s"> ./app .</span>\n\n<span class="k">CMD</span><span class="s"> ["yarn", "run", "dev"]</span>\n</pre></div>\n</div>\n\n<p>これをansible-benderのPlaybookに直しますと次のようになります。</p>\n\n<div class="code-frame" data-lang="yaml">\n<div class="code-lang"><span class="bold">build_nuxtimage.yml</span></div>\n<div class="highlight"><pre><span class="nn">---</span>  \n<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Nuxt.js image</span>  \n  <span class="na">hosts</span><span class="pi">:</span> <span class="s">all</span>  \n  <span class="na">gather_facts</span><span class="pi">:</span> <span class="no">false</span>  \n  <span class="na">vars</span><span class="pi">:</span>  \n    <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s">/usr/bin/python3</span>  \n    <span class="na">ansible_bender</span><span class="pi">:</span>  \n      <span class="na">base_image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">localhost/node-python3"</span>  \n      <span class="na">ansible_extra_args</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-vvv"</span>  \n\n      <span class="na">target_image</span><span class="pi">:</span>  \n        <span class="na">name</span><span class="pi">:</span> <span class="s">yuta28/bender-test</span>  \n        <span class="na">working_dir</span><span class="pi">:</span> <span class="s">/app</span>  \n        <span class="na">environment</span><span class="pi">:</span>  \n          <span class="na">NUXT_HOST</span><span class="pi">:</span> <span class="s">0.0.0.0</span>  \n        <span class="na">labels</span><span class="pi">:</span>  \n          <span class="na">built-by</span><span class="pi">:</span> <span class="s1">\'</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_user</span><span class="nv"> </span><span class="s">}}\'</span>  \n        <span class="na">cmd</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yarn</span><span class="nv"> </span><span class="s">run</span><span class="nv"> </span><span class="s">dev"</span>  \n\n  <span class="na">tasks</span><span class="pi">:</span>  \n  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Copy Prototype parts</span>  \n    <span class="na">copy</span><span class="pi">:</span>  \n      <span class="na">src</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}"</span>  \n      <span class="na">dest</span><span class="pi">:</span> <span class="s">/app/</span>  \n    <span class="na">with_items</span><span class="pi">:</span>  \n      <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/Prototype/app/package.json"</span>  \n      <span class="pi">-</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/Prototype/app/yarn.lock"</span>  \n\n  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Yarn install</span>  \n    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yarn</span><span class="nv"> </span><span class="s">install"</span>  \n\n  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Archive app directory</span>  \n    <span class="na">delegate_to</span><span class="pi">:</span> <span class="s">localhost</span>  \n    <span class="na">archive</span><span class="pi">:</span>  \n      <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/Prototype/app"</span>  \n      <span class="na">dest</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/Prototype/app.tar.gz"</span>  \n      <span class="na">format</span><span class="pi">:</span> <span class="s">gz</span>  \n\n  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Unpacks app.tar.gz</span>  \n    <span class="na">unarchive</span><span class="pi">:</span>  \n      <span class="na">src</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/Prototype/app.tar.gz"</span>  \n      <span class="na">dest</span><span class="pi">:</span> <span class="s">/</span>\n</pre></div>\n</div>\n\n<p>Dockerfile内のRUN命令箇所は、commandモジュール、CMD命令はtarget_image内のcmd変数に変換してPlaybookでコンテナのイメージビルドのPlaybookを作成しました。<br>\n基本的にはTaskにDockerfileの命令文を記載しておりますが、Nuxt.jsのひな型プロジェクトのコピーはansilbeのcopy/synchronizeで実行しますと、ファイルの量が多すぎるため処理が完了できませんでした。<br>\n代替案としてひな型プロジェクトのファイル群をarchiveモジュールで圧縮して、コンテナ内で展開するように変更しております。このPlaybookをansible-benderコマンドで実行します。<br>\n<code>ansible-bender build build_nuxtimage.yml</code></p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ ansible-bender build build_nuxtimage.yml   \nansible-playbook 2.9.13  \n  config file = /tmp/ab_x4m8plk/ansible.cfg  \n  configured module search path = [\'/home/ec2-user/.ansible/plugins/modules\', \'/usr/share/ansible/plugins/modules\']  \n  ansible python module location = /usr/lib/python3.6/site-packages/ansible  \n  executable location = /usr/bin/ansible-playbook  \n  python version = 3.6.8 (default, Dec  5 2019, 15:45:45) [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)]  \nUsing /tmp/ab_x4m8plk/ansible.cfg as config file  \nhost_list declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nscript declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nauto declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nParsed /tmp/ab_x4m8plk/inventory inventory source with ini plugin  \n\nPLAYBOOK: .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml *********************************************************************************************  \n1 plays in .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml  \n\nPLAY [Build Nuxt.js image] ***********************************************************************************************************************************  \nMETA: ran handlers  \n\nTASK [Copy Prototype parts] **********************************************************************************************************************************  \ntask path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:5  \n&lt;yuta28-bender-test-20200913-071934769597-cont&gt; RUN [b\'buildah\', b\'mount\', b\'--\', b\'yuta28-bender-test-20200913-071934769597-cont\']  \n&lt;yuta28-bender-test-20200913-071934769597-cont&gt; RUN [b\'buildah\', b\'run\', b\'--\', b\'yuta28-bender-test-20200913-071934769597-cont\', b\'/bin/sh\', b\'-c\', b\'( umask 77 &amp;&amp; mkdir -p "` echo /tmp `"&amp;&amp; mkdir "` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `" &amp;&amp; echo ansible-tmp-1599981579.9843893-85539-240769061862493="` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `" ) &amp;&amp; sleep 0\']  \nUsing module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py  \n&lt;yuta28-bender-test-20200913-071934769597-cont&gt; PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmptlan88hf TO /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py  \n&lt;yuta28-bender-test-20200913-071934769597-cont&gt; RUN [b\'buildah\', b\'run\', b\'--\', b\'yuta28-bender-test-20200913-071934769597-cont\', b\'/bin/sh\', b\'-c\', b\'chmod u+x /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py &amp;&amp; sleep 0\']  \n&lt;yuta28-bender-test-20200913-071934769597-cont&gt; RUN [b\'buildah\', b\'run\', b\'--\', b\'yuta28-bender-test-20200913-071934769597-cont\', b\'/bin/sh\', b\'-c\', b\'/usr/bin/python3 /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py &amp;&amp; sleep 0\'] \n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~省略~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nMETA: ran handlers  \nMETA: ran handlers  \n\nPLAY RECAP ***************************************************************************************************************************************************  \nyuta28-bender-test-20200913-071934769597-cont : ok=4    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0     \n\nGetting image source signatures  \nCopying blob sha256:b323b70996e4f6d603c331669ac44cf6234a2e22002d3686e9c88398c6911c25  \nCopying blob sha256:e8847c2734e1bec913fbb00dbd638e9bff6c42f699bbeb897728e234cf1a6e72  \nCopying blob sha256:a4c504f73441d711e6e71e5c177a772efe4d500c2d97b2a1358ea65edc98e8d5  \nCopying blob sha256:ef5de533cb53783465669a60fc9b0b1c782d319c5c8991fe9868f3be8be8e58b  \nCopying blob sha256:cbe6bbd0c86ff46f87950e109e891445a085c9bbf5af737b0ae3871d782e5335  \nCopying blob sha256:174e334f3f463272eeba0021b8b2c54a8891abc0c74201bbd98e87e8c00524e2  \nCopying blob sha256:e404bec46f40991019fbf239256326c48afb7672768755740a6ba862d431e5c6  \nCopying blob sha256:58b4b808347b3cdc40003e905f03059f37ae8cf169e91ecf25250e475e27728f  \nCopying blob sha256:24a8e30559a7f9f31238761563cc4ab907863039cbc3778449ca8c55f50ecc4a  \nCopying blob sha256:9b6e6b48454d80e68f9709e8b82abfe7bd0d059464b9c1796d462601ea59182f  \nCopying blob sha256:9f9869f02922117d69ea1b18239a9d55ac8e6d4ca578fc7ef226d20c3e7424f2  \nCopying config sha256:ddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186  \nWriting manifest to image destination  \nStoring signatures  \nddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186  \nImage \'yuta28/bender-test\' was built successfully \\o/\n\n$ podman images  \nREPOSITORY                     TAG      IMAGE ID       CREATED          SIZE  \nlocalhost/yuta28/bender-test   latest   ddcc7b1e45f6   32 minutes ago   1.41 GB  \nlocalhost/node-python3         latest   79003b61771b   3 hours ago      990 MB\n</pre></div></div>\n\n<p>コンテナイメージ<code>localhost/yuta28/bender-test</code>が作成されましたので、コンテナを起動します。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ podman run --rm -it -p 8080:3000 localhost/yuta28/bender-test:latest  \nyarn run v1.22.5  \n$ nuxt  \n\n WARN  mode option is deprecated. You can safely remove it from nuxt.config                                                                                                          07:59:19  \n\n\n   ╭────────────────────────────────────────╮  \n   │                                        │  \n   │   Nuxt.js @ v2.14.5                    │  \n   │                                        │  \n   │   ▸ Environment: development           │  \n   │   ▸ Rendering:   server-side           │  \n   │   ▸ Target:      server                │  \n   │                                        │  \n   │   Listening: http://10.0.2.100:3000/   │  \n   │                                        │  \n   ╰────────────────────────────────────────╯  \n\nℹ Preparing project for development                                                                                                                                                  07:59:21  \nℹ Initial build may take a while                                                                                                                                                     07:59:21  \n✔ Builder initialized                                                                                                                                                                07:59:21  \n✔ Nuxt files generated                                                                                                                                                               07:59:21  \n\n✔ Client  \n  Compiled successfully in 8.21s  \n\n✔ Server  \n  Compiled successfully in 6.60s  \n\nℹ Waiting for file changes                                                                                                                                                           07:59:30  \nℹ Memory usage: 212 MB (RSS: 320 MB)                                                                                                                                                 07:59:30  \nℹ Listening on: http://10.0.2.100:3000/\n</pre></div></div>\n\n<p>別ターミナル画面から<code>podman ps</code>コマンドでコンテナ起動を確認します。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ podman ps  \nCONTAINER ID  IMAGE                                COMMAND       CREATED         STATUS             PORTS                   NAMES  \nfe83f066139c  localhost/yuta28/bender-test:latest  yarn run dev  12 minutes ago  Up 12 minutes ago  0.0.0.0:8080-&gt;3000/tcp  strange_moore\n</pre></div></div>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F648568%2F46f6c4c2-6e20-9b58-29ce-0b527af1699a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=307aff1b8ae028b5b8f5111db5c06d52" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F648568%2F46f6c4c2-6e20-9b58-29ce-0b527af1699a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=307aff1b8ae028b5b8f5111db5c06d52" alt="9fb09283f27cc2f4bc21d7e1cf223b8a.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/648568/46f6c4c2-6e20-9b58-29ce-0b527af1699a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F648568%2F46f6c4c2-6e20-9b58-29ce-0b527af1699a.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=619a870acf6fe113bcc64fd5e321c3fe 1x" loading="lazy"></a><br>\nコンテナが起動でき、ブラウザからもNuxt.jsのサンプルページにアクセスすることが確認できました。</p>\n\n<h1>\n<span id="課題" class="fragment"></span><a href="#%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>課題</h1>\n\n<p>DockerfileからPlaybookへ変更してコンテナイメージビルドを行いましたが、Dockerfileでは出来たのにPlaybookではできなかったことがいくつかありました。<br>\n①telemetryによるデータ収集問い合わせの無効化設定を埋め込めない<br>\nDockerfileでは環境変数としてこのような設定を行っていました。<br>\n<code>NUXT_TELEMETRY_DISABLED=1</code><br>\nこちらですが、Nuxtの統計情報の収集問い合わせを無視する設定です。デフォルトでは有効化されており、最初にコンテナを起動すると以下のメッセージが出てきます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>yarn run v1.22.5  \n$ nuxt  \n\nℹ NuxtJS collects completely anonymous data about usage.                                                                                                      11:21:11  \n  This will help us improving Nuxt developer experience over the time.  \n  Read more on https://git.io/nuxt-telemetry  \n\n? Are you interested in participation? Yes ← Yes/Noで選択\n</pre></div></div>\n\n<p>起動のたびに聞かれるのが煩わしいので設定で無効化しようと、変数をPlaybookに組み込みましたが、以下のエラーが出て失敗しました。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ ansible-bender build simple-test/build_nuxtimage.yml   \nThere was an error during execution: variable /target_image/environment/NUXT_TELEMETRY_DISABLED is set to 1, which is not of type string  \n</pre></div></div>\n\n<p>詳細な原因が分からないですが、環境変数がString型でないからエラーになっているかと思われます。<code>NUXT_TELEMETRY_DISABLED</code>はBoolean型ですが、Boolean型の環境変数をPlaybookに加える方法がわかりませんでした。<br>\nこちらの対処法ですが、Nuxt.jsの公式リファレンスで紹介されていた方法で<code>app/nuxt.config.js</code>に設定を追記しました。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>  \n<span class="o">~~~~~</span><span class="err">末尾追加</span><span class="o">~~~~~</span>  \n  <span class="na">telemetry</span><span class="p">:</span> <span class="kc">false</span>  \n<span class="p">}</span>\n</pre></div>\n</div>\n\n<p>②noneイメージが溜まり続ける<br>\nPlaybook実行直後にイメージリストを調べると以下のように中間層であるnoneイメージがたくさん溜まってきます。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>$ podman images  \nREPOSITORY                     TAG        IMAGE ID       CREATED       SIZE  \nlocalhost/yuta28/bender-test   latest     3b568629853d   2 hours ago   1.41 GB  \n&lt;none&gt;                         &lt;none&gt;     30f38e724bd8   2 hours ago   1.41 GB  \n&lt;none&gt;                         &lt;none&gt;     2c3401135802   2 hours ago   1.41 GB  \n&lt;none&gt;                         &lt;none&gt;     ab36ebfbcb82   2 hours ago   1.41 GB  \n&lt;none&gt;                         &lt;none&gt;     0c15be92f176   2 hours ago   992 MB  \n&lt;none&gt;                         &lt;none&gt;     0f4f0464e1e9   2 hours ago   992 MB  \n&lt;none&gt;                         &lt;none&gt;     f19ac9e8da69   2 hours ago   991 MB  \nlocalhost/node-python3         latest     73bb42b858aa   5 days ago    991 MB  \nlocalhost/debian-python3       buster     af956b4f0450   8 days ago    177 MB\n</pre></div></div>\n\n<p>サイズも1GBと大きく溜まり続けるとローカルマシンに負担がかかるので作成後に手動で<code>podman image prune</code>で削除していますが、Dockerfileのビルド時には出てこなかった事象でPlaybook内でどのような設定を加えたらいいのかわかりませんでした。</p>\n\n<h1>\n<span id="所感" class="fragment"></span><a href="#%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>所感</h1>\n\n<p>上の課題にも挙げられているようにDockerfileからビルドする時と比較しますといくつか問題点が生じ、コンテナイメージのビルドもAnsibleのDockerモジュールから実行した方が体感的には早く感じました。Dockerfileを書く必要がなく、Playbook内だけでコンテナイメージビルドを完結すことができるのはメリットだと思いましたが、やっぱりDockerfileを書いてそこからビルド指定したほうが良い気がしてきました。<br>\nそもそもAnsibleでコンテナ管理を行うメリットがあまり思い浮かばず、docker-composeやKubernetesでコンテナ管理を行った方がトレンドにも乗っており、実務で使うには少し心もとない感じがしました。<br>\nansible-benderでコンテナ管理を行うメリットについてわかる方がいましたらコメント欄にてご指摘お願いいたします。</p>\n',body:"# 背景\n以前AnsibleのDockerモジュールを活用してDockerコンテナのイメージビルドからコンテナ作成までをAnsible上で行いました。[Ansibleを使ってNuxt.jsのDockerコンテナを構築してみた](https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323)\nその時はAnsible-Containerというコンテナ管理に便利なツールがあることを紹介しましたが、2020年現在は開発終了されています。ただし、その後ansible-benderというAnsible Containerの機能を一部引き継いだツールが新しく登場しました。\n今回はansible-benderを使ってコンテナイメージをビルドしていきたいと思います。\n# ansible-benderについて\nansible-benderはAnsible Playbookを使ってコンテナイメージをビルドすることができるツールです。(https://github.com/ansible-community/ansible-bender)\nDockerモジュールでは、Dockerfileの宛先パスをPlaybookで指定してコンテナイメージのビルドを行いましたが、ansible-benderでは直接Playbook内にコンテナイメージを記述することでコンテナイメージのビルドが可能となります。pipパッケージからインストールすることが可能です。\n`pip install ansible-bender`\n# 必須要件\nansible-benderを動かすには予めPodmanとBuildahをインストールする必要があります。\nこちらのツールは[前回の記事](https://qiita.com/Yuhta/private/c2597bef7a5eb3bb6c53)で紹介していますので、初めてツールの存在を知った方はそちらの記事もご参照ください。\nまたコンテナイメージをビルドする際、Pythonのインストールされたコンテナベースイメージが必要です。(Python2系3系問わない)\n事前にPythonを含む最小コンテナイメージを用意しておくと後々便利です。参考記事[ansible-bender でコンテナイメージを作成する](https://qiita.com/tsuchm/items/90a49b827130f80f5e46)\n\n```Dockerfile\nFROM debian:buster\nRUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y python3 && apt-get clean\n```\n\n# コンテナイメージのビルド\nansible-benderの準備ができましたら、コンテナイメージのビルドを行っていきます。\nここでは、前回の[記事](https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323)で構築したNuxt.jsのコンテナイメージをansible-benderでビルドできるか検証していきます。\n###### ベースコンテナイメージの取得\n\n```dockerfile:Dockerfile\nFROM node:latest  \nWORKDIR /app  \nRUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y python3 && apt-get clean\n```\n\nDebianコンテナをベースイメージにするよりもnodeイメージをベースにした方が後々のコンテナイメージビルドが楽になりますので、nodeイメージにPythonをインストールしてベースイメージを取得しました。続いてディレクトリ構成について紹介します。\n\n```\n├── Prototype  \n│   └── app/(Nuxt.jsのひな型)    \n└── build_nuxtimage.yml\n```\n\n前回[記事](https://qiita.com/Yuhta/items/e9c8aa4e95b6d39e6323)を踏襲していますが、変更点としてはDockerfileがなくなっております。コンテナイメージの作成を`build_nuxtimage.yml`で作成するので、不要となります。\n比較用に前回のDockerfileの中身も載せて置きます。\n\n```dockerfile:Dockerfile\nFROM node:latest\nENV NUXT_HOST=0.0.0.0\nENV NUXT_TELEMETRY_DISABLED=1\nWORKDIR /app\n\nCOPY ./app/package.json ./app/yarn.lock ./\nRUN yarn install\n\nCOPY ./app .\n\nCMD [\"yarn\", \"run\", \"dev\"]\n```\n\nこれをansible-benderのPlaybookに直しますと次のようになります。\n\n```yaml:build_nuxtimage.yml\n---  \n- name: Build Nuxt.js image  \n  hosts: all  \n  gather_facts: false  \n  vars:  \n    ansible_python_interpreter: /usr/bin/python3  \n    ansible_bender:  \n      base_image: \"localhost/node-python3\"  \n      ansible_extra_args: \"-vvv\"  \n\n      target_image:  \n        name: yuta28/bender-test  \n        working_dir: /app  \n        environment:  \n          NUXT_HOST: 0.0.0.0  \n        labels:  \n          built-by: '{{ ansible_user }}'  \n        cmd: \"yarn run dev\"  \n\n  tasks:  \n  - name: Copy Prototype parts  \n    copy:  \n      src: \"{{ item }}\"  \n      dest: /app/  \n    with_items:  \n      - \"{{ playbook_dir }}/Prototype/app/package.json\"  \n      - \"{{ playbook_dir }}/Prototype/app/yarn.lock\"  \n\n  - name: Yarn install  \n    command: \"yarn install\"  \n\n  - name: Archive app directory  \n    delegate_to: localhost  \n    archive:  \n      path: \"{{ playbook_dir }}/Prototype/app\"  \n      dest: \"{{ playbook_dir }}/Prototype/app.tar.gz\"  \n      format: gz  \n\n  - name: Unpacks app.tar.gz  \n    unarchive:  \n      src: \"{{ playbook_dir }}/Prototype/app.tar.gz\"  \n      dest: /\n```\n\nDockerfile内のRUN命令箇所は、commandモジュール、CMD命令はtarget_image内のcmd変数に変換してPlaybookでコンテナのイメージビルドのPlaybookを作成しました。\n基本的にはTaskにDockerfileの命令文を記載しておりますが、Nuxt.jsのひな型プロジェクトのコピーはansilbeのcopy/synchronizeで実行しますと、ファイルの量が多すぎるため処理が完了できませんでした。\n代替案としてひな型プロジェクトのファイル群をarchiveモジュールで圧縮して、コンテナ内で展開するように変更しております。このPlaybookをansible-benderコマンドで実行します。\n`ansible-bender build build_nuxtimage.yml`\n\n```\n$ ansible-bender build build_nuxtimage.yml   \nansible-playbook 2.9.13  \n  config file = /tmp/ab_x4m8plk/ansible.cfg  \n  configured module search path = ['/home/ec2-user/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']  \n  ansible python module location = /usr/lib/python3.6/site-packages/ansible  \n  executable location = /usr/bin/ansible-playbook  \n  python version = 3.6.8 (default, Dec  5 2019, 15:45:45) [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)]  \nUsing /tmp/ab_x4m8plk/ansible.cfg as config file  \nhost_list declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nscript declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nauto declined parsing /tmp/ab_x4m8plk/inventory as it did not pass its verify_file() method  \nParsed /tmp/ab_x4m8plk/inventory inventory source with ini plugin  \n\nPLAYBOOK: .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml *********************************************************************************************  \n1 plays in .build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml  \n\nPLAY [Build Nuxt.js image] ***********************************************************************************************************************************  \nMETA: ran handlers  \n\nTASK [Copy Prototype parts] **********************************************************************************************************************************  \ntask path: /home/ec2-user/ansible-bender/simple-test/.build_nuxtimage-20200913-071938404664-rjqqvxkjpc.yaml:5  \n<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'mount', b'--', b'yuta28-bender-test-20200913-071934769597-cont']  \n<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'( umask 77 && mkdir -p \"` echo /tmp `\"&& mkdir \"` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `\" && echo ansible-tmp-1599981579.9843893-85539-240769061862493=\"` echo /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493 `\" ) && sleep 0']  \nUsing module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py  \n<yuta28-bender-test-20200913-071934769597-cont> PUT /home/ec2-user/.ansible/tmp/ansible-local-85531c92iy6sw/tmptlan88hf TO /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py  \n<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'chmod u+x /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/ /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py && sleep 0']  \n<yuta28-bender-test-20200913-071934769597-cont> RUN [b'buildah', b'run', b'--', b'yuta28-bender-test-20200913-071934769597-cont', b'/bin/sh', b'-c', b'/usr/bin/python3 /tmp/ansible-tmp-1599981579.9843893-85539-240769061862493/AnsiballZ_stat.py && sleep 0'] \n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~省略~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  \nMETA: ran handlers  \nMETA: ran handlers  \n\nPLAY RECAP ***************************************************************************************************************************************************  \nyuta28-bender-test-20200913-071934769597-cont : ok=4    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0     \n\nGetting image source signatures  \nCopying blob sha256:b323b70996e4f6d603c331669ac44cf6234a2e22002d3686e9c88398c6911c25  \nCopying blob sha256:e8847c2734e1bec913fbb00dbd638e9bff6c42f699bbeb897728e234cf1a6e72  \nCopying blob sha256:a4c504f73441d711e6e71e5c177a772efe4d500c2d97b2a1358ea65edc98e8d5  \nCopying blob sha256:ef5de533cb53783465669a60fc9b0b1c782d319c5c8991fe9868f3be8be8e58b  \nCopying blob sha256:cbe6bbd0c86ff46f87950e109e891445a085c9bbf5af737b0ae3871d782e5335  \nCopying blob sha256:174e334f3f463272eeba0021b8b2c54a8891abc0c74201bbd98e87e8c00524e2  \nCopying blob sha256:e404bec46f40991019fbf239256326c48afb7672768755740a6ba862d431e5c6  \nCopying blob sha256:58b4b808347b3cdc40003e905f03059f37ae8cf169e91ecf25250e475e27728f  \nCopying blob sha256:24a8e30559a7f9f31238761563cc4ab907863039cbc3778449ca8c55f50ecc4a  \nCopying blob sha256:9b6e6b48454d80e68f9709e8b82abfe7bd0d059464b9c1796d462601ea59182f  \nCopying blob sha256:9f9869f02922117d69ea1b18239a9d55ac8e6d4ca578fc7ef226d20c3e7424f2  \nCopying config sha256:ddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186  \nWriting manifest to image destination  \nStoring signatures  \nddcc7b1e45f6483f9df7f0d19a17969aa27f92f2e6f77962d3c87c29f32c8186  \nImage 'yuta28/bender-test' was built successfully \\o/\n\n$ podman images  \nREPOSITORY                     TAG      IMAGE ID       CREATED          SIZE  \nlocalhost/yuta28/bender-test   latest   ddcc7b1e45f6   32 minutes ago   1.41 GB  \nlocalhost/node-python3         latest   79003b61771b   3 hours ago      990 MB\n```\n\nコンテナイメージ`localhost/yuta28/bender-test`が作成されましたので、コンテナを起動します。\n\n```\n$ podman run --rm -it -p 8080:3000 localhost/yuta28/bender-test:latest  \nyarn run v1.22.5  \n$ nuxt  \n\n WARN  mode option is deprecated. You can safely remove it from nuxt.config                                                                                                          07:59:19  \n\n\n   ╭────────────────────────────────────────╮  \n   │                                        │  \n   │   Nuxt.js @ v2.14.5                    │  \n   │                                        │  \n   │   ▸ Environment: development           │  \n   │   ▸ Rendering:   server-side           │  \n   │   ▸ Target:      server                │  \n   │                                        │  \n   │   Listening: http://10.0.2.100:3000/   │  \n   │                                        │  \n   ╰────────────────────────────────────────╯  \n\nℹ Preparing project for development                                                                                                                                                  07:59:21  \nℹ Initial build may take a while                                                                                                                                                     07:59:21  \n✔ Builder initialized                                                                                                                                                                07:59:21  \n✔ Nuxt files generated                                                                                                                                                               07:59:21  \n\n✔ Client  \n  Compiled successfully in 8.21s  \n\n✔ Server  \n  Compiled successfully in 6.60s  \n\nℹ Waiting for file changes                                                                                                                                                           07:59:30  \nℹ Memory usage: 212 MB (RSS: 320 MB)                                                                                                                                                 07:59:30  \nℹ Listening on: http://10.0.2.100:3000/\n```\n\n別ターミナル画面から`podman ps`コマンドでコンテナ起動を確認します。\n\n```\n$ podman ps  \nCONTAINER ID  IMAGE                                COMMAND       CREATED         STATUS             PORTS                   NAMES  \nfe83f066139c  localhost/yuta28/bender-test:latest  yarn run dev  12 minutes ago  Up 12 minutes ago  0.0.0.0:8080->3000/tcp  strange_moore\n```\n![9fb09283f27cc2f4bc21d7e1cf223b8a.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/648568/46f6c4c2-6e20-9b58-29ce-0b527af1699a.png)\nコンテナが起動でき、ブラウザからもNuxt.jsのサンプルページにアクセスすることが確認できました。\n# 課題\nDockerfileからPlaybookへ変更してコンテナイメージビルドを行いましたが、Dockerfileでは出来たのにPlaybookではできなかったことがいくつかありました。\n①telemetryによるデータ収集問い合わせの無効化設定を埋め込めない\nDockerfileでは環境変数としてこのような設定を行っていました。\n`NUXT_TELEMETRY_DISABLED=1`\nこちらですが、Nuxtの統計情報の収集問い合わせを無視する設定です。デフォルトでは有効化されており、最初にコンテナを起動すると以下のメッセージが出てきます。\n\n```\nyarn run v1.22.5  \n$ nuxt  \n\nℹ NuxtJS collects completely anonymous data about usage.                                                                                                      11:21:11  \n  This will help us improving Nuxt developer experience over the time.  \n  Read more on https://git.io/nuxt-telemetry  \n\n? Are you interested in participation? Yes ← Yes/Noで選択\n```\n\n起動のたびに聞かれるのが煩わしいので設定で無効化しようと、変数をPlaybookに組み込みましたが、以下のエラーが出て失敗しました。\n\n```\n$ ansible-bender build simple-test/build_nuxtimage.yml   \nThere was an error during execution: variable /target_image/environment/NUXT_TELEMETRY_DISABLED is set to 1, which is not of type string  \n```\n\n詳細な原因が分からないですが、環境変数がString型でないからエラーになっているかと思われます。`NUXT_TELEMETRY_DISABLED`はBoolean型ですが、Boolean型の環境変数をPlaybookに加える方法がわかりませんでした。\nこちらの対処法ですが、Nuxt.jsの公式リファレンスで紹介されていた方法で`app/nuxt.config.js`に設定を追記しました。\n\n```javascript:nuxt.config.js\nexport default {  \n~~~~~末尾追加~~~~~  \n  telemetry: false  \n}\n```\n②noneイメージが溜まり続ける\nPlaybook実行直後にイメージリストを調べると以下のように中間層であるnoneイメージがたくさん溜まってきます。\n\n```\n$ podman images  \nREPOSITORY                     TAG        IMAGE ID       CREATED       SIZE  \nlocalhost/yuta28/bender-test   latest     3b568629853d   2 hours ago   1.41 GB  \n<none>                         <none>     30f38e724bd8   2 hours ago   1.41 GB  \n<none>                         <none>     2c3401135802   2 hours ago   1.41 GB  \n<none>                         <none>     ab36ebfbcb82   2 hours ago   1.41 GB  \n<none>                         <none>     0c15be92f176   2 hours ago   992 MB  \n<none>                         <none>     0f4f0464e1e9   2 hours ago   992 MB  \n<none>                         <none>     f19ac9e8da69   2 hours ago   991 MB  \nlocalhost/node-python3         latest     73bb42b858aa   5 days ago    991 MB  \nlocalhost/debian-python3       buster     af956b4f0450   8 days ago    177 MB\n```\n\nサイズも1GBと大きく溜まり続けるとローカルマシンに負担がかかるので作成後に手動で`podman image prune`で削除していますが、Dockerfileのビルド時には出てこなかった事象でPlaybook内でどのような設定を加えたらいいのかわかりませんでした。\n# 所感\n上の課題にも挙げられているようにDockerfileからビルドする時と比較しますといくつか問題点が生じ、コンテナイメージのビルドもAnsibleのDockerモジュールから実行した方が体感的には早く感じました。Dockerfileを書く必要がなく、Playbook内だけでコンテナイメージビルドを完結すことができるのはメリットだと思いましたが、やっぱりDockerfileを書いてそこからビルド指定したほうが良い気がしてきました。\nそもそもAnsibleでコンテナ管理を行うメリットがあまり思い浮かばず、docker-composeやKubernetesでコンテナ管理を行った方がトレンドにも乗っており、実務で使うには少し心もとない感じがしました。\nansible-benderでコンテナ管理を行うメリットについてわかる方がいましたらコメント欄にてご指摘お願いいたします。\n",coediting:a,comments_count:0,created_at:"2020-09-28T11:00:19+09:00",group:s,id:"de8b5325e5f6f497ed0a",likes_count:5,private:a,reactions_count:0,tags:[{name:"Ansible",versions:[]},{name:p,versions:[]},{name:"Podman",versions:[]},{name:"ansible-bender",versions:[]},{name:"Buildah",versions:[]}],title:"ansible-benderを使ってNuxt.jsのコンテナイメージをビルドしてみた",updated_at:"2020-10-01T20:12:08+09:00",url:"https://qiita.com/Yuhta/items/de8b5325e5f6f497ed0a",user:{description:"ヘルステック系の会社でインフラのお仕事をしております。",facebook_id:n,followees_count:4,followers_count:4,github_login_name:s,id:"Yuhta",items_count:5,linkedin_id:n,location:"東京都",name:"Yuhta",organization:"エンブレース株式会社",permanent_id:648568,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/648568/b6b2f9175e66badb62b93356edeb95dde855b58e/x_large.png?1594606672",team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>←<a href="https://qiita.com/rf_p/items/c1162fc121d6a4ef53e6" id="reference-2c07e90d0a8e1eb2205c">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成</a></p>\n\n<h1>\n<span id="ログアウト機能の実装" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E8%83%BD%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ログアウト機能の実装</h1>\n\n<p>先にログアウトを作ります。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">layouts/default.vue</span></div>\n<div class="highlight"><pre><span class="err">...</span>\n       &lt;v-btn\n         v-if="logged_in"\n         icon\n<span class="gi">+        @click="logOut"\n</span>       &gt;\n         &lt;v-icon&gt;mdi-logout&lt;/v-icon&gt;\n       &lt;/v-btn&gt;\n<span class="err">...</span>\nexport default {\n<span class="err">...</span>\n           this.$store.commit(\'setAuth\', {})\n         })\n     }\n<span class="gi">+  },\n+  methods: {\n+    logOut () {\n+      this.$store.dispatch(\'logOut\')\n+    }\n</span>   }\n }\n &lt;/script&gt;\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">store/index.js</span></div>\n<div class="highlight"><pre><span class="err">...</span>\n export const actions = {\n   async signUp (_c, user) {\n     return await this.$axios.$post(\'/v1/auth\', user)\n<span class="gi">+  },\n+  async logOut ({ commit }) {\n+    await this.$axios.$delete(\'/v1/auth/sign_out\')\n+    commit(\'setUser\', null)\n+    commit(\'setAuth\', {})\n+\n+    this.$router.push(\'/\')\n</span>   }\n }\n</pre></div>\n</div>\n\n<p><code>v1/auth/sign_out</code>することでバックエンドでログアウトとします。<br>\nそしてフロントエンド側もstoreから削除し（同時にlocalStorageもクリアされます）、トップページに飛ばします。</p>\n\n<h1>\n<span id="ログイン機能の実装" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E6%A9%9F%E8%83%BD%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ログイン機能の実装</h1>\n\n<div class="code-frame" data-lang="powershell"><div class="highlight"><pre><span class="err">$</span><span class="w"> </span><span class="nf">touch</span><span class="w"> </span><span class="nx">pages/log_in.vue</span><span class="w">\n</span></pre></div></div>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/log_in.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-app</span> <span class="na">id=</span><span class="s">"inspire"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;v-main&gt;</span>\n      <span class="nt">&lt;v-container</span>\n        <span class="na">class=</span><span class="s">"fill-height"</span>\n        <span class="na">fluid</span>\n      <span class="nt">&gt;</span>\n        <span class="nt">&lt;v-row</span>\n          <span class="na">align=</span><span class="s">"center"</span>\n          <span class="na">justify=</span><span class="s">"center"</span>\n        <span class="nt">&gt;</span>\n          <span class="nt">&lt;v-col</span>\n            <span class="na">cols=</span><span class="s">"12"</span>\n            <span class="na">sm=</span><span class="s">"8"</span>\n            <span class="na">md=</span><span class="s">"4"</span>\n          <span class="nt">&gt;</span>\n            <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit.prevent=</span><span class="s">"logIn"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-card</span> <span class="na">class=</span><span class="s">"elevation-12"</span><span class="nt">&gt;</span>\n                <span class="nt">&lt;v-toolbar</span>\n                  <span class="na">color=</span><span class="s">"primary"</span>\n                  <span class="na">dark</span>\n                  <span class="na">flat</span>\n                <span class="nt">&gt;</span>\n                  <span class="nt">&lt;v-toolbar-title&gt;</span>LogIn form<span class="nt">&lt;/v-toolbar-title&gt;</span>\n                <span class="nt">&lt;/v-toolbar&gt;</span>\n                <span class="nt">&lt;v-card-text&gt;</span>\n                  <span class="nt">&lt;ul</span> <span class="na">v-if=</span><span class="s">"errors"</span><span class="nt">&gt;</span>\n                    <span class="nt">&lt;li</span> <span class="na">v-for=</span><span class="s">"(message, i) in errors"</span> <span class="na">:key=</span><span class="s">"i"</span><span class="nt">&gt;</span>\n                      <span class="si">{{</span> <span class="nx">message</span> <span class="si">}}</span>\n                    <span class="nt">&lt;/li&gt;</span>\n                  <span class="nt">&lt;/ul&gt;</span>\n                  <span class="nt">&lt;v-text-field</span>\n                    <span class="na">id=</span><span class="s">"email"</span>\n                    <span class="na">v-model=</span><span class="s">"email"</span>\n                    <span class="na">label=</span><span class="s">"email"</span>\n                    <span class="na">name=</span><span class="s">"email"</span>\n                    <span class="na">prepend-icon=</span><span class="s">"mdi-email"</span>\n                    <span class="na">type=</span><span class="s">"email"</span>\n                  <span class="nt">/&gt;</span>\n\n                  <span class="nt">&lt;v-text-field</span>\n                    <span class="na">id=</span><span class="s">"password"</span>\n                    <span class="na">v-model=</span><span class="s">"password"</span>\n                    <span class="na">label=</span><span class="s">"Password"</span>\n                    <span class="na">name=</span><span class="s">"password"</span>\n                    <span class="na">prepend-icon=</span><span class="s">"mdi-lock"</span>\n                    <span class="na">type=</span><span class="s">"password"</span>\n                  <span class="nt">/&gt;</span>\n                <span class="nt">&lt;/v-card-text&gt;</span>\n                <span class="nt">&lt;v-card-actions&gt;</span>\n                  <span class="nt">&lt;v-spacer</span> <span class="nt">/&gt;</span>\n                  <span class="nt">&lt;v-btn</span> <span class="na">color=</span><span class="s">"primary"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>\n                    ログイン\n                  <span class="nt">&lt;/v-btn&gt;</span>\n                <span class="nt">&lt;/v-card-actions&gt;</span>\n              <span class="nt">&lt;/v-card&gt;</span>\n            <span class="nt">&lt;/form&gt;</span>\n          <span class="nt">&lt;/v-col&gt;</span>\n        <span class="nt">&lt;/v-row&gt;</span>\n      <span class="nt">&lt;/v-container&gt;</span>\n    <span class="nt">&lt;/v-main&gt;</span>\n  <span class="nt">&lt;/v-app&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">email</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">password</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">errors</span><span class="p">:</span> <span class="p">[]</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="k">async</span> <span class="nx">logIn</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="k">try</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">logIn</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span>\n          <span class="na">email</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>\n          <span class="na">password</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span>\n        <span class="p">})</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">errors</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">errors</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">store/index.js</span></div>\n<div class="highlight"><pre><span class="err">...</span>\nexport const actions = {\n<span class="err">...</span>\n  async logOut ({ commit }) {\n    await this.$axios.$delete(\'/v1/auth/sign_out\')\n    commit(\'setUser\', null)\n    commit(\'setAuth\', {})\n\n    this.$router.push(\'/\')\n<span class="gi">+ },\n+ async logIn (_c, user) {\n+   return await this.$axios.$post(\'/v1/auth/sign_in\', user)\n</span>  }\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">layouts/default.vue</span></div>\n<div class="highlight"><pre><span class="err">...</span>\n         &lt;v-icon&gt;mdi-account-plus&lt;/v-icon&gt;\n       &lt;/v-btn&gt;\n<span class="gi">+      &lt;v-btn\n+        v-if="!logged_in"\n+        icon\n+        to="/log_in"\n+        nuxt\n+      &gt;\n+        &lt;v-icon&gt;mdi-login&lt;/v-icon&gt;\n+      &lt;/v-btn&gt;\n</span>     &lt;/v-app-bar&gt;\n<span class="err">...</span>\n</pre></div>\n</div>\n\n<p>ほとんどsignUpのコピペでいけます。</p>\n\n<p>未ログインだと以下のようになります。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F4245c04e-c1e4-cf34-53dc-37e479bf888b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=310d782515a3e58fa016e04ab0b43608" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F4245c04e-c1e4-cf34-53dc-37e479bf888b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=310d782515a3e58fa016e04ab0b43608" alt="未ログイン中" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/4245c04e-c1e4-cf34-53dc-37e479bf888b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F4245c04e-c1e4-cf34-53dc-37e479bf888b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ad95ea09cc9ad24f07870d394bc2cb8e 1x" loading="lazy"></a></p>\n\n<p>そしてログイン中だと以下のようになります。<br>\n<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F47af4e9a-805b-781a-7094-a77687271d8d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0faac4dee799545aa89da740d1af4c29" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F47af4e9a-805b-781a-7094-a77687271d8d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0faac4dee799545aa89da740d1af4c29" alt="ログイン中.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/47af4e9a-805b-781a-7094-a77687271d8d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F47af4e9a-805b-781a-7094-a77687271d8d.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a128c419be5b4d1dcbc085f20f41ae44 1x" loading="lazy"></a></p>\n\n<p>これでログイン周りの必要最低限の機能は揃いましたね。</p>\n\n<p>次回は連載最終回。記事の投稿・削除を行います。</p>\n\n<h1>\n<span id="続き" class="fragment"></span><a href="#%E7%B6%9A%E3%81%8D"><i class="fa fa-link"></i></a>続き</h1>\n\n<p>→<a href="https://qiita.com/rf_p/items/496a5eb49289a90633e2" id="reference-1eae9b8f5da3d97bb474">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #6 記事投稿フォームの作成</a><br>\n【<a href="https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1" id="reference-a951e6ca09f26b7bdaf6">連載目次へ</a>】</p>\n',body:'←[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成](https://qiita.com/rf_p/items/c1162fc121d6a4ef53e6)\n\n# ログアウト機能の実装\n\n先にログアウトを作ります。\n\n```diff:layouts/default.vue\n...\n       <v-btn\n         v-if="logged_in"\n         icon\n+        @click="logOut"\n       >\n         <v-icon>mdi-logout</v-icon>\n       </v-btn>\n...\nexport default {\n...\n           this.$store.commit(\'setAuth\', {})\n         })\n     }\n+  },\n+  methods: {\n+    logOut () {\n+      this.$store.dispatch(\'logOut\')\n+    }\n   }\n }\n <\/script>\n```\n\n```diff:store/index.js\n...\n export const actions = {\n   async signUp (_c, user) {\n     return await this.$axios.$post(\'/v1/auth\', user)\n+  },\n+  async logOut ({ commit }) {\n+    await this.$axios.$delete(\'/v1/auth/sign_out\')\n+    commit(\'setUser\', null)\n+    commit(\'setAuth\', {})\n+\n+    this.$router.push(\'/\')\n   }\n }\n```\n\n`v1/auth/sign_out`することでバックエンドでログアウトとします。\nそしてフロントエンド側もstoreから削除し（同時にlocalStorageもクリアされます）、トップページに飛ばします。\n\n# ログイン機能の実装\n\n```powershell\n$ touch pages/log_in.vue\n```\n\n```vue:pages/log_in.vue\n<template>\n  <v-app id="inspire">\n    <v-main>\n      <v-container\n        class="fill-height"\n        fluid\n      >\n        <v-row\n          align="center"\n          justify="center"\n        >\n          <v-col\n            cols="12"\n            sm="8"\n            md="4"\n          >\n            <form @submit.prevent="logIn">\n              <v-card class="elevation-12">\n                <v-toolbar\n                  color="primary"\n                  dark\n                  flat\n                >\n                  <v-toolbar-title>LogIn form</v-toolbar-title>\n                </v-toolbar>\n                <v-card-text>\n                  <ul v-if="errors">\n                    <li v-for="(message, i) in errors" :key="i">\n                      {{ message }}\n                    </li>\n                  </ul>\n                  <v-text-field\n                    id="email"\n                    v-model="email"\n                    label="email"\n                    name="email"\n                    prepend-icon="mdi-email"\n                    type="email"\n                  />\n\n                  <v-text-field\n                    id="password"\n                    v-model="password"\n                    label="Password"\n                    name="password"\n                    prepend-icon="mdi-lock"\n                    type="password"\n                  />\n                </v-card-text>\n                <v-card-actions>\n                  <v-spacer />\n                  <v-btn color="primary" type="submit">\n                    ログイン\n                  </v-btn>\n                </v-card-actions>\n              </v-card>\n            </form>\n          </v-col>\n        </v-row>\n      </v-container>\n    </v-main>\n  </v-app>\n</template>\n\n<script>\nexport default {\n  data () {\n    return {\n      email: \'\',\n      password: \'\',\n      errors: []\n    }\n  },\n  methods: {\n    async logIn () {\n      try {\n        const data = await this.$store.dispatch(\'logIn\', {\n          email: this.email,\n          password: this.password\n        })\n        this.$store.commit(\'setUser\', data.data)\n        this.$router.push(\'/\')\n      } catch (e) {\n        this.errors = e.data.errors\n      }\n    }\n  }\n}\n<\/script>\n\n```\n\n```diff:store/index.js\n...\nexport const actions = {\n...\n  async logOut ({ commit }) {\n    await this.$axios.$delete(\'/v1/auth/sign_out\')\n    commit(\'setUser\', null)\n    commit(\'setAuth\', {})\n\n    this.$router.push(\'/\')\n+ },\n+ async logIn (_c, user) {\n+   return await this.$axios.$post(\'/v1/auth/sign_in\', user)\n  }\n```\n\n```diff:layouts/default.vue\n...\n         <v-icon>mdi-account-plus</v-icon>\n       </v-btn>\n+      <v-btn\n+        v-if="!logged_in"\n+        icon\n+        to="/log_in"\n+        nuxt\n+      >\n+        <v-icon>mdi-login</v-icon>\n+      </v-btn>\n     </v-app-bar>\n...\n```\n\nほとんどsignUpのコピペでいけます。\n\n未ログインだと以下のようになります。\n![未ログイン中](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/4245c04e-c1e4-cf34-53dc-37e479bf888b.png)\n\nそしてログイン中だと以下のようになります。\n![ログイン中.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/47af4e9a-805b-781a-7094-a77687271d8d.png)\n\nこれでログイン周りの必要最低限の機能は揃いましたね。\n\n次回は連載最終回。記事の投稿・削除を行います。\n\n# 続き\n\n→[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #6 記事投稿フォームの作成](https://qiita.com/rf_p/items/496a5eb49289a90633e2)\n【[連載目次へ](https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1)】\n',coediting:a,comments_count:0,created_at:"2020-09-28T08:44:25+09:00",group:s,id:"b714298e1f9effa32cad",likes_count:1,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:e,versions:[]},{name:x,versions:[]},{name:"Vuex",versions:[]},{name:p,versions:[]}],title:"Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装",updated_at:"2020-09-29T21:19:49+09:00",url:"https://qiita.com/rf_p/items/b714298e1f9effa32cad",user:{description:c,facebook_id:n,followees_count:31,followers_count:64,github_login_name:o,id:i,items_count:96,linkedin_id:n,location:r,name:d,organization:m,permanent_id:g,profile_image_url:u,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'\n<h1>\n<span id="やっていたこと" class="fragment"></span><a href="#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やっていたこと</h1>\n\n<p>nuxtからlaravelに向かってリクエストを送ったがエラーが発生。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre>Access to XMLHttpRequest at \'http://0.0.0.0:23450/api/register\' from origin \'http://0.0.0.0\' has been blocked by CORS policy: No \'Access-Control-Allow-Origin\' header is present on the requested resource.\n</pre></div></div>\n\n<p>corsポリシーに反しているから、ブロックしたぞと言われている。<br>\ncorsで調べると「別々のoriginがやりとりできるようにすること」だとか。<br>\noriginとはドメイン+ポート+urlのこと。<br>\n<a href="https://developer.mozilla.org/ja/docs/Web/HTTP/CORS" class="autolink" rel="nofollow noopener" target="_blank">https://developer.mozilla.org/ja/docs/Web/HTTP/CORS</a></p>\n\n<h1>\n<span id="解決方法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>解決方法</h1>\n\n<p>laravel側で受け取れるようにmiddlewareを設定する。<br>\n参考は<a href="https://qiita.com/kobayashi-m42/items/c0a2609ae61a72dcc60f" id="reference-4a0575b6e281ad668342">CORSについて理解してLaravel5.6で対応する</a></p>\n\n<p>自作のmiddlewareを作成して、全てのrouteで発動させる</p>\n\n<div class="code-frame" data-lang="php"><div class="highlight"><pre>\n<span class="cp">&lt;?php</span>\n\n<span class="kn">namespace</span> <span class="nn">App\\Http\\Middleware</span><span class="p">;</span>\n\n<span class="kn">use</span> <span class="nn">Closure</span><span class="p">;</span>\n\n<span class="kd">class</span> <span class="nc">Cors</span>\n<span class="p">{</span>\n    <span class="cd">/**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */</span>\n    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span>\n    <span class="p">{</span>\n        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>\n        <span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">\'Access-Control-Allow-Origin\'</span><span class="p">,</span> <span class="s1">\'http://0.0.0.0\'</span><span class="p">)</span>\n        <span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">\'Access-Control-Allow-Methods\'</span><span class="p">,</span> <span class="s1">\'GET, POST, PUT, DELETE, OPTIONS\'</span><span class="p">)</span>\n        <span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">\'Access-Control-Allow-Headers\'</span><span class="p">,</span> <span class="s1">\'Content-Type\'</span><span class="p">);</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<h1>\n<span id="やってみたけどうまくいかなかったこと" class="fragment"></span><a href="#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%91%E3%81%A9%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やってみたけど、うまくいかなかったこと</h1>\n\n<p>・nuxt側でproxyという機能を使ったcorsの設定<br>\n<a href="https://qiita.com/Ryoma0413/items/c41d10d2e6e2a420c3cf" id="reference-db31d8ac6bfb7b89739f">Vue.jsとAPIサーバとのaxiosでCORSに引っかかった時のProxyを使った回避方法</a></p>\n\n<p><a href="https://blog.proglearn.com/2020/05/26/%E3%80%90nuxt-js%E3%80%91%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%ABcors%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%EF%BC%9F%E3%81%AA%E3%82%89%E3%81%B0-nuxtjs/" rel="nofollow noopener" target="_blank">【Nuxt.js】データベースにCORSで接続できない？ならば @nuxtjs/proxy を使いなさい【手順】</a></p>\n\n<h1>\n<span id="corsの勉強になった参考文献" class="fragment"></span><a href="#cors%E3%81%AE%E5%8B%89%E5%BC%B7%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>corsの勉強になった参考文献</h1>\n\n<p><a href="https://qiita.com/kobayashi-m42/items/c0a2609ae61a72dcc60f">CORSについて理解してLaravel5.6で対応する</a><br>\n<a href="https://qiita.com/tomoyukilabs/items/81698edd5812ff6acb34" id="reference-475cfe518840289c1127">CORSまとめ</a><br>\n<a href="https://blog.cloud-acct.com/posts/u-rails-rackcors/" rel="nofollow noopener" target="_blank">【Rails6】Gem rack-corsを導入してCORS設定を行う(オリジン・CORSとは何か)</a><br>\n<a href="https://qiita.com/mochizukikotaro/items/6b72ad595db8a6b5514f" id="reference-4a08cf617711a7d77f08">CORS を分かってないから動くコード書いて理解する</a><br>\n<a href="https://developer.mozilla.org/ja/docs/Web/HTTP/CORS" rel="nofollow noopener" target="_blank">Preflight request (プリフライトリクエスト)</a></p>\n',body:"#やっていたこと\nnuxtからlaravelに向かってリクエストを送ったがエラーが発生。\n\n```\nAccess to XMLHttpRequest at 'http://0.0.0.0:23450/api/register' from origin 'http://0.0.0.0' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n```\n\ncorsポリシーに反しているから、ブロックしたぞと言われている。\ncorsで調べると「別々のoriginがやりとりできるようにすること」だとか。\noriginとはドメイン+ポート+urlのこと。\nhttps://developer.mozilla.org/ja/docs/Web/HTTP/CORS\n\n#解決方法\nlaravel側で受け取れるようにmiddlewareを設定する。\n参考は[CORSについて理解してLaravel5.6で対応する](https://qiita.com/kobayashi-m42/items/c0a2609ae61a72dcc60f)\n\n\n自作のmiddlewareを作成して、全てのrouteで発動させる\n\n```php\n\n<?php\n\nnamespace App\\Http\\Middleware;\n\nuse Closure;\n\nclass Cors\n{\n    /**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */\n    public function handle($request, Closure $next)\n    {\n        return $next($request)\n        ->header('Access-Control-Allow-Origin', 'http://0.0.0.0')\n        ->header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')\n        ->header('Access-Control-Allow-Headers', 'Content-Type');\n    }\n}\n```\n\n#やってみたけど、うまくいかなかったこと\n・nuxt側でproxyという機能を使ったcorsの設定\n[Vue.jsとAPIサーバとのaxiosでCORSに引っかかった時のProxyを使った回避方法](https://qiita.com/Ryoma0413/items/c41d10d2e6e2a420c3cf)\n\n[【Nuxt.js】データベースにCORSで接続できない？ならば @nuxtjs/proxy を使いなさい【手順】](https://blog.proglearn.com/2020/05/26/%E3%80%90nuxt-js%E3%80%91%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%ABcors%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%EF%BC%9F%E3%81%AA%E3%82%89%E3%81%B0-nuxtjs/)\n\n\n#corsの勉強になった参考文献\n[CORSについて理解してLaravel5.6で対応する](https://qiita.com/kobayashi-m42/items/c0a2609ae61a72dcc60f)\n[CORSまとめ](https://qiita.com/tomoyukilabs/items/81698edd5812ff6acb34)\n[【Rails6】Gem rack-corsを導入してCORS設定を行う(オリジン・CORSとは何か)](https://blog.cloud-acct.com/posts/u-rails-rackcors/)\n[CORS を分かってないから動くコード書いて理解する](https://qiita.com/mochizukikotaro/items/6b72ad595db8a6b5514f)\n[Preflight request (プリフライトリクエスト)](https://developer.mozilla.org/ja/docs/Web/HTTP/CORS)\n",coediting:a,comments_count:0,created_at:"2020-09-27T12:43:52+09:00",group:s,id:"6769f616b478726a5188",likes_count:0,private:a,reactions_count:0,tags:[{name:"Laravel",versions:[]},{name:L,versions:[]},{name:p,versions:[]}],title:"CORSについて",updated_at:"2020-09-27T16:27:39+09:00",url:"https://qiita.com/Tsuyozo/items/6769f616b478726a5188",user:{description:s,facebook_id:s,followees_count:6,followers_count:2,github_login_name:s,id:"Tsuyozo",items_count:21,linkedin_id:s,location:s,name:n,organization:s,permanent_id:510817,profile_image_url:"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/510817/6fd94551219be5897a48767060afe2983d44beb2/large.png?1584235347",team_only:a,twitter_screen_name:s,website_url:s},page_views_count:s},{rendered_body:'<p>←<a href="https://qiita.com/rf_p/items/fc7f0490a62b1f98f487" id="reference-26fcc4015091f2723ddc">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #3 個別記事ページの作成</a></p>\n\n<h1>\n<span id="サインアップ登録ページの作成" class="fragment"></span><a href="#%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97%E7%99%BB%E9%8C%B2%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>サインアップ(登録)ページの作成</h1>\n\n<p>サインアップページ及びそのロジックを作っていきますが、難易度が一気に上がります。<br>\n一気にすべて理解しようとせず、少しずつコードを読み解いていってください。</p>\n\n<p>まずはサインアップページを作ります。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/sign_up.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-app</span> <span class="na">id=</span><span class="s">"inspire"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;v-main&gt;</span>\n      <span class="nt">&lt;v-container</span>\n        <span class="na">class=</span><span class="s">"fill-height"</span>\n        <span class="na">fluid</span>\n      <span class="nt">&gt;</span>\n        <span class="nt">&lt;v-row</span>\n          <span class="na">align=</span><span class="s">"center"</span>\n          <span class="na">justify=</span><span class="s">"center"</span>\n        <span class="nt">&gt;</span>\n          <span class="nt">&lt;v-col</span>\n            <span class="na">cols=</span><span class="s">"12"</span>\n            <span class="na">sm=</span><span class="s">"8"</span>\n            <span class="na">md=</span><span class="s">"4"</span>\n          <span class="nt">&gt;</span>\n            <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit.prevent=</span><span class="s">"signUp"</span><span class="nt">&gt;</span>\n              <span class="nt">&lt;v-card</span> <span class="na">class=</span><span class="s">"elevation-12"</span><span class="nt">&gt;</span>\n                <span class="nt">&lt;v-toolbar</span>\n                  <span class="na">color=</span><span class="s">"primary"</span>\n                  <span class="na">dark</span>\n                  <span class="na">flat</span>\n                <span class="nt">&gt;</span>\n                  <span class="nt">&lt;v-toolbar-title&gt;</span>SignUp form<span class="nt">&lt;/v-toolbar-title&gt;</span>\n                <span class="nt">&lt;/v-toolbar&gt;</span>\n                <span class="nt">&lt;v-card-text&gt;</span>\n                  <span class="nt">&lt;ul</span> <span class="na">v-if=</span><span class="s">"errors"</span><span class="nt">&gt;</span>\n                    <span class="nt">&lt;li</span> <span class="na">v-for=</span><span class="s">"(message, i) in errors.full_messages"</span> <span class="na">:key=</span><span class="s">"i"</span><span class="nt">&gt;</span>\n                      <span class="si">{{</span> <span class="nx">message</span> <span class="si">}}</span>\n                    <span class="nt">&lt;/li&gt;</span>\n                  <span class="nt">&lt;/ul&gt;</span>\n                  <span class="nt">&lt;v-text-field</span>\n                    <span class="na">id=</span><span class="s">"name"</span>\n                    <span class="na">v-model=</span><span class="s">"name"</span>\n                    <span class="na">label=</span><span class="s">"name"</span>\n                    <span class="na">name=</span><span class="s">"name"</span>\n                    <span class="na">prepend-icon=</span><span class="s">"mdi-account"</span>\n                    <span class="na">type=</span><span class="s">"text"</span>\n                  <span class="nt">/&gt;</span>\n\n                  <span class="nt">&lt;v-text-field</span>\n                    <span class="na">id=</span><span class="s">"email"</span>\n                    <span class="na">v-model=</span><span class="s">"email"</span>\n                    <span class="na">label=</span><span class="s">"email"</span>\n                    <span class="na">name=</span><span class="s">"email"</span>\n                    <span class="na">prepend-icon=</span><span class="s">"mdi-email"</span>\n                    <span class="na">type=</span><span class="s">"email"</span>\n                  <span class="nt">/&gt;</span>\n\n                  <span class="nt">&lt;v-text-field</span>\n                    <span class="na">id=</span><span class="s">"password"</span>\n                    <span class="na">v-model=</span><span class="s">"password"</span>\n                    <span class="na">label=</span><span class="s">"Password"</span>\n                    <span class="na">name=</span><span class="s">"password"</span>\n                    <span class="na">prepend-icon=</span><span class="s">"mdi-lock"</span>\n                    <span class="na">type=</span><span class="s">"password"</span>\n                  <span class="nt">/&gt;</span>\n                <span class="nt">&lt;/v-card-text&gt;</span>\n                <span class="nt">&lt;v-card-actions&gt;</span>\n                  <span class="nt">&lt;v-spacer</span> <span class="nt">/&gt;</span>\n                  <span class="nt">&lt;v-btn</span> <span class="na">color=</span><span class="s">"primary"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>\n                    登録\n                  <span class="nt">&lt;/v-btn&gt;</span>\n                <span class="nt">&lt;/v-card-actions&gt;</span>\n              <span class="nt">&lt;/v-card&gt;</span>\n            <span class="nt">&lt;/form&gt;</span>\n          <span class="nt">&lt;/v-col&gt;</span>\n        <span class="nt">&lt;/v-row&gt;</span>\n      <span class="nt">&lt;/v-container&gt;</span>\n    <span class="nt">&lt;/v-main&gt;</span>\n  <span class="nt">&lt;/v-app&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">name</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">email</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">password</span><span class="p">:</span> <span class="dl">\'\'</span><span class="p">,</span>\n      <span class="na">errors</span><span class="p">:</span> <span class="p">[]</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="k">async</span> <span class="nx">signUp</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="k">try</span> <span class="p">{</span>\n        <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">signUp</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span>\n          <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>\n          <span class="na">email</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>\n          <span class="na">password</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span>\n        <span class="p">})</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/</span><span class="dl">\'</span><span class="p">)</span>\n      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>\n        <span class="k">this</span><span class="p">.</span><span class="nx">errors</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">errors</span>\n      <span class="p">}</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<p>フォームを送信すると<code>signUp()</code>メソッドが発火し、storeのsignUpアクション(この後作ります)でRails APIにPOSTし、正常終了したら<code>setUser</code>でユーザーデータをstoreに保存(この後作ります)。<br>\nエラーが起きたらcatchしてエラーを出力している、という形です。</p>\n\n<p>参考：<a href="https://vuetifyjs.com/ja/examples/layouts/centered/" rel="nofollow noopener" target="_blank">Vue Material Component Framework — Vuetify.js</a></p>\n\n<h1>\n<span id="store側の実装" class="fragment"></span><a href="#store%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>store側の実装</h1>\n\n<p>ログインに関わる処理はサイト全体で共通して使いそうなので、store/index.jsに書いていきます。</p>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">store/index.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>\n  <span class="na">user</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>\n  <span class="na">auth</span><span class="p">:</span> <span class="p">{},</span>\n  <span class="na">logged_in</span><span class="p">:</span> <span class="kc">false</span>\n<span class="p">})</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">getters</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">user</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span>\n  <span class="p">},</span>\n  <span class="nx">logged_in</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">logged_in</span>\n  <span class="p">},</span>\n  <span class="nx">auth</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">auth</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">setUser</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">logged_in</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">value</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">value</span>\n  <span class="p">},</span>\n  <span class="nx">setAuth</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>\n    <span class="nx">state</span><span class="p">.</span><span class="nx">auth</span> <span class="o">=</span> <span class="nx">value</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">signUp</span> <span class="p">(</span><span class="nx">_c</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">$post</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/v1/auth</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<p>ログインしているかどうかの判定に使うlogged_inに注目。<br>\n<code>setUser(state, value) {<br>\n  state.logged_in = !!value<br>\n  state.user = value<br>\n},</code><br>\nユーザー情報セットの際、二重否定を使うことでuserの中身があればtrue, なければfalseが入るようにしています。</p>\n\n<h1>\n<span id="axiosの拡張" class="fragment"></span><a href="#axios%E3%81%AE%E6%8B%A1%E5%BC%B5"><i class="fa fa-link"></i></a>axiosの拡張</h1>\n\n<p>続いてaxiosのデフォルト挙動を変えます。<br>\naxiosでサーバサイドと通信する度に<code>getter[\'auth\']</code>してヘッダに付与するのは冗長かつしんどいので共通化します。<br>\nまた、レスポンスが返ってくるたびにアクセストークンをstoreに保存するのも毎度書いていたら辛いので一緒に共通化します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">plugins/axios.js</span></div>\n<div class="highlight"><pre><span class="k">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">$axios</span><span class="p">,</span> <span class="nx">store</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">$axios</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">((</span><span class="nx">config</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="nx">config</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">auth</span>\n  <span class="p">})</span>\n\n  <span class="nx">$axios</span><span class="p">.</span><span class="nx">onResponse</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">\'</span><span class="s1">access-token</span><span class="dl">\'</span><span class="p">])</span> <span class="p">{</span>\n      <span class="kd">const</span> <span class="nx">authHeaders</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="dl">\'</span><span class="s1">access-token</span><span class="dl">\'</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">\'</span><span class="s1">access-token</span><span class="dl">\'</span><span class="p">],</span>\n        <span class="na">client</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">client</span><span class="p">,</span>\n        <span class="na">expiry</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">expiry</span><span class="p">,</span>\n        <span class="na">uid</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">uid</span>\n      <span class="p">}</span>\n      <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setAuth</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">authHeaders</span><span class="p">)</span>\n    <span class="p">}</span>\n  <span class="p">})</span>\n\n  <span class="nx">$axios</span><span class="p">.</span><span class="nx">onError</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>\n  <span class="p">})</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>   plugins: [\n<span class="gi">+    \'~/plugins/axios\'\n</span>   ],\n</pre></div>\n</div>\n\n<p>これで、以後axiosを使う度、リクエストにはアクセストークンが自動付与されて、レスポンス後はトークンがstoreに自動保存されます。</p>\n\n<h1>\n<span id="セッション永続化の準備" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E6%B0%B8%E7%B6%9A%E5%8C%96%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>セッション永続化の準備</h1>\n\n<p>今のままだと認証情報はstoreに入れているだけなので、画面遷移する分には問題ないのですが、F5押下のようにリロードするとログアウト状態になってしまいます。</p>\n\n<p>これを永続化するためにはトークン情報をcookieかWebStorageに保存する必要があります。</p>\n\n<p><strong>今回は簡易的な機能のためlocalStorageを使いますが、トークンをlocalStorageに保存することはセキュリティ的には弱いため、ちゃんとしたプロダクトでは避けた方が良いかもしれません。</strong></p>\n\n<p>参考：<a href="https://techracho.bpsinc.jp/hachi8833/2019_10_09/80851" rel="nofollow noopener" target="_blank">HTML5のLocal Storageを使ってはいけない（翻訳）</a></p>\n\n<ul>\n<li>cookie：サーバサイド・クライアントサイドどちらでも読み込み書き込みできるため、SSRでも使える。ただし値セットが面倒</li>\n<li>WebStorage(LocalStorage)：クライアントサイドのみのため、SSRでは使えない。そのため一瞬未ログイン画面が出てしまうデメリットがあるが、pluginを入れれば超簡単にstoreを永続化できる</li>\n</ul>\n\n<p>今回は手軽さを取ってLocalStorageを使います。</p>\n\n<div class="code-frame" data-lang="powershell"><div class="highlight"><pre><span class="err">$</span><span class="w"> </span><span class="nf">yarn</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">vuex-persistedstate</span><span class="w">\n</span></pre></div></div>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>   plugins: [\n<span class="gd">-    \'~/plugins/axios\'\n</span><span class="gi">+    \'~/plugins/axios\',\n+    { src: \'~/plugins/localStorage.js\', ssr: false }\n</span>   ],\n</pre></div>\n</div>\n\n<div class="code-frame" data-lang="js">\n<div class="code-lang"><span class="bold">plugins/localStorage.js</span></div>\n<div class="highlight"><pre><span class="k">import</span> <span class="nx">createPersistedState</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vuex-persistedstate</span><span class="dl">\'</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">store</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">createPersistedState</span><span class="p">({</span>\n    <span class="na">key</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">bbs_session</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">paths</span><span class="p">:</span> <span class="p">[</span>\n      <span class="dl">\'</span><span class="s1">auth</span><span class="dl">\'</span>\n    <span class="p">]</span>\n  <span class="p">})(</span><span class="nx">store</span><span class="p">)</span>\n<span class="p">}</span>\n\n</pre></div>\n</div>\n\n<p>これだけの設定で、<code>state.auth</code>が<code>bbs_session</code>というlocalStorageのkeyで保存されます。<br>\n特にlocalStorageを意識することなく<code>state.auth</code>に値をセットするとlocalStorageにもセットされるというすぐれものです。</p>\n\n<p>とはいえこれだけでは保存しているだけで、画面リロード時に読み込む処理が入っていません。<br>\nそのロジックは共通レイアウトに入れてしまいます。</p>\n\n<h1>\n<span id="共通レイアウトの修正" class="fragment"></span><a href="#%E5%85%B1%E9%80%9A%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fa fa-link"></i></a>共通レイアウトの修正</h1>\n\n<p>ここまでで機能の大部分はできました。<br>\nですが共通レイアウトが暗く見づらい上、不要なサイドバー等があるので作り直す勢いで修正します。</p>\n\n<p>また、前述の通り画面リロード時のセッション復元も作ります。</p>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">layouts/default.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-app&gt;</span>\n    <span class="nt">&lt;v-app-bar</span>\n      <span class="na">fixed</span>\n      <span class="na">app</span>\n    <span class="nt">&gt;</span>\n      <span class="nt">&lt;n-link</span> <span class="na">to=</span><span class="s">"/"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;v-toolbar-title</span> <span class="na">v-text=</span><span class="s">"title"</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/n-link&gt;</span>\n      <span class="nt">&lt;v-spacer</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;span</span> <span class="na">v-if=</span><span class="s">"logged_in"</span><span class="nt">&gt;</span>\n        <span class="si">{{</span> <span class="nx">current_user</span><span class="p">.</span><span class="nx">name</span> <span class="si">}}</span>さん\n      <span class="nt">&lt;/span&gt;</span>\n      <span class="nt">&lt;v-btn</span>\n        <span class="na">v-if=</span><span class="s">"logged_in"</span>\n        <span class="na">icon</span>\n      <span class="nt">&gt;</span>\n        <span class="nt">&lt;v-icon&gt;</span>mdi-logout<span class="nt">&lt;/v-icon&gt;</span>\n      <span class="nt">&lt;/v-btn&gt;</span>\n      <span class="nt">&lt;v-btn</span>\n        <span class="na">v-else</span>\n        <span class="na">icon</span>\n        <span class="na">to=</span><span class="s">"/sign_up"</span>\n        <span class="na">nuxt</span>\n      <span class="nt">&gt;</span>\n        <span class="nt">&lt;v-icon&gt;</span>mdi-account-plus<span class="nt">&lt;/v-icon&gt;</span>\n      <span class="nt">&lt;/v-btn&gt;</span>\n    <span class="nt">&lt;/v-app-bar&gt;</span>\n    <span class="nt">&lt;v-main&gt;</span>\n      <span class="nt">&lt;v-container&gt;</span>\n        <span class="nt">&lt;nuxt</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/v-container&gt;</span>\n    <span class="nt">&lt;/v-main&gt;</span>\n    <span class="nt">&lt;v-footer</span>\n      <span class="na">app</span>\n    <span class="nt">&gt;</span>\n      <span class="nt">&lt;span&gt;</span><span class="ni">&amp;copy;</span> <span class="si">{{</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="si">}}</span><span class="nt">&lt;/span&gt;</span>\n    <span class="nt">&lt;/v-footer&gt;</span>\n  <span class="nt">&lt;/v-app&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">title</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">Sample bbs</span><span class="dl">\'</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">current_user</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">user</span>\n    <span class="p">},</span>\n    <span class="nx">logged_in</span> <span class="p">()</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">logged_in</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="k">async</span> <span class="nx">beforeMount</span> <span class="p">()</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">\'</span><span class="s1">bbs_session</span><span class="dl">\'</span><span class="p">))</span>\n    <span class="k">if</span> <span class="p">(</span><span class="nx">session</span> <span class="o">&amp;&amp;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">auth</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">$get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">/v1/auth/validate_token</span><span class="dl">\'</span><span class="p">)</span>\n        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>\n        <span class="p">.</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n          <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setUser</span><span class="dl">\'</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>\n          <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">setAuth</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{})</span>\n        <span class="p">})</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<p><code>beforeMount()</code>はCSR(クライアントサイドレンダリング)でのみ最初に実行されます。<br>\nlocalStorageはサーバサイドで使えないので、クライアントサイド描画されるタイミングでセッションの値を取得し、<code>auth</code>が保存されている場合(画面更新直前までログイン状態だった場合)にvalidate_tokenを叩きにいき、user情報とauthの更新をしてログイン状態を復帰します。<br>\n無効なauthパラメータだった場合はuserとauthをクリアします（自動的にlocalStorageもクリアになります)。</p>\n\n<p>ここまで組み込めば、ログイン後に画面更新してもセッション復帰する状態になるはずです。<br>\nページを開いた直後は未ログイン状態ですが、ちょっと待てばログインになります。<br>\nこのタイムラグが気になる場合はcookieで実装が必要になります。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>   vuetify: {\n     customVariables: [\'~/assets/variables.scss\'],\n     theme: {\n<span class="gd">-      dark: true,\n</span><span class="gi">+      dark: false,\n</span>       themes: {\n<span class="gd">-        dark: {\n</span><span class="gi">+        light: {\n</span>           primary: colors.blue.darken2,\n           accent: colors.grey.darken3,\n           secondary: colors.amber.darken3,\n</pre></div>\n</div>\n\n<p>そして色変え。これでだいぶスッキリするはずです。</p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<p><a href="https://note.com/mumii/n/n175e0d4d6f15" rel="nofollow noopener" target="_blank">Rails devise token authとNuxt.jsを連携(Twitter認証)</a><br>\n<a href="https://noumenon-th.net/programming/2019/08/24/nuxt-js-store/" rel="nofollow noopener" target="_blank">Nuxt.jsのStoreによるデータ保存 [vuex-persistedstate][js-cookie]</a></p>\n\n<h1>\n<span id="続き" class="fragment"></span><a href="#%E7%B6%9A%E3%81%8D"><i class="fa fa-link"></i></a>続き</h1>\n\n<p>→<a href="https://qiita.com/rf_p/items/b714298e1f9effa32cad" id="reference-22ddc470a6f4f7d27c26">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装</a><br>\n【<a href="https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1" id="reference-40931eeb95bfb4cfabcb">連載目次へ</a>】</p>\n',body:'←[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #3 個別記事ページの作成](https://qiita.com/rf_p/items/fc7f0490a62b1f98f487)\n\n# サインアップ(登録)ページの作成\n\nサインアップページ及びそのロジックを作っていきますが、難易度が一気に上がります。\n一気にすべて理解しようとせず、少しずつコードを読み解いていってください。\n\nまずはサインアップページを作ります。\n\n```vue:pages/sign_up.vue\n<template>\n  <v-app id="inspire">\n    <v-main>\n      <v-container\n        class="fill-height"\n        fluid\n      >\n        <v-row\n          align="center"\n          justify="center"\n        >\n          <v-col\n            cols="12"\n            sm="8"\n            md="4"\n          >\n            <form @submit.prevent="signUp">\n              <v-card class="elevation-12">\n                <v-toolbar\n                  color="primary"\n                  dark\n                  flat\n                >\n                  <v-toolbar-title>SignUp form</v-toolbar-title>\n                </v-toolbar>\n                <v-card-text>\n                  <ul v-if="errors">\n                    <li v-for="(message, i) in errors.full_messages" :key="i">\n                      {{ message }}\n                    </li>\n                  </ul>\n                  <v-text-field\n                    id="name"\n                    v-model="name"\n                    label="name"\n                    name="name"\n                    prepend-icon="mdi-account"\n                    type="text"\n                  />\n\n                  <v-text-field\n                    id="email"\n                    v-model="email"\n                    label="email"\n                    name="email"\n                    prepend-icon="mdi-email"\n                    type="email"\n                  />\n\n                  <v-text-field\n                    id="password"\n                    v-model="password"\n                    label="Password"\n                    name="password"\n                    prepend-icon="mdi-lock"\n                    type="password"\n                  />\n                </v-card-text>\n                <v-card-actions>\n                  <v-spacer />\n                  <v-btn color="primary" type="submit">\n                    登録\n                  </v-btn>\n                </v-card-actions>\n              </v-card>\n            </form>\n          </v-col>\n        </v-row>\n      </v-container>\n    </v-main>\n  </v-app>\n</template>\n\n<script>\nexport default {\n  data () {\n    return {\n      name: \'\',\n      email: \'\',\n      password: \'\',\n      errors: []\n    }\n  },\n  methods: {\n    async signUp () {\n      try {\n        const data = await this.$store.dispatch(\'signUp\', {\n          name: this.name,\n          email: this.email,\n          password: this.password\n        })\n        this.$store.commit(\'setUser\', data.data)\n        this.$router.push(\'/\')\n      } catch (e) {\n        this.errors = e.data.errors\n      }\n    }\n  }\n}\n<\/script>\n\n```\n\nフォームを送信すると`signUp()`メソッドが発火し、storeのsignUpアクション(この後作ります)でRails APIにPOSTし、正常終了したら`setUser`でユーザーデータをstoreに保存(この後作ります)。\nエラーが起きたらcatchしてエラーを出力している、という形です。\n\n参考：[Vue Material Component Framework — Vuetify.js](https://vuetifyjs.com/ja/examples/layouts/centered/)\n\n# store側の実装\n\nログインに関わる処理はサイト全体で共通して使いそうなので、store/index.jsに書いていきます。\n\n```js:store/index.js\nexport const state = () => ({\n  user: null,\n  auth: {},\n  logged_in: false\n})\n\nexport const getters = {\n  user (state) {\n    return state.user\n  },\n  logged_in (state) {\n    return state.logged_in\n  },\n  auth (state) {\n    return state.auth\n  }\n}\n\nexport const mutations = {\n  setUser (state, value) {\n    state.logged_in = !!value\n    state.user = value\n  },\n  setAuth (state, value) {\n    state.auth = value\n  }\n}\n\nexport const actions = {\n  async signUp (_c, user) {\n    return await this.$axios.$post(\'/v1/auth\', user)\n  }\n}\n\n```\n\nログインしているかどうかの判定に使うlogged_inに注目。\n`setUser(state, value) {\n  state.logged_in = !!value\n  state.user = value\n},`\nユーザー情報セットの際、二重否定を使うことでuserの中身があればtrue, なければfalseが入るようにしています。\n\n# axiosの拡張\n\n続いてaxiosのデフォルト挙動を変えます。\naxiosでサーバサイドと通信する度に`getter[\'auth\']`してヘッダに付与するのは冗長かつしんどいので共通化します。\nまた、レスポンスが返ってくるたびにアクセストークンをstoreに保存するのも毎度書いていたら辛いので一緒に共通化します。\n\n```plugins/axios.js\nexport default ({ $axios, store }) => {\n  $axios.onRequest((config) => {\n    config.headers = store.getters.auth\n  })\n\n  $axios.onResponse((response) => {\n    if (response.headers[\'access-token\']) {\n      const authHeaders = {\n        \'access-token\': response.headers[\'access-token\'],\n        client: response.headers.client,\n        expiry: response.headers.expiry,\n        uid: response.headers.uid\n      }\n      store.commit(\'setAuth\', authHeaders)\n    }\n  })\n\n  $axios.onError((error) => {\n    return Promise.reject(error.response)\n  })\n}\n\n```\n\n```diff:nuxt.config.js\n   plugins: [\n+    \'~/plugins/axios\'\n   ],\n```\n\nこれで、以後axiosを使う度、リクエストにはアクセストークンが自動付与されて、レスポンス後はトークンがstoreに自動保存されます。\n\n# セッション永続化の準備\n\n今のままだと認証情報はstoreに入れているだけなので、画面遷移する分には問題ないのですが、F5押下のようにリロードするとログアウト状態になってしまいます。\n\nこれを永続化するためにはトークン情報をcookieかWebStorageに保存する必要があります。\n\n**今回は簡易的な機能のためlocalStorageを使いますが、トークンをlocalStorageに保存することはセキュリティ的には弱いため、ちゃんとしたプロダクトでは避けた方が良いかもしれません。**\n\n参考：[HTML5のLocal Storageを使ってはいけない（翻訳）](https://techracho.bpsinc.jp/hachi8833/2019_10_09/80851)\n\n* cookie：サーバサイド・クライアントサイドどちらでも読み込み書き込みできるため、SSRでも使える。ただし値セットが面倒\n* WebStorage(LocalStorage)：クライアントサイドのみのため、SSRでは使えない。そのため一瞬未ログイン画面が出てしまうデメリットがあるが、pluginを入れれば超簡単にstoreを永続化できる\n\n今回は手軽さを取ってLocalStorageを使います。\n\n```powershell\n$ yarn add vuex-persistedstate\n```\n\n```diff:nuxt.config.js\n   plugins: [\n-    \'~/plugins/axios\'\n+    \'~/plugins/axios\',\n+    { src: \'~/plugins/localStorage.js\', ssr: false }\n   ],\n```\n\n```js:plugins/localStorage.js\nimport createPersistedState from \'vuex-persistedstate\'\n\nexport default ({ store }) => {\n  createPersistedState({\n    key: \'bbs_session\',\n    paths: [\n      \'auth\'\n    ]\n  })(store)\n}\n\n```\n\nこれだけの設定で、`state.auth`が`bbs_session`というlocalStorageのkeyで保存されます。\n特にlocalStorageを意識することなく`state.auth`に値をセットするとlocalStorageにもセットされるというすぐれものです。\n\nとはいえこれだけでは保存しているだけで、画面リロード時に読み込む処理が入っていません。\nそのロジックは共通レイアウトに入れてしまいます。\n\n# 共通レイアウトの修正\n\nここまでで機能の大部分はできました。\nですが共通レイアウトが暗く見づらい上、不要なサイドバー等があるので作り直す勢いで修正します。\n\nまた、前述の通り画面リロード時のセッション復元も作ります。\n\n```vue:layouts/default.vue\n<template>\n  <v-app>\n    <v-app-bar\n      fixed\n      app\n    >\n      <n-link to="/">\n        <v-toolbar-title v-text="title" />\n      </n-link>\n      <v-spacer />\n      <span v-if="logged_in">\n        {{ current_user.name }}さん\n      </span>\n      <v-btn\n        v-if="logged_in"\n        icon\n      >\n        <v-icon>mdi-logout</v-icon>\n      </v-btn>\n      <v-btn\n        v-else\n        icon\n        to="/sign_up"\n        nuxt\n      >\n        <v-icon>mdi-account-plus</v-icon>\n      </v-btn>\n    </v-app-bar>\n    <v-main>\n      <v-container>\n        <nuxt />\n      </v-container>\n    </v-main>\n    <v-footer\n      app\n    >\n      <span>&copy; {{ new Date().getFullYear() }}</span>\n    </v-footer>\n  </v-app>\n</template>\n\n<script>\nexport default {\n  data () {\n    return {\n      title: \'Sample bbs\'\n    }\n  },\n  computed: {\n    current_user () {\n      return this.$store.getters.user\n    },\n    logged_in () {\n      return this.$store.getters.logged_in\n    }\n  },\n  async beforeMount () {\n    const session = JSON.parse(window.localStorage.getItem(\'bbs_session\'))\n    if (session && Object.keys(session.auth).length) {\n      await this.$axios.$get(\'/v1/auth/validate_token\')\n        .then(data => this.$store.commit(\'setUser\', data.data))\n        .catch(() => {\n          this.$store.commit(\'setUser\', null)\n          this.$store.commit(\'setAuth\', {})\n        })\n    }\n  }\n}\n<\/script>\n\n```\n\n`beforeMount()`はCSR(クライアントサイドレンダリング)でのみ最初に実行されます。\nlocalStorageはサーバサイドで使えないので、クライアントサイド描画されるタイミングでセッションの値を取得し、`auth`が保存されている場合(画面更新直前までログイン状態だった場合)にvalidate_tokenを叩きにいき、user情報とauthの更新をしてログイン状態を復帰します。\n無効なauthパラメータだった場合はuserとauthをクリアします（自動的にlocalStorageもクリアになります)。\n\nここまで組み込めば、ログイン後に画面更新してもセッション復帰する状態になるはずです。\nページを開いた直後は未ログイン状態ですが、ちょっと待てばログインになります。\nこのタイムラグが気になる場合はcookieで実装が必要になります。\n\n```diff:nuxt.config.js\n   vuetify: {\n     customVariables: [\'~/assets/variables.scss\'],\n     theme: {\n-      dark: true,\n+      dark: false,\n       themes: {\n-        dark: {\n+        light: {\n           primary: colors.blue.darken2,\n           accent: colors.grey.darken3,\n           secondary: colors.amber.darken3,\n```\n\nそして色変え。これでだいぶスッキリするはずです。\n\n# 参考\n\n[Rails devise token authとNuxt.jsを連携(Twitter認証)](https://note.com/mumii/n/n175e0d4d6f15)\n[Nuxt.jsのStoreによるデータ保存 [vuex-persistedstate][js-cookie]](https://noumenon-th.net/programming/2019/08/24/nuxt-js-store/)\n\n# 続き\n\n→[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #5 ログイン・ログアウトの実装](https://qiita.com/rf_p/items/b714298e1f9effa32cad)\n【[連載目次へ](https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1)】\n',coediting:a,comments_count:0,created_at:"2020-09-27T10:20:10+09:00",group:s,id:"c1162fc121d6a4ef53e6",likes_count:1,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:"localStorage",versions:[]},{name:e,versions:[]},{name:p,versions:[]},{name:"devise_token_auth",versions:[]}],title:"Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成",updated_at:"2020-09-28T08:45:10+09:00",url:"https://qiita.com/rf_p/items/c1162fc121d6a4ef53e6",user:{description:c,facebook_id:n,followees_count:31,followers_count:64,github_login_name:o,id:i,items_count:96,linkedin_id:n,location:r,name:d,organization:m,permanent_id:g,profile_image_url:u,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s},{rendered_body:'<p>←<a href="https://qiita.com/rf_p/items/34cc453c7c232e07a1d7" id="reference-e822c80cffcd61619e0a">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #2 NuxtとRailsとの疎通テスト</a></p>\n\n<h1>\n<span id="個別記事ページの作成" class="fragment"></span><a href="#%E5%80%8B%E5%88%A5%E8%A8%98%E4%BA%8B%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>個別記事ページの作成</h1>\n\n<div class="code-frame" data-lang="powershell"><div class="highlight"><pre><span class="err">$</span><span class="w"> </span><span class="nf">mkdir</span><span class="w"> </span><span class="nx">pages/posts</span><span class="w">\n</span><span class="err">$</span><span class="w"> </span><span class="nf">touch</span><span class="w"> </span><span class="nx">pages/posts/_id.vue</span><span class="w">\n</span></pre></div></div>\n\n<div class="code-frame" data-lang="vue">\n<div class="code-lang"><span class="bold">pages/posts/_id.vue</span></div>\n<div class="highlight"><pre><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;v-layout</span>\n    <span class="na">column</span>\n    <span class="na">justify-center</span>\n    <span class="na">align-center</span>\n  <span class="nt">&gt;</span>\n    <span class="nt">&lt;v-flex</span>\n      <span class="na">xs12</span>\n      <span class="na">sm8</span>\n      <span class="na">md6</span>\n    <span class="nt">&gt;</span>\n      <span class="nt">&lt;v-card&gt;</span>\n        <span class="nt">&lt;v-card-title</span> <span class="na">class=</span><span class="s">"headline"</span><span class="nt">&gt;</span>\n          <span class="si">{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">subject</span> <span class="si">}}</span> - <span class="si">{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="si">}}</span>\n        <span class="nt">&lt;/v-card-title&gt;</span>\n        <span class="nt">&lt;v-card-text&gt;</span>\n          <span class="si">{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">body</span> <span class="si">}}</span>\n        <span class="nt">&lt;/v-card-text&gt;</span>\n      <span class="nt">&lt;/v-card&gt;</span>\n    <span class="nt">&lt;/v-flex&gt;</span>\n  <span class="nt">&lt;/v-layout&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">validate</span> <span class="p">({</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="sr">/^</span><span class="se">\\d</span><span class="sr">+$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>\n  <span class="p">},</span>\n  <span class="k">async</span> <span class="nx">asyncData</span> <span class="p">({</span> <span class="nx">$axios</span><span class="p">,</span> <span class="nx">params</span> <span class="p">})</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">$axios</span><span class="p">.</span><span class="nx">$get</span><span class="p">(</span><span class="s2">`/v1/posts/</span><span class="p">${</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">post</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">post</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n</pre></div>\n</div>\n\n<p>Nuxtでは上記のように<code>pages/hoge/_id.vue</code>とすることで、hoge/{id}のような動的ページが作られます。</p>\n\n<p>バリデートは数値型のみ許容するように設定しています。以下、公式ドキュメント参照。<br>\n<a href="https://ja.nuxtjs.org/guide/routing/" rel="nofollow noopener" target="_blank">ルーティング - NuxtJS</a></p>\n\n<p>そして<code>asyncData</code>というSSR用のメソッドで<code>v1/posts/${params.id}</code>とすることで、URLのid部分の数値から固定のpostを取得しているわけです。</p>\n\n<p>なお、今回は<code>post</code>の値をVuexのstoreに保存していません。<br>\nstoreはなんでもかんでも保存を保存しておく場所ではなく、他のmoduleやサイト全体で使う必要があるか考え、そうでなければ不用意に突っ込まないほうがいいです。</p>\n\n<p>もしブラウザで以下の通り表示されたら、とりあえずOKです。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F246ec8f4-6787-df4d-8158-d440aba4f3e5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=02d84e4055968aca7e7dfeb53fcdfded" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F246ec8f4-6787-df4d-8158-d440aba4f3e5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=02d84e4055968aca7e7dfeb53fcdfded" alt="show.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/246ec8f4-6787-df4d-8158-d440aba4f3e5.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F246ec8f4-6787-df4d-8158-d440aba4f3e5.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=23f0470d508b9b64deb0d9058d774d3a 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="indexから個別ページにリンクを設置" class="fragment"></span><a href="#index%E3%81%8B%E3%82%89%E5%80%8B%E5%88%A5%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%92%E8%A8%AD%E7%BD%AE"><i class="fa fa-link"></i></a>indexから個別ページにリンクを設置</h1>\n\n<p>indexから個別ページにリンクを貼ります。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">pages/index.vue</span></div>\n<div class="highlight"><pre>       &lt;v-card v-for="post in posts" :key="post.id"&gt;\n         &lt;v-card-title class="headline"&gt;\n<span class="gd">-          {{ post.subject }} - {{ post.user.name }}\n</span><span class="gi">+          &lt;n-link :to="`/posts/${post.id}`"&gt;\n+            {{ post.subject }} - {{ post.user.name }}\n+          &lt;/n-link&gt;\n</span>         &lt;/v-card-title&gt;\n         &lt;v-card-text&gt;\n</pre></div>\n</div>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F7f5be50f-f8a5-0279-1a4f-5456c2befa2b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=45934518fa5c8c363a22eaaeb1b35a85" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F7f5be50f-f8a5-0279-1a4f-5456c2befa2b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=45934518fa5c8c363a22eaaeb1b35a85" alt="list.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/7f5be50f-f8a5-0279-1a4f-5456c2befa2b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F7f5be50f-f8a5-0279-1a4f-5456c2befa2b.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3accb55df0def889f8d66a988a78853d 1x" loading="lazy"></a></p>\n\n<p>リンクになっていますね。</p>\n\n<h1>\n<span id="cors対策" class="fragment"></span><a href="#cors%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>CORS対策</h1>\n\n<p>ではindexから個別ページに飛んでみましょう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F0a83f7f4-ccad-c394-262e-9666474604ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f775999f85242e24f17871304e8a19e" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F0a83f7f4-ccad-c394-262e-9666474604ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f775999f85242e24f17871304e8a19e" alt="error.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/0a83f7f4-ccad-c394-262e-9666474604ab.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F199678%2F0a83f7f4-ccad-c394-262e-9666474604ab.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b7594fe127927f3dd09e650bac3f383a 1x" loading="lazy"></a></p>\n\n<p>エラーになりましたか？<br>\n実はこれがエラーメッセージ読んでも原因が特定しづらく結構厄介なものです。<br>\n以前この問題の対応策を書き残していますので、詳細を知りたい方は以下の記事を。<br>\n<a href="https://qiita.com/rf_p/items/e52a1ea4273247f051ae" id="reference-5e8d5628919e40d84ec5">Nuxt.jsでURL直叩きの時はページが表示されるのに、nuxt-linkやブラウザバックでAn error occurredになる</a></p>\n\n<p>さて上記記事にも書きましたが、原因はページ遷移した場合はSSR(サーバサイドレンダリング)ではなくCSR(クライアントサイドレンダリング)になるため、CORS(オリジン間リソース共有)の対策が必要です。</p>\n\n<div class="code-frame" data-lang="diff">\n<div class="code-lang"><span class="bold">nuxt.config.js</span></div>\n<div class="highlight"><pre>   ** Nuxt.js modules\n   */\n   modules: [\n<span class="gd">-    \'@nuxtjs/axios\'\n</span><span class="gi">+    \'@nuxtjs/axios\',\n+    \'@nuxtjs/proxy\'\n</span>   ],\n<span class="gd">-  axios: {},\n</span><span class="gi">+  axios: {\n+    proxy: true\n+  },\n+  proxy: {\n+    \'/v1/\': {\n+      target: \'https:/xxxxxxxxxxx.ap-northeast-1.amazonaws.com:8080/\'\n+    }\n+  },\n</span></pre></div>\n</div>\n\n<p>targetはご自身のRails APIエンドポイントに置き換えてください。</p>\n\n<p>この設定が済めば、indexも個別ページも、ブラウザバックやn-link(nuxt-link)による遷移時も正常に表示されるはずです。</p>\n\n<h1>\n<span id="続き" class="fragment"></span><a href="#%E7%B6%9A%E3%81%8D"><i class="fa fa-link"></i></a>続き</h1>\n\n<p>→<a href="https://qiita.com/rf_p/items/c1162fc121d6a4ef53e6" id="reference-886361d959c99fad42b2">Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成</a><br>\n【<a href="https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1" id="reference-9f89f65434cab48b477b">連載目次へ</a>】</p>\n',body:"←[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #2 NuxtとRailsとの疎通テスト](https://qiita.com/rf_p/items/34cc453c7c232e07a1d7)\n\n# 個別記事ページの作成\n\n```powershell\n$ mkdir pages/posts\n$ touch pages/posts/_id.vue\n```\n\n```vue:pages/posts/_id.vue\n<template>\n  <v-layout\n    column\n    justify-center\n    align-center\n  >\n    <v-flex\n      xs12\n      sm8\n      md6\n    >\n      <v-card>\n        <v-card-title class=\"headline\">\n          {{ post.subject }} - {{ post.user.name }}\n        </v-card-title>\n        <v-card-text>\n          {{ post.body }}\n        </v-card-text>\n      </v-card>\n    </v-flex>\n  </v-layout>\n</template>\n\n<script>\nexport default {\n  validate ({ params }) {\n    return /^\\d+$/.test(params.id)\n  },\n  async asyncData ({ $axios, params }) {\n    const response = await $axios.$get(`/v1/posts/${params.id}`)\n    return {\n      post: response.post\n    }\n  }\n}\n<\/script>\n\n```\n\nNuxtでは上記のように`pages/hoge/_id.vue`とすることで、hoge/{id}のような動的ページが作られます。\n\nバリデートは数値型のみ許容するように設定しています。以下、公式ドキュメント参照。\n[ルーティング - NuxtJS](https://ja.nuxtjs.org/guide/routing/)\n\nそして`asyncData`というSSR用のメソッドで`v1/posts/${params.id}`とすることで、URLのid部分の数値から固定のpostを取得しているわけです。\n\nなお、今回は`post`の値をVuexのstoreに保存していません。\nstoreはなんでもかんでも保存を保存しておく場所ではなく、他のmoduleやサイト全体で使う必要があるか考え、そうでなければ不用意に突っ込まないほうがいいです。\n\nもしブラウザで以下の通り表示されたら、とりあえずOKです。\n\n![show.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/246ec8f4-6787-df4d-8158-d440aba4f3e5.png)\n\n# indexから個別ページにリンクを設置\n\nindexから個別ページにリンクを貼ります。\n\n```diff:pages/index.vue\n       <v-card v-for=\"post in posts\" :key=\"post.id\">\n         <v-card-title class=\"headline\">\n-          {{ post.subject }} - {{ post.user.name }}\n+          <n-link :to=\"`/posts/${post.id}`\">\n+            {{ post.subject }} - {{ post.user.name }}\n+          </n-link>\n         </v-card-title>\n         <v-card-text>\n```\n\n![list.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/7f5be50f-f8a5-0279-1a4f-5456c2befa2b.png)\n\nリンクになっていますね。\n\n# CORS対策\n\nではindexから個別ページに飛んでみましょう。\n\n![error.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/0a83f7f4-ccad-c394-262e-9666474604ab.png)\n\nエラーになりましたか？\n実はこれがエラーメッセージ読んでも原因が特定しづらく結構厄介なものです。\n以前この問題の対応策を書き残していますので、詳細を知りたい方は以下の記事を。\n[Nuxt.jsでURL直叩きの時はページが表示されるのに、nuxt-linkやブラウザバックでAn error occurredになる](https://qiita.com/rf_p/items/e52a1ea4273247f051ae)\n\nさて上記記事にも書きましたが、原因はページ遷移した場合はSSR(サーバサイドレンダリング)ではなくCSR(クライアントサイドレンダリング)になるため、CORS(オリジン間リソース共有)の対策が必要です。\n\n```diff:nuxt.config.js\n   ** Nuxt.js modules\n   */\n   modules: [\n-    '@nuxtjs/axios'\n+    '@nuxtjs/axios',\n+    '@nuxtjs/proxy'\n   ],\n-  axios: {},\n+  axios: {\n+    proxy: true\n+  },\n+  proxy: {\n+    '/v1/': {\n+      target: 'https:/xxxxxxxxxxx.ap-northeast-1.amazonaws.com:8080/'\n+    }\n+  },\n```\n\ntargetはご自身のRails APIエンドポイントに置き換えてください。\n\nこの設定が済めば、indexも個別ページも、ブラウザバックやn-link(nuxt-link)による遷移時も正常に表示されるはずです。\n\n# 続き\n\n→[Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #4 サインアップページの作成](https://qiita.com/rf_p/items/c1162fc121d6a4ef53e6)\n【[連載目次へ](https://qiita.com/rf_p/items/0277ae96c5de433b4849#%E7%9B%AE%E6%AC%A1)】\n",coediting:a,comments_count:0,created_at:"2020-09-26T08:43:02+09:00",group:s,id:"fc7f0490a62b1f98f487",likes_count:1,private:a,reactions_count:0,tags:[{name:t,versions:[]},{name:e,versions:[]},{name:p,versions:[]}],title:"Nuxt.jsで認証認可入り掲示板APIのフロントエンド部分を構築する #3 個別記事ページの作成",updated_at:"2020-09-27T10:20:44+09:00",url:"https://qiita.com/rf_p/items/fc7f0490a62b1f98f487",user:{description:c,facebook_id:n,followees_count:31,followers_count:64,github_login_name:o,id:i,items_count:96,linkedin_id:n,location:r,name:d,organization:m,permanent_id:g,profile_image_url:u,team_only:a,twitter_screen_name:s,website_url:n},page_views_count:s}]}],fetch:[],error:s,state:{todos:{todos:[]}},serverRendered:!0,routePath:"/articles",config:{}}}(null,"",!1,"nuxt.js","Vue.js","JavaScript","282Haniwa","フェレットを愛してやまない、バックエンドやや多めのWebエンジニアです","rfdnxbro","rf_p","愛知県","ryu fukuda","エイチームブライズ",199678,"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/199678/profile-images/1558589852","TypeScript","2020-10-04T12:01:26+09:00","KueharX","axios","駆け出しITエンジニア。元プラントエンジニア。42tokyo入学予定。（8月Piscine）","dai65527","daitai-daidai","Kanagawa",677011,"https://avatars1.githubusercontent.com/u/38717336?v=4","2020-10-01T11:51:04+09:00","abetomo","2020-10-01T08:31:38+09:00","takahiro-0430","Tokyo","@ TaOn","フリーランス",250620,"https://qiita-image-store.s3.amazonaws.com/0/250620/profile-images/1539696351","2020-10-01T08:30:24+09:00","2020-09-30T10:10:31+09:00","Electron",615997,"https://avatars3.githubusercontent.com/u/25707587?v=4","282haniwa","2020-09-29T16:01:39+09:00","seiy4","CORS","2020-09-29T00:07:00+09:00","2020-09-28T20:20:23+09:00","miyawash","banzyyy")</script><script src="/_nuxt/eb48907.js" defer></script><script src="/_nuxt/04d8d93.js" defer></script><script src="/_nuxt/03b0cb7.js" defer></script><script src="/_nuxt/4845015.js" defer></script><script src="/_nuxt/5be2546.js" defer></script>
  </body>
</html>
